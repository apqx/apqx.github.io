import{R as l,r as o,M as m,j as n,B as d,g as u,S as p,c,a as h,b as g,s as f,C as w,d as x,e as j,f as _}from"../blog-scaffold.js";import{i as b}from"./blog-contentCard.js";function k(s){const t=l.useRef(null),e=l.useRef(null);o.useEffect(()=>{const r=t.current;return e.current=new m(r),e.current.determinate=!1,()=>{e.current?.destroy()}},[]),o.useEffect(()=>{i(s.loading)},[s.loading]);function i(r){r?e.current?.open():e.current?.close()}return n.jsxs("div",{ref:t,role:"progressbar",className:`mdc-linear-progress ${s.classes?.join(" ")??""}`.trimEnd(),children:[n.jsxs("div",{className:"mdc-linear-progress__buffer",children:[n.jsx("div",{className:"mdc-linear-progress__buffer-bar"}),n.jsx("div",{className:"mdc-linear-progress__buffer-dots"})]}),n.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__primary-bar",children:n.jsx("span",{className:"mdc-linear-progress__bar-inner"})}),n.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__secondary-bar",children:n.jsx("span",{className:"mdc-linear-progress__bar-inner"})})]})}class C extends d{state={title:"查询映射",content:"",onClickLink:()=>{}};constructor(t){super(),this.state.content=t}findPage(t){let e=Date.now();u().getUrlMap({debugMode:p}).then(i=>{if(i.status===200)return i.json();throw new Error("Something went wrong on api server!")}).then(i=>{for(const a of i.map)if(a.id===t){c("Find pid "+t+" => "+a.target.path);var r=a.target.path;a.target.path.startsWith("http")||(r=window.location.origin+a.target.path),c("JumpUrl is "+r),this.showJump(e,r,a.target.title);return}this.showJump(e,window.location.origin+"/404.html","未找到目标页面"),c("Pid not exist, check url-map")}).catch(i=>{h(i),this.showJump(e,window.location.origin+"/404.html","解析映射表异常")})}showJump(t,e,i){g(t,()=>{this.refreshHint(i,e)},800)}refreshHint(t,e){this.state={title:"正在跳转",content:t,onClickLink:()=>{window.location.replace(e)}},this.emitChange(),setTimeout(()=>{window.location.replace(e)},800)}}function E(s){const t=o.useMemo(()=>new C(s.pid),[]),e=o.useSyncExternalStore(t.subscribe,()=>t.state);return o.useEffect(()=>{t.findPage(s.pid)},[]),n.jsx(x,{openCount:s.openCount,closeOnClickOutside:!1,actions:[],children:n.jsxs("div",{className:"jump-dialog-container center-inline-items",children:[n.jsxs("picture",{children:[n.jsx("source",{srcSet:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.webp",type:"image/webp"}),n.jsx("img",{className:"inline-for-center emoji-jump",alt:"",src:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.gif"})]}),n.jsx("p",{id:"short-link-jump-dialog_title",children:e.title}),n.jsx("p",{id:"short-link-jump-dialog_link",className:"center-inline-items",children:n.jsx("a",{className:"clickable-empty-link",onClick:e.onClickLink,children:e.content})}),n.jsx(k,{loading:!0})]})})}let y=0;function D(s){f(n.jsx(E,{openCount:y++,pid:s}),w)}function S(){j(()=>{b(!1)}),_(()=>{M()})}function M(){let s=null;const t=window.location.pathname;c("Url path = "+t);var e=t.match(RegExp("^/((og|rp|op|pt|ot)\\d\\d|index-opera|opera|lens|repost|poetry|share|print|kfc)$"));if(c("Url matches = "+e),e!=null&&e.length>0&&(s=e[1]),s==null){const i=document.querySelector(".content-card");i!=null&&(i.style.display="block");return}D(s)}export{S as init404};

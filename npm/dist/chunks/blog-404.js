import{R as p,M as h,j as s,i as d,c as a,a as m,r as u,s as g,C as f,B as w,b as x,d as j}from"../blog-scaffold.js";import{i as k}from"./blog-contentCard.js";class _ extends p.Component{containerRef=p.createRef();progressLinear=null;init(e){e!=null&&(this.progressLinear==null&&(this.progressLinear=new h(e),this.progressLinear.determinate=!1),this.showLoading(this.props.loading))}componentDidMount(){const e=this.containerRef.current;this.init(e)}componentDidUpdate(e,t,n){this.showLoading(this.props.loading)}showLoading(e){e?this.progressLinear?.open():this.progressLinear?.close()}render(){return s.jsxs("div",{ref:this.containerRef,role:"progressbar",className:"mdc-linear-progress",children:[s.jsxs("div",{className:"mdc-linear-progress__buffer",children:[s.jsx("div",{className:"mdc-linear-progress__buffer-bar"}),s.jsx("div",{className:"mdc-linear-progress__buffer-dots"})]}),s.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__primary-bar",children:s.jsx("span",{className:"mdc-linear-progress__bar-inner"})}),s.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__secondary-bar",children:s.jsx("span",{className:"mdc-linear-progress__bar-inner"})})]})}}class b{component;constructor(e){this.component=e}findPage(e){let t;d()?t=window.location.origin:t="https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog";const n=new Request(t+"/api/url-map.json",{method:"GET"});let c=Date.now();fetch(n,{cache:"no-cache"}).then(o=>{if(o.status===200)return o.json();throw new Error("Something went wrong on api server!")}).then(o=>{for(const r of o.map)if(r.id===e){a("Find pid "+e+" => "+r.target.path);var l=r.target.path;r.target.path.startsWith("http")||(l=window.location.origin+r.target.path),a("JumpUrl is "+l),this.showJump(c,l,r.target.title);return}this.showJump(c,window.location.origin+"/404.html","未找到目标页面"),a("Pid not exist, check url-map")}).catch(o=>{m(o),this.showJump(c,window.location.origin+"/404.html","解析映射表异常")})}showJump(e,t,n){u(e,()=>{this.refreshHint(n,t)},800)}refreshHint(e,t){this.component.setState({title:"正在跳转",content:e,onClickLink:()=>{window.location.replace(t)}}),setTimeout(()=>{window.location.replace(t)},800)}}class L extends w{presenter;constructor(e){super(e),this.presenter=new b(this),this.state={title:"查询映射",content:this.props.pid,onClickLink:()=>{}}}componentDidMount(){super.componentDidMount(),this.presenter.findPage(this.props.pid)}dialogContent(){return s.jsxs("div",{className:"center-items",children:[s.jsxs("picture",{children:[s.jsx("source",{srcSet:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.webp",type:"image/webp"}),s.jsx("img",{className:"inline-for-center emoji-jump",alt:"",src:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.gif"})]}),s.jsx("p",{id:"short-link-jump-dialog_title",children:this.state.title}),s.jsx("p",{id:"short-link-jump-dialog_link",className:"center-items",children:s.jsx("a",{className:"clickable-empty-link",onClick:this.state.onClickLink,children:this.state.content})}),s.jsx(_,{loading:!0})]})}}let D=0;function C(i){g(s.jsx(L,{openCount:D++,pid:i,fixedWidth:!1,btnText:void 0,OnClickBtn:void 0,closeOnClickOutside:!1}),f)}function P(){x(()=>{k(!1)}),j(()=>{v()})}function v(){let i=null;const e=window.location.pathname;a("Url path = "+e);var t=e.match(RegExp("^/((og|rp|op|pt|ot)\\d\\d|index-opera|opera|repost|poetry|share|print|kfc)$"));if(a("Url matches = "+t),t!=null&&t.length>0&&(i=t[1]),i==null){const n=document.querySelector(".content-card");n!=null&&(n.style.display="block");return}C(i)}export{P as init404};

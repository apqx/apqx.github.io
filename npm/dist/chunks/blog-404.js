import{R as l,r as o,M as m,j as s,B as p,g as u,S as d,c,a as h,b as g,s as f,C as x,d as w,e as j,f as _}from"../blog-scaffold.js";import{i as b}from"./blog-contentCard.js";function k(n){const t=l.useRef(null),e=l.useRef(null);o.useEffect(()=>{const i=t.current;return e.current=new m(i),e.current.determinate=!1,()=>{e.current?.destroy()}},[]),o.useEffect(()=>{r(n.loading)},[n.loading]);function r(i){i?e.current?.open():e.current?.close()}return s.jsxs("div",{ref:t,role:"progressbar",className:"mdc-linear-progress",children:[s.jsxs("div",{className:"mdc-linear-progress__buffer",children:[s.jsx("div",{className:"mdc-linear-progress__buffer-bar"}),s.jsx("div",{className:"mdc-linear-progress__buffer-dots"})]}),s.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__primary-bar",children:s.jsx("span",{className:"mdc-linear-progress__bar-inner"})}),s.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__secondary-bar",children:s.jsx("span",{className:"mdc-linear-progress__bar-inner"})})]})}class C extends p{state={title:"查询映射",content:"",onClickLink:()=>{}};constructor(t){super(),this.state.content=t}findPage(t){let e=Date.now();u().getUrlMap({debugMode:d}).then(r=>{if(r.status===200)return r.json();throw new Error("Something went wrong on api server!")}).then(r=>{for(const a of r.map)if(a.id===t){c("Find pid "+t+" => "+a.target.path);var i=a.target.path;a.target.path.startsWith("http")||(i=window.location.origin+a.target.path),c("JumpUrl is "+i),this.showJump(e,i,a.target.title);return}this.showJump(e,window.location.origin+"/404.html","未找到目标页面"),c("Pid not exist, check url-map")}).catch(r=>{h(r),this.showJump(e,window.location.origin+"/404.html","解析映射表异常")})}showJump(t,e,r){g(t,()=>{this.refreshHint(r,e)},800)}refreshHint(t,e){this.state={title:"正在跳转",content:t,onClickLink:()=>{window.location.replace(e)}},this.emitChange(),setTimeout(()=>{window.location.replace(e)},800)}}function E(n){const t=o.useMemo(()=>new C(n.pid),[]),e=o.useSyncExternalStore(t.subscribe,()=>t.state);return o.useEffect(()=>{t.findPage(n.pid)},[]),s.jsx(w,{openCount:n.openCount,closeOnClickOutside:!1,actions:[],children:s.jsxs("div",{className:"center-items",children:[s.jsxs("picture",{children:[s.jsx("source",{srcSet:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.webp",type:"image/webp"}),s.jsx("img",{className:"inline-for-center emoji-jump",alt:"",src:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.gif"})]}),s.jsx("p",{id:"short-link-jump-dialog_title",children:e.title}),s.jsx("p",{id:"short-link-jump-dialog_link",className:"center-items",children:s.jsx("a",{className:"clickable-empty-link",onClick:e.onClickLink,children:e.content})}),s.jsx(k,{loading:!0})]})})}let y=0;function D(n){f(s.jsx(E,{openCount:y++,pid:n}),x)}function v(){j(()=>{b(!1)}),_(()=>{N()})}function N(){let n=null;const t=window.location.pathname;c("Url path = "+t);var e=t.match(RegExp("^/((og|rp|op|pt|ot)\\d\\d|index-opera|opera|lens|repost|poetry|share|print|kfc)$"));if(c("Url matches = "+e),e!=null&&e.length>0&&(n=e[1]),n==null){const r=document.querySelector(".content-card");r!=null&&(r.style.display="block");return}D(n)}export{v as init404};

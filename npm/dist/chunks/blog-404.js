import{R as l,r as a,M as m,j as n,B as d,g as u,S as p,c as o,a as h,b as g,s as f,C as x,d as j,e as w,f as _}from"../blog-scaffold.js";import{i as b}from"./blog-contentCard.js";function k(s){const t=l.useRef(null),e=l.useRef(null);return a.useEffect(()=>{const r=t.current;return e.current=new m(r),()=>{e.current?.destroy()}},[]),a.useEffect(()=>{s.loading?(e.current.determinate=!1,e.current?.open()):(e.current.determinate=!1,e.current?.close())},[s.loading]),n.jsxs("div",{ref:t,role:"progressbar",className:`mdc-linear-progress ${s.classes?.join(" ")??""}`.trimEnd(),children:[n.jsxs("div",{className:"mdc-linear-progress__buffer",children:[n.jsx("div",{className:"mdc-linear-progress__buffer-bar"}),n.jsx("div",{className:"mdc-linear-progress__buffer-dots"})]}),n.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__primary-bar",children:n.jsx("span",{className:"mdc-linear-progress__bar-inner"})}),n.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__secondary-bar",children:n.jsx("span",{className:"mdc-linear-progress__bar-inner"})})]})}class C extends d{state={title:"查询映射",content:"",onClickLink:()=>{}};constructor(t){super(),this.state.content=t}findPage(t){let e=Date.now();u().getUrlMap({debugMode:p}).then(r=>{if(r.status===200)return r.json();throw new Error("Something went wrong on api server!")}).then(r=>{for(const i of r.map)if(i.id===t){o("Find pid "+t+" => "+i.target.path);var c=i.target.path;i.target.path.startsWith("http")||(c=window.location.origin+i.target.path),o("JumpUrl is "+c),this.showJump(e,c,i.target.title);return}this.showJump(e,window.location.origin+"/404.html","未找到目标页面"),o("Pid not exist, check url-map")}).catch(r=>{h(r),this.showJump(e,window.location.origin+"/404.html","解析映射表异常")})}showJump(t,e,r){g(t,()=>{this.refreshHint(r,e)},800)}refreshHint(t,e){this.state={title:"正在跳转",content:t,onClickLink:()=>{window.location.replace(e)}},this.emitChange(),setTimeout(()=>{window.location.replace(e)},800)}}function E(s){const t=a.useMemo(()=>new C(s.pid),[]),e=a.useSyncExternalStore(t.subscribe,()=>t.state);return a.useEffect(()=>{t.findPage(s.pid)},[]),n.jsx(j,{openCount:s.openCount,closeOnClickOutside:!1,actions:[],children:n.jsxs("div",{className:"jump-dialog-container center-inline-items",children:[n.jsxs("picture",{children:[n.jsx("source",{srcSet:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.webp",type:"image/webp"}),n.jsx("img",{className:"inline-for-center emoji-jump",alt:"",src:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.gif"})]}),n.jsx("p",{id:"short-link-jump-dialog_title",children:e.title}),n.jsx("p",{id:"short-link-jump-dialog_link",className:"center-inline-items",children:n.jsx("a",{className:"clickable-empty-link",onClick:e.onClickLink,children:e.content})}),n.jsx(k,{loading:!0})]})})}let y=0;function D(s){f(n.jsx(E,{openCount:y++,pid:s}),x)}function S(){w(()=>{b(!1)}),_(()=>{M()})}function M(){let s=null;const t=window.location.pathname;o("Url path = "+t);var e=t.match(RegExp("^/((og|rp|op|pt|ot)\\d\\d|index-opera|opera|lens|repost|poetry|share|print|kfc)$"));if(o("Url matches = "+e),e!=null&&e.length>0&&(s=e[1]),s==null){const r=document.querySelector(".content-card");r!=null&&(r.style.display="block");return}D(s)}export{S as init404};

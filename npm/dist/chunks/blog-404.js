import{R as c,r as l,M as p,j as t,g as m,S as d,c as a,a as h,b as u,s as g,C as f,B as w,d as x,e as j}from"../blog-scaffold.js";import{i as _}from"./blog-contentCard.js";function k(r){const s=c.useRef(null),e=c.useRef(null);l.useEffect(()=>{const i=s.current;e.current==null&&(e.current=new p(i),e.current.determinate=!1),n(r.loading)},[r.loading]);function n(i){i?e.current?.open():e.current?.close()}return t.jsxs("div",{ref:s,role:"progressbar",className:"mdc-linear-progress",children:[t.jsxs("div",{className:"mdc-linear-progress__buffer",children:[t.jsx("div",{className:"mdc-linear-progress__buffer-bar"}),t.jsx("div",{className:"mdc-linear-progress__buffer-dots"})]}),t.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__primary-bar",children:t.jsx("span",{className:"mdc-linear-progress__bar-inner"})}),t.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__secondary-bar",children:t.jsx("span",{className:"mdc-linear-progress__bar-inner"})})]})}class b{component;constructor(s){this.component=s}findPage(s){let e=Date.now();m().getUrlMap({debugMode:d}).then(n=>{if(n.status===200)return n.json();throw new Error("Something went wrong on api server!")}).then(n=>{for(const o of n.map)if(o.id===s){a("Find pid "+s+" => "+o.target.path);var i=o.target.path;o.target.path.startsWith("http")||(i=window.location.origin+o.target.path),a("JumpUrl is "+i),this.showJump(e,i,o.target.title);return}this.showJump(e,window.location.origin+"/404.html","未找到目标页面"),a("Pid not exist, check url-map")}).catch(n=>{h(n),this.showJump(e,window.location.origin+"/404.html","解析映射表异常")})}showJump(s,e,n){u(s,()=>{this.refreshHint(n,e)},800)}refreshHint(s,e){this.component.setState({title:"正在跳转",content:s,onClickLink:()=>{window.location.replace(e)}}),setTimeout(()=>{window.location.replace(e)},800)}}class D extends w{presenter;constructor(s){super(s),this.closeOnClickOutside=!1,this.presenter=new b(this),this.state={title:"查询映射",content:this.props.pid,onClickLink:()=>{}}}configActionBtns(){return[]}componentDidMount(){super.componentDidMount(),this.presenter.findPage(this.props.pid)}dialogContent(){return t.jsxs("div",{className:"center-items",children:[t.jsxs("picture",{children:[t.jsx("source",{srcSet:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.webp",type:"image/webp"}),t.jsx("img",{className:"inline-for-center emoji-jump",alt:"",src:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.gif"})]}),t.jsx("p",{id:"short-link-jump-dialog_title",children:this.state.title}),t.jsx("p",{id:"short-link-jump-dialog_link",className:"center-items",children:t.jsx("a",{className:"clickable-empty-link",onClick:this.state.onClickLink,children:this.state.content})}),t.jsx(k,{loading:!0})]})}}let C=0;function M(r){g(t.jsx(D,{openCount:C++,pid:r}),f)}function E(){x(()=>{_(!1)}),j(()=>{N()})}function N(){let r=null;const s=window.location.pathname;a("Url path = "+s);var e=s.match(RegExp("^/((og|rp|op|pt|ot)\\d\\d|index-opera|opera|lens|repost|poetry|share|print|kfc)$"));if(a("Url matches = "+e),e!=null&&e.length>0&&(r=e[1]),r==null){const n=document.querySelector(".content-card");n!=null&&(n.style.display="block");return}M(r)}export{E as init404};

import{R as p,r as h,M as m,j as t,i as d,c,a as u,b as g,s as f,C as w,B as x,d as j,e as k}from"../blog-scaffold.js";import{i as _}from"./blog-contentCard.js";function b(n){const s=p.useRef(null),e=p.useRef(null);h.useEffect(()=>{const r=s.current;e.current==null&&(e.current=new m(r),e.current.determinate=!1),i(n.loading)},[n.loading]);function i(r){r?e.current?.open():e.current?.close()}return t.jsxs("div",{ref:s,role:"progressbar",className:"mdc-linear-progress",children:[t.jsxs("div",{className:"mdc-linear-progress__buffer",children:[t.jsx("div",{className:"mdc-linear-progress__buffer-bar"}),t.jsx("div",{className:"mdc-linear-progress__buffer-dots"})]}),t.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__primary-bar",children:t.jsx("span",{className:"mdc-linear-progress__bar-inner"})}),t.jsx("div",{className:"mdc-linear-progress__bar mdc-linear-progress__secondary-bar",children:t.jsx("span",{className:"mdc-linear-progress__bar-inner"})})]})}class C{component;constructor(s){this.component=s}findPage(s){let e;d()?e=window.location.origin:e="https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog";const i=new Request(e+"/api/url-map.json",{method:"GET"});let r=Date.now();fetch(i,{cache:"no-cache"}).then(o=>{if(o.status===200)return o.json();throw new Error("Something went wrong on api server!")}).then(o=>{for(const a of o.map)if(a.id===s){c("Find pid "+s+" => "+a.target.path);var l=a.target.path;a.target.path.startsWith("http")||(l=window.location.origin+a.target.path),c("JumpUrl is "+l),this.showJump(r,l,a.target.title);return}this.showJump(r,window.location.origin+"/404.html","未找到目标页面"),c("Pid not exist, check url-map")}).catch(o=>{u(o),this.showJump(r,window.location.origin+"/404.html","解析映射表异常")})}showJump(s,e,i){g(s,()=>{this.refreshHint(i,e)},800)}refreshHint(s,e){this.component.setState({title:"正在跳转",content:s,onClickLink:()=>{window.location.replace(e)}}),setTimeout(()=>{window.location.replace(e)},800)}}class D extends x{presenter;constructor(s){super(s),this.presenter=new C(this),this.state={title:"查询映射",content:this.props.pid,onClickLink:()=>{}}}componentDidMount(){super.componentDidMount(),this.presenter.findPage(this.props.pid)}dialogContent(){return t.jsxs("div",{className:"center-items",children:[t.jsxs("picture",{children:[t.jsx("source",{srcSet:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.webp",type:"image/webp"}),t.jsx("img",{className:"inline-for-center emoji-jump",alt:"",src:"https://apqx-host.oss-cn-hangzhou.aliyuncs.com/blog/emojis/noto-animated-emoji/peacock/512.gif"})]}),t.jsx("p",{id:"short-link-jump-dialog_title",children:this.state.title}),t.jsx("p",{id:"short-link-jump-dialog_link",className:"center-items",children:t.jsx("a",{className:"clickable-empty-link",onClick:this.state.onClickLink,children:this.state.content})}),t.jsx(b,{loading:!0})]})}}let y=0;function N(n){f(t.jsx(D,{openCount:y++,pid:n,fixedWidth:!1,btnText:void 0,OnClickBtn:void 0,closeOnClickOutside:!1}),w)}function M(){j(()=>{_(!1)}),k(()=>{v()})}function v(){let n=null;const s=window.location.pathname;c("Url path = "+s);var e=s.match(RegExp("^/((og|rp|op|pt|ot)\\d\\d|index-opera|opera|lens|repost|poetry|share|print|kfc)$"));if(c("Url matches = "+e),e!=null&&e.length>0&&(n=e[1]),n==null){const i=document.querySelector(".content-card");i!=null&&(i.style.display="block");return}N(n)}export{M as init404};

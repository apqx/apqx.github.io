import{h as R,c as h,r as d,H as S,P as L,j as r,L as N,i as O,k as M,l as g,m as x,n as T,t as I,R as b,o as _,p as W,q as z,e as B,u as $,v as F,w as G,x as V}from"../blog-scaffold.js";function j(e){e!=null&&new R(e)}class Y{callback;lastTimeout;lastWidth=-1;resizeObserver=new ResizeObserver(t=>{const n=t.pop();n.contentRect.width!=this.lastWidth&&n.contentRect.width!=0&&(this.lastWidth=n.contentRect.width,this.lastTimeout!=null&&clearTimeout(this.lastTimeout),this.lastTimeout=setTimeout(()=>{h("ResizeWidthObserver width changed after delay "+n.contentRect.width),this.callback(n.contentRect.width)},200))});constructor(t,n){this.lastWidth=t.clientWidth,this.callback=n,this.resizeObserver.observe(t)}destroy(){this.resizeObserver.disconnect()}}function U(e){const t=d.useMemo(()=>{const o={tag:e.tag,category:e.category};return new S(new L(o))},[]),n=d.useSyncExternalStore(t.subscribe,()=>t.state),i=d.useMemo(()=>e.onMount,[e.onMount]);d.useEffect(()=>{h(`IndexLinearPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(!1),i?.();const o=new O(()=>{t.loadMore(!1)}),a=()=>{o.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",a),()=>{h("IndexLinearPosts useEffect cleanup"),window.removeEventListener("scroll",a)}},[]);const s=d.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),l=d.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return r.jsxs("ul",{className:"index-ul",children:[e.pinnedPosts.map(o=>r.jsx(D,{title:o.title,author:o.author,date:o.date,description:o.description,path:o.path,fromPinnedList:!0,pinned:!0,featured:o.featured},o.title+o.date)),l.map((o,a)=>r.jsx(D,{title:o.title,author:o.author,date:o.date,description:o.description,path:o.path,fromPinnedList:!1,pinned:o.pinned,featured:o.featured},o.path)),(n.loading||n.loadingHint!=null)&&r.jsx(N,{loading:n.loading,loadHint:n.loadingHint,onClickHint:s})]})}function D(e){const t=d.useRef(null),n=d.useRef(null),i=d.useMemo(()=>M(e.date),[e.date]);return d.useEffect(()=>{g("IndexItem component mounted",e);const s=t.current;return n.current=s.querySelector(".index-card"),j(n.current),n.current!=null&&x().observe(n.current),()=>{h("IndexItem component unmount "+e.title),n.current!=null&&x().unobserve(n.current)}},[]),r.jsxs("li",{ref:t,className:"index-li",children:[r.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:e.path,children:r.jsxs("section",{children:[r.jsx("h1",{className:"index-title",children:e.title}),r.jsx("span",{className:"index-author",children:e.author}),r.jsxs("span",{className:"index-date",children:[i.year,r.jsx("span",{className:"year",children:"年"}),i.month,r.jsx("span",{className:"month",children:"月"}),i.day,r.jsx("span",{className:"day",children:"日"})]}),e.fromPinnedList&&r.jsx("span",{className:"index-pinned-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&r.jsx("span",{className:"index-featured-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})})]})}),r.jsx("hr",{className:"index-li-divider"})]})}class H{imgE;id;widthResizeObserver;animationBeforeStart;constructor(t,n=-1,i=!1,s,l){this.imgE=t,this.id=T(t,"alt")??void 0,this.animationBeforeStart=s,t.complete?(h("Image complete "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)):t.onload=()=>{h("Image onload "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n),t.onerror=()=>{n!=-1&&this.setImageHeight(t,n)}},i&&(this.widthResizeObserver=new Y(t,o=>{h("Image widthResizeObserver "+this.id+", width = "+o),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)})),t.addEventListener("transitionend",()=>{h("Image transitionend "+this.id),this.animationDone(i,t,l)}),t.addEventListener("animationcancel",()=>{h("Image animationcancel "+this.id),this.animationDone(i,t,l)})}animationDone(t,n,i){t||(I(n,"image-height-animation",!1),n.style.height="auto"),i?.()}setImageHeight(t,n){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){h("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),I(t,"image-height-animation",!1),t.style.height="auto";return}const i=t.width/n;h("SetImageHeight = "+i+", "+this.id),t.style.height=i+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function K(e,t){if(e==null)return{};var n=X(e,t),i,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(s=0;s<l.length;s++)i=l[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function X(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,l;for(l=0;l<i.length;l++)s=i[l],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},C.apply(this,arguments)}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(i){J(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Q={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},P=2;class A extends b.Component{constructor(t){super(t),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||P,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const t=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||P});let i=1/0,s=n.default||P;for(let l in n){const o=parseInt(l);o>0&&t<=o&&o<i&&(i=o,s=n[l])}s=Math.max(1,parseInt(s)||1),this.state.columnCount!==s&&this.setState({columnCount:s})}itemsInColumns(){const t=this.state.columnCount,n=new Array(t),i=b.Children.toArray(this.props.children);for(let s=0;s<i.length;s++){const l=s%t;n[l]||(n[l]=[]),n[l].push(i[s])}return n}renderColumns(){const{column:t,columnAttrs:n={},columnClassName:i}=this.props,s=this.itemsInColumns(),l=`${100/s.length}%`;let o=i;o&&typeof o!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof o>"u"&&(o="my-masonry-grid_column"));const a=y(y(y({},t),n),{},{style:y(y({},n.style),{},{width:l}),className:o});return s.map((c,u)=>b.createElement("div",C({},a,{key:u}),c))}logDeprecated(t){console.error("[Masonry]",t)}render(){const t=this.props,{children:n,breakpointCols:i,columnClassName:s,columnAttrs:l,column:o,className:a}=t,c=K(t,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let u=a;return typeof a!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof a>"u"&&(u="my-masonry-grid")),b.createElement("div",C({},c,{className:u}),this.renderColumns())}}A.defaultProps=Q;function Z(e){const t=d.useMemo(()=>{const c={tag:e.tag,category:e.category};return new S(new L(c))},[]),n=d.useMemo(()=>new _(new W),[]),i=d.useSyncExternalStore(t.subscribe,()=>t.state);d.useSyncExternalStore(n.subscribe,()=>n.state);const s=d.useMemo(()=>e.onMount,[e.onMount]);d.useEffect(()=>{h(`IndexGridLens useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(!1),s?.();const c=new O(()=>{t.loadMore(!1)}),u=()=>{c.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",u),()=>{h("IndexGridLens useEffect cleanup"),window.removeEventListener("scroll",u)}},[]);const l=d.useCallback(()=>{i.posts.length>0?t.loadMore(!0):t.load(!0)},[i.posts]),o=d.useMemo(()=>({default:3,600:2,350:1}),[]),a=d.useMemo(()=>i.posts.length==0?e.loadedPosts:i.posts,[i.posts]);return r.jsxs("ul",{className:"grid-index-ul",children:[r.jsxs(A,{breakpointCols:o,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[e.pinnedPosts.map((c,u)=>r.jsx(k,{index:u,title:c.title,actors:c.actors,date:c.date,path:c.path,cover:c.cover,last:!1,fromPinnedList:!0,pinned:!0,featured:c.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},c.path)),a.map((c,u)=>r.jsx(k,{index:u,title:c.title,actors:c.actors,date:c.date,path:c.path,cover:c.cover,last:u==a.length-1,fromPinnedList:!1,pinned:c.pinned,featured:c.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},c.path))]}),(i.loading||i.loadingHint!=null)&&r.jsx(N,{loading:i.loading,loadHint:i.loadingHint,onClickHint:l})]})}function k(e){const t=d.useRef(null);d.useEffect(()=>{g("IndexItem componentDidMount",e);const o=t.current,a=o.querySelector(".grid-index-card");j(a);const c=o.querySelector(".grid-index-cover.image-height-animation");let u=null;if(c!=null){const m=o.parentElement?.parentElement?.clientWidth??0,f=m>=950?3:2;h("IndexItem parentWidth="+m+" columnCount="+f),e.fromPinnedList&&e.index<6?setTimeout(()=>{u=n(c)},50*e.index):!e.fromPinnedList&&e.index+e.pinnedListSize<6?setTimeout(()=>{u=n(c)},50*(e.index+e.pinnedListSize)):u=n(c)}return a!=null&&x().observe(a),()=>{h("IndexItem componentWillUnmount "+e.title),u?.destroy(),a!=null&&x().unobserve(a)}},[]);function n(o){return new H(o,-1,!1,()=>window.scrollY<=0,()=>{e.coverLoadedCallback()})}const i=d.useMemo(()=>e.actors.join(" "),[e.actors]),s=d.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),l=d.useMemo(()=>M(e.date),[e.date]);return r.jsxs("li",{ref:t,className:"grid-index-li",children:[r.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:r.jsxs("section",{className:"lens-index-container",children:[r.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:i}),e.fromPinnedList&&e.pinned&&r.jsx("span",{className:"lens-index-pinned-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&r.jsx("span",{className:"lens-index-featured-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})}),r.jsx("div",{className:"lens-index-text-container",children:r.jsxs("span",{className:"lens-index-date",children:[l.year,l.month,"｜",i]})})]})}),!e.last&&r.jsx("hr",{className:"grid-index-li-divider"})]})}function ee(e){const t=d.useMemo(()=>{const a={tag:e.tag,category:e.category};return new S(new L(a))},[]),n=d.useSyncExternalStore(t.subscribe,()=>t.state),i=d.useMemo(()=>e.onMount,[e.onMount]);d.useEffect(()=>{h(`IndexGridPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(!1),i?.();const a=new O(()=>{t.loadMore(!1)}),c=()=>{a.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",c),()=>{h("IndexGridPosts useEffect cleanup"),window.removeEventListener("scroll",c)}},[]);const s=d.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),l=d.useMemo(()=>({default:2,600:1}),[]),o=d.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return r.jsx("ul",{className:"grid-index-ul",children:r.jsxs(A,{breakpointCols:l,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[e.pageDescriptionHtml!=null&&e.pageDescriptionHtml.length>0&&r.jsx(ne,{innerHtml:e.pageDescriptionHtml}),o.map((a,c)=>r.jsx(te,{index:c,title:a.title,author:a.author,actor:a.actors,date:a.date,path:a.path,description:a.description,cover:a.indexCover!=null&&a.indexCover.length>0?a.indexCover:a.cover,coverAlt:a.coverAlt,last:c==o.length-1},a.path)),(n.loading||n.loadingHint!=null)&&r.jsx("li",{className:"grid-index-li",children:r.jsx(N,{loading:n.loading,loadHint:n.loadingHint,onClickHint:s})})]})})}function te(e){const t=d.useRef(null);d.useEffect(()=>{g("IndexItem componentDidMount",e);const o=t.current,a=o.querySelector(".grid-index-card");j(a);const c=o.querySelector(".grid-index-cover.image-height-animation");let u=null;return c!=null&&(e.index<2?setTimeout(()=>{u=n(c)},50*e.index):u=n(c)),a!=null&&x().observe(a),()=>{h("IndexItem componentWillUnmount "+e.title),u?.destroy(),a!=null&&x().unobserve(a)}},[e.path]);function n(o){return new H(o,-1,!1,()=>window.scrollY<=0,()=>{})}const i=d.useMemo(()=>e.actor.join(" "),[e.actor]),s=d.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),l=d.useMemo(()=>M(e.date),[e.date]);return r.jsxs("li",{ref:t,className:"grid-index-li",children:[r.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:r.jsxs("section",{children:[e.cover!=null&&e.cover.length>0&&r.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:e.coverAlt}),e.cover==null||e.cover.length==0&&r.jsx("div",{style:{height:"0.5rem"}}),r.jsxs("div",{className:"grid-index-text-container",children:[r.jsx("h1",{className:"grid-index-title",children:e.title}),r.jsxs("div",{children:[r.jsxs("span",{className:"grid-index-date",children:[l.year,r.jsx("span",{className:"year",children:"年"}),l.month,r.jsx("span",{className:"month",children:"月"}),l.day,r.jsx("span",{className:"day",children:"日"})]}),r.jsxs("span",{className:"grid-index-author",children:[" ",i]})]}),r.jsx("p",{className:"grid-index-description",children:e.description})]})]})}),!e.last&&r.jsx("hr",{className:"grid-index-li-divider"})]})}function ne(e){const t=d.useRef(null);return d.useEffect(()=>{const n=t.current;g("IndexDescriptionItem useEffect",n);const i=n.querySelector(".grid-index-card");return i!=null&&x().observe(i),n.addEventListener("click",s=>{g("IndexDescriptionItem click event ",s.target);const l=s.target;l.classList.contains("tag-dialog-trigger")&&z(l)}),()=>{h("IndexDescriptionItem useEffect cleanup"),i!=null&&x().unobserve(i)}},[]),r.jsxs("li",{ref:t,className:"grid-index-li grid-index-li--description",children:[r.jsx("section",{className:"mdc-card grid-index-card card-fade-in",dangerouslySetInnerHTML:{__html:e.innerHtml}}),r.jsx("hr",{className:"grid-index-li-divider"})]})}function de(){B(()=>{ie()})}function ie(){const e=document.querySelector("#index-list-wrapper");if(e==null)return;const t=()=>{V(),le()},n=$.createRoot(e),i=F(window.location.pathname).identifier;if(h("Index category = "+i+", path = "+window.location.pathname),i!=G.identifier){if(e.classList.contains("index-list-wrapper")){const s=se(e);g("Index loaded local posts",s),n.render(r.jsx(U,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}else if(e.classList.contains("grid-index-list-wrapper")){const s=document.querySelector(".grid-index-li--description .grid-index-card");let l="";s!=null&&(l=s.innerHTML);const o=re(e);g("Index loaded local posts",o),n.render(r.jsx(ee,{tag:"",category:i,pinnedPosts:o[0],loadedPosts:o[1],onMount:t,pageDescriptionHtml:l}))}else if(e.classList.contains("lens-index-list-wrapper")){const s=oe(e);g("Index loaded local posts",s),n.render(r.jsx(Z,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}}}function se(e){const t=[],n=[];for(const s of e.querySelectorAll(".index-li")){const l=s.querySelector(".index-title").innerText,o=s.querySelector(".index-author").innerText,a=s.querySelector(".index-date").innerText,c=s.querySelector(".index-a").pathname,u=s.querySelector(".index-pinned-icon-container")!=null,m=s.querySelector(".index-featured-icon-container")!=null,f={title:l,date:a,moreDate:"",path:c,author:o,actors:[],mentions:[],location:"",description:"",cover:"",indexCover:"",coverAlt:"",tags:[],category:"",pinned:u,featured:m};u?t.push(f):n.push(f)}const i=new Array;return i.push(t),i.push(n),i}function oe(e){const t=[],n=[];for(const i of e.querySelectorAll(".grid-index-li")){const s=i.querySelector(".lens-index-date"),l=s.innerText.trim().split("｜");l[0].trim();const o=s.getAttribute("full-date")||"2000年01月01日",a=l[1].trim().split(" "),c=i.querySelector(".grid-index-cover"),u=c?.src,m=c?.alt,f=i.querySelector(".index-a").pathname,p=i.querySelector(".lens-index-pinned-icon-container")!=null,w=i.querySelector(".lens-index-featured-icon-container")!=null,v={title:l.join("｜"),date:o,moreDate:"",path:f,author:"",actors:a,mentions:[],location:"",description:"",cover:u,indexCover:"",coverAlt:m,tags:[],category:"",pinned:p,featured:w};p?t.push(v):n.push(v)}return[t,n]}function re(e){const t=[],n=[];for(const s of e.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const l=s.querySelector(".grid-index-title").innerText,o=s.querySelector(".grid-index-author").innerText.split(" "),a=s.querySelector(".grid-index-date").innerText.trim(),c=s.querySelector(".index-a").pathname,u=s.querySelector(".grid-index-description").innerText,m=s.querySelector(".grid-index-cover"),f=m?.src,p=m?.alt,w=s.querySelector(".index-pinned-icon-container")!=null,v=s.querySelector(".index-featured-icon-container")!=null,q={title:l,date:a,moreDate:"",path:c,author:"",actors:o,mentions:[],location:"",description:u,cover:f,indexCover:"",coverAlt:p,tags:[],category:"",pinned:w,featured:v};w?t.push(q):n.push(q)}const i=new Array;return i.push(t),i.push(n),i}const ae=844/295;function le(){for(const e of document.querySelectorAll(".index-top-card.card-fade-in"))I(e,"card-fade-in-start",!0);for(const e of document.querySelectorAll(".index-top-cover.image-height-animation")){const t=e;new H(t,ae,!0,()=>window.scrollY<=0,()=>{})}for(const e of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))j(e)}export{de as initIndex};

import{f as I,P as N,g as S,j as r,L as D,c as d,E as P,r as p,h as O,k as m,l as g,m as u,R as f,n as U,o as E,t as b,p as T,d as W,q as B,u as z,S as F}from"../blog-scaffold.js";import{S as k}from"./blog-ScrollLoader.js";class Y extends I{createPresenter(){return new N(this,!1)}componentDidMount(){super.componentDidMount(),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),S()}initScroll(){const e=new k(()=>{d("Index scroll should load"),this.state.loadHint!=P&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidUpdate(e,t,i){this.props.onUpdate!=null&&this.props.onUpdate()}render(){return r.jsxs("ul",{className:"index-ul",children:[this.props.pinnedPosts.map(e=>r.jsx(A,{title:e.title,author:e.author,date:e.date,description:e.description,path:e.path,fromPinnedList:!0,pinned:!0,featured:e.featured,last:!1},e.title+e.date)),this.state.posts.map((e,t)=>!e.hidden&&r.jsx(A,{title:e.title,author:e.author,date:e.date,description:e.description,path:e.path,fromPinnedList:!1,pinned:e.pinned,featured:e.featured,last:t==this.state.posts.length-1},e.path)),(this.state.loading||this.state.loadHint!=null)&&r.jsx(D,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})]})}}function A(n){const e=p.useRef(null),t=p.useRef(null),i=O(n.date);return p.useEffect(()=>{m("IndexItem component mounted",n);const s=e.current;return t.current=s.querySelector(".index-card"),new g(t.current),t.current!=null&&u().observe(t.current),()=>{d("IndexItem component unmount "+n.title),t.current!=null&&u().unobserve(t.current)}},[]),r.jsxs("li",{ref:e,className:"index-li",children:[r.jsx("a",{className:`index-a mdc-card index-card card-slide-in ${n.last?"list-last":""}`,href:n.path,children:r.jsxs("section",{children:[r.jsx("h1",{className:"index-title",children:n.title}),r.jsx("span",{className:"index-author",children:n.author}),r.jsxs("span",{className:"index-date",children:[i.year,r.jsx("span",{className:"year",children:"年"}),i.month,r.jsx("span",{className:"month",children:"月"}),i.day,r.jsx("span",{className:"day",children:"日"})]}),n.fromPinnedList&&r.jsx("span",{className:"index-pinned-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-light",children:"keep"})}),!n.fromPinnedList&&(n.pinned||n.featured)&&r.jsx("span",{className:"index-featured-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-light",children:"editor_choice"})})]})}),!n.last&&r.jsx("hr",{className:"index-li-divider"})]})}class le extends f.Component{containerRef=f.createRef();cardE=null;constructor(e){super(e)}componentDidMount(){m("IndexItemWithDescription componentDidMount",this.props);const e=this.containerRef.current;this.cardE=e.querySelector(".index-card"),new g(this.cardE),this.cardE!=null&&u().observe(this.cardE)}componentWillUnmount(){d("IndexItemWithDescription componentWillUnmount "+this.props.title),this.cardE!=null&&u().unobserve(this.cardE)}render(){return r.jsxs("li",{ref:this.containerRef,className:"index-li index-with-desc",children:[r.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:this.props.path,children:r.jsxs("section",{children:[r.jsx("h1",{className:"index-width-desc-title",children:this.props.title}),r.jsx("span",{className:"index-width-desc-desc",children:this.props.description})]})}),!this.props.last&&r.jsx("hr",{className:"index-li-divider"})]})}}class w{imgE;id;widthResizeObserver=null;animationBeforeStart=null;constructor(e,t=-1,i=!1,s=null,o=null){this.imgE=e,this.id=U(e,"alt"),this.animationBeforeStart=s,e.complete?(d("Image complete "+this.id+", "+e.width+" : "+e.height+", "+e.naturalWidth+" : "+e.naturalHeight),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t)):e.onload=()=>{d("Image onload "+this.id+", "+e.width+" : "+e.height+", "+e.naturalWidth+" : "+e.naturalHeight),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t),e.onerror=()=>{t!=-1&&this.setImageHeight(e,t)}},i&&(this.widthResizeObserver=new E(e,a=>{d("Image widthResizeObserver "+this.id+", width = "+a),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t)})),e.addEventListener("transitionend",()=>{d("Image transitionend "+this.id),this.animationDone(i,e,o)}),e.addEventListener("animationcancel",()=>{d("Image animationcancel "+this.id),this.animationDone(i,e,o)})}animationDone(e,t,i){e||(b(t,"image-height-animation",!1),t.style.height="auto"),i?.()}setImageHeight(e,t){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){d("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),b(e,"image-height-animation",!1),e.style.height="auto";return}const i=e.width/t;d("SetImageHeight = "+i+", "+this.id),e.style.height=i+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function $(n,e){if(n==null)return{};var t=G(n,e),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(s=0;s<o.length;s++)i=o[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}function G(n,e){if(n==null)return{};var t={},i=Object.keys(n),s,o;for(o=0;o<i.length;o++)s=i[o],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function C(){return C=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},C.apply(this,arguments)}function _(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function x(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_(Object(t),!0).forEach(function(i){J(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function J(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const K={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},v=2;class H extends f.Component{constructor(e){super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let t;this.props.breakpointCols&&this.props.breakpointCols.default?t=this.props.breakpointCols.default:t=parseInt(this.props.breakpointCols)||v,this.state={columnCount:t}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const e=window&&window.innerWidth||1/0;let t=this.props.breakpointCols;typeof t!="object"&&(t={default:parseInt(t)||v});let i=1/0,s=t.default||v;for(let o in t){const a=parseInt(o);a>0&&e<=a&&a<i&&(i=a,s=t[o])}s=Math.max(1,parseInt(s)||1),this.state.columnCount!==s&&this.setState({columnCount:s})}itemsInColumns(){const e=this.state.columnCount,t=new Array(e),i=f.Children.toArray(this.props.children);for(let s=0;s<i.length;s++){const o=s%e;t[o]||(t[o]=[]),t[o].push(i[s])}return t}renderColumns(){const{column:e,columnAttrs:t={},columnClassName:i}=this.props,s=this.itemsInColumns(),o=`${100/s.length}%`;let a=i;a&&typeof a!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof a>"u"&&(a="my-masonry-grid_column"));const l=x(x(x({},e),t),{},{style:x(x({},t.style),{},{width:o}),className:a});return s.map((c,h)=>f.createElement("div",C({},l,{key:h}),c))}logDeprecated(e){console.error("[Masonry]",e)}render(){const e=this.props,{children:t,breakpointCols:i,columnClassName:s,columnAttrs:o,column:a,className:l}=e,c=$(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let h=l;return typeof l!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof l>"u"&&(h="my-masonry-grid")),f.createElement("div",C({},c,{className:h}),this.renderColumns())}}H.defaultProps=K;class V extends I{constructor(e){super(e)}createPresenter(){return new N(this,!1)}initScroll(){const e=new k(()=>{d("Index scroll should check load more"),this.state.loadHint!=P&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidMount(){super.componentDidMount(),d("GridIndex componentDidMount"),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),S()}componentDidUpdate(e,t,i){d("GridIndex componentDidUpdate"),this.props.onUpdate!=null&&this.props.onUpdate()}render(){const e={default:2,600:1};return r.jsx("ul",{className:"grid-index-ul",children:r.jsxs(H,{breakpointCols:e,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[this.props.pageDescriptionHtml!=null&&this.props.pageDescriptionHtml.length>0&&r.jsx(Q,{innerHtml:this.props.pageDescriptionHtml}),this.state.posts.map((t,i)=>!t.pinned&&!t.hidden&&r.jsx(X,{index:i,title:t.title,author:t.author,actor:t.actor,date:t.date,path:t.path,description:t.description,cover:t.cover,coverAlt:t.coverAlt,last:i==this.state.posts.length-1,coverLoadedCallback:()=>{}},t.path)),(this.state.loading||this.state.loadHint!=null)&&r.jsx("li",{className:"grid-index-li",children:r.jsx(D,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})})]})})}}function X(n){const e=p.useRef(null);p.useEffect(()=>{m("IndexItem componentDidMount",n);const o=e.current,a=o.querySelector(".grid-index-card");new g(a);const l=o.querySelector(".grid-index-cover.image-height-animation");let c=null;return l!=null&&(c=new w(l,-1,!1,()=>window.scrollY<=0,()=>{n.coverLoadedCallback()})),a!=null&&u().observe(a),()=>{d("IndexItem componentWillUnmount "+n.title),c?.destroy(),a!=null&&u().unobserve(a)}},[]);const t=n.actor.join(" "),i=n.index==0?"card-fade-in":"card-slide-in-middle",s=O(n.date);return r.jsxs("li",{ref:e,className:"grid-index-li",children:[r.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+i,href:n.path,children:r.jsxs("section",{children:[n.cover!=null&&n.cover.length>0&&r.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:n.cover,alt:n.coverAlt}),n.cover==null||n.cover.length==0&&r.jsx("div",{style:{height:"0.5rem"}}),r.jsxs("div",{className:"grid-index-text-container",children:[r.jsx("h1",{className:"grid-index-title",children:n.title}),r.jsxs("div",{children:[r.jsxs("span",{className:"grid-index-date",children:[s.year,r.jsx("span",{className:"year",children:"年"}),s.month,r.jsx("span",{className:"month",children:"月"}),s.day,r.jsx("span",{className:"day",children:"日"})]}),r.jsxs("span",{className:"grid-index-author",children:[" ",t]})]}),r.jsx("p",{className:"grid-index-description",children:n.description})]})]})}),!n.last&&r.jsx("hr",{className:"grid-index-li-divider"})]})}function Q(n){const e=p.useRef(null);return p.useEffect(()=>{const t=e.current;m("IndexDescriptionItem componentDidMount",t);const i=t.querySelector(".grid-index-card");i!=null&&u().observe(i);const s=t.querySelectorAll(".tag-dialog-trigger");for(const o of s)T(o);return()=>{d("IndexDescriptionItem componentWillUnmount"),i!=null&&u().unobserve(i)}},[]),r.jsxs("li",{ref:e,className:"grid-index-li grid-index-li--description",children:[r.jsx("section",{className:"mdc-card grid-index-card card-fade-in",children:r.jsxs("div",{className:"grid-index-text-container",children:[r.jsxs("p",{children:["2021 年 08 月 08 日，我在博客里开辟这个分区来承载曾经在剧场看过的剧和拍过的剧照，以昆曲为主，使用",r.jsx("a",{href:"/post/original/2021/09/01/基于Jekyll实现博客文章-标签化.html",children:"标签"}),"把每一场演出按剧种、剧团、剧目、演员、剧场分类归档。这里每一篇文章既是记录也是分享，亲手按下快门捕捉到的舞台瞬间，如此美丽的戏妆油彩，不应该只我一人看到。"]}),r.jsxs("p",{children:["关于我与戏剧的渊源以及为什么会喜欢昆曲，参见之前的自述",r.jsx("a",{href:"/post/original/2019/05/18/槐安国内春生酒.html",children:"《槐安国内春生酒》"}),"，还有一些由看剧衍生的",r.jsx("a",{id:"chip_tag_看剧&碎碎念",className:"tag-dialog-trigger clickable-empty-link",children:"碎碎念"}),"。"]}),r.jsx("p",{children:"只是时常偷懒，日渐事繁，更新剧目不多，我会慢慢整理上传的。"}),r.jsxs("div",{style:{marginBottom:"0.2rem"},children:[r.jsx("a",{id:"chip_tag_看剧&杭州",className:"tag-dialog-trigger clickable-empty-link tag-link grid-index-description-tag",children:"@杭州"}),r.jsx("a",{id:"chip_tag_看剧&南京",className:"tag-dialog-trigger clickable-empty-link tag-link grid-index-description-tag",children:"@南京"}),r.jsx("a",{id:"chip_tag_看剧&上海",className:"tag-dialog-trigger clickable-empty-link tag-link grid-index-description-tag",children:"@上海"}),r.jsx("a",{className:"tag-link grid-index-description-tag",href:"/section/lens.html",target:"_self",children:"@透镜"}),r.jsx("a",{className:"tag-link grid-index-description-tag",href:"https://space.bilibili.com/11037907",target:"_blank",children:"@哔哩"})]})]})}),r.jsx("hr",{className:"grid-index-li-divider"})]})}class Z extends I{constructor(e){super(e)}createPresenter(){return new N(this,!1)}initScroll(){const e=new k(()=>{d("Index scroll should check load more"),this.state.loadHint!=P&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidMount(){super.componentDidMount(),d("LensIndex componentDidMount"),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),S()}componentDidUpdate(e,t,i){d("LensIndex componentDidUpdate"),this.props.onUpdate!=null&&this.props.onUpdate()}render(){const e={default:3,950:2,300:1};return r.jsxs("ul",{className:"grid-index-ul",children:[r.jsx(H,{breakpointCols:e,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:this.state.posts.map((t,i)=>!t.pinned&&!t.hidden&&r.jsx(ee,{index:i,title:t.title,actor:t.actor,date:t.date,path:t.path,cover:t.cover,last:i==this.state.posts.length-1,coverLoadedCallback:()=>{}},t.path))}),(this.state.loading||this.state.loadHint!=null)&&r.jsx(D,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})]})}}function ee(n){const e=p.useRef(null);p.useEffect(()=>{m("IndexItem componentDidMount",n);const s=e.current,o=s.querySelector(".grid-index-card");new g(o);const a=s.querySelector(".grid-index-cover.image-height-animation");let l=null;return a!=null&&(n.index<3?setInterval(()=>{l=new w(a,-1,!1,()=>window.scrollY<=0,()=>{n.coverLoadedCallback()})},50*(n.index+1)):l=new w(a,-1,!1,()=>window.scrollY<=0,()=>{n.coverLoadedCallback()})),o!=null&&u().observe(o),()=>{d("IndexItem componentWillUnmount "+n.title),l?.destroy(),o!=null&&u().unobserve(o)}},[]),n.actor.join(" ");const t=n.index==0?"card-fade-in":"card-slide-in-middle",i=O(n.date);return r.jsxs("li",{ref:e,className:"grid-index-li",children:[r.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+t,href:n.path,children:r.jsxs("section",{className:"lens-index-container",children:[r.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:n.cover}),r.jsx("div",{className:"lens-index-text-container",children:r.jsxs("div",{className:"lens-index-date",children:[i.year,i.month]})})]})}),!n.last&&r.jsx("hr",{className:"grid-index-li-divider"})]})}function de(){W(()=>{te()})}function te(){const n=document.querySelector("#index-list-wrapper");if(n==null)return;const e=B.createRoot(n),t=z(window.location.pathname).identifier;if(d("Index category = "+t+", path = "+window.location.pathname),t==F.identifier)return;const i=()=>{},s=()=>{se()};if(n.querySelectorAll(".index-ul").length>0){const o=ne(n);m("Index loaded posts",o),e.render(r.jsx(Y,{tag:"",category:t,pinnedPosts:o[0],loadedPosts:o[1],onMount:s,onUpdate:i}))}else if(n.querySelectorAll(".grid-index-ul").length>0){const o=document.querySelector(".grid-index-li--description");let a="";o!=null&&(a=o.innerHTML);const l=ie(n);m("Index loaded posts",l),e.render(r.jsx(V,{tag:"",category:t,pinnedPosts:l[0],loadedPosts:l[1],onMount:s,onUpdate:i,pageDescriptionHtml:a}))}else n.classList.contains("lens-index-list-wrapper")&&e.render(r.jsx(Z,{tag:"",category:"lens",pinnedPosts:[],loadedPosts:[],onMount:s,onUpdate:i}))}function ne(n){const e=[],t=[];for(const s of n.querySelectorAll(".index-li")){const o=s.querySelector(".index-title").innerText,a=s.querySelector(".index-author").innerText,l=s.querySelector(".index-date").innerText,c=s.querySelector(".index-a").pathname,h=s.querySelector(".index-pinned-icon-container")!=null,y=s.querySelector(".index-featured-icon-container")!=null,j={title:o,author:a,actor:[],date:l,mention:[],location:"",path:c,description:"",cover:"",coverAlt:"",pinned:h,featured:y,hidden:!1};h?e.push(j):t.push(j)}const i=new Array;return i.push(e),i.push(t),i}function ie(n){const e=[],t=[];for(const s of n.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const o=s.querySelector(".grid-index-title").innerText,a=s.querySelector(".grid-index-author").innerText.split(" "),l=s.querySelector(".grid-index-date").innerText.trim(),c=s.querySelector(".index-a").pathname,h=s.querySelector(".grid-index-description").innerText,y=s.querySelector(".grid-index-cover"),j=y?.src,R=y?.alt,L=s.querySelector(".index-pinned-icon-container")!=null,M=s.querySelector(".index-featured-icon-container")!=null,q={title:o,author:"",actor:a,mention:[],location:"",date:l,path:c,description:h,cover:j,coverAlt:R,pinned:L,featured:M,hidden:!1};L?e.push(q):t.push(q)}const i=new Array;return i.push(e),i.push(t),i}const re=844/295;function se(){for(const n of document.querySelectorAll(".index-top-card.card-fade-in"))b(n,"card-fade-in-start",!0);for(const n of document.querySelectorAll(".index-top-cover.image-height-animation")){const e=n;new w(e,re,!0,()=>window.scrollY<=0,()=>{})}for(const n of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))new g(n)}export{de as initIndex};

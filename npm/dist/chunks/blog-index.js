import{h as T,c as m,r as c,H as S,P as N,j as a,L,i as O,k as p,l as y,m as E,t as P,R as b,n as R,o as _,p as W,q as z,e as F,u as $,v as B,w as G,x as V}from"../blog-scaffold.js";function j(e){e!=null&&new T(e)}class U{callback;lastTimeout;lastWidth=-1;resizeObserver=new ResizeObserver(t=>{const n=t.pop();n.contentRect.width!=this.lastWidth&&n.contentRect.width!=0&&(this.lastWidth=n.contentRect.width,this.lastTimeout!=null&&clearTimeout(this.lastTimeout),this.lastTimeout=setTimeout(()=>{m("ResizeWidthObserver width changed after delay "+n.contentRect.width),this.callback(n.contentRect.width)},200))});constructor(t,n){this.lastWidth=t.clientWidth,this.callback=n,this.resizeObserver.observe(t)}destroy(){this.resizeObserver.disconnect()}}function Y(e){const t=c.useMemo(()=>{const r={tag:e.tag,category:e.category};return new S(new N(r))},[]),n=c.useSyncExternalStore(t.subscribe,()=>t.state);c.useEffect(()=>(m(`IndexLinearPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(),e.onMount!=null&&e.onMount(),()=>{m("IndexLinearPosts useEffect cleanup")}),[]);const i=c.useCallback(()=>{t.loadMore()},[]),s=c.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),o=c.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return a.jsxs("ul",{className:"index-ul",children:[e.pinnedPosts.map(r=>a.jsx(q,{title:r.title,author:r.author,date:r.date,description:r.description,path:r.path,fromPinnedList:!0,pinned:!0,featured:r.featured},r.title+r.date)),o.map((r,l)=>a.jsx(q,{title:r.title,author:r.author,date:r.date,description:r.description,path:r.path,fromPinnedList:!1,pinned:r.pinned,featured:r.featured},r.path)),a.jsx(L,{loading:n.loading,loadHint:n.loadingHint,onClickHint:s,onLoadMore:i})]})}function q(e){const t=c.useRef(null),n=c.useRef(null),i=c.useMemo(()=>O(e.date),[e.date]);return c.useEffect(()=>{p("IndexItem component mounted",e);const s=t.current;return n.current=s.querySelector(".index-card"),j(n.current),n.current!=null&&y().observe(n.current),()=>{m("IndexItem component unmount "+e.title),n.current!=null&&y().unobserve(n.current)}},[]),a.jsxs("li",{ref:t,className:"index-li",children:[a.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:e.path,children:a.jsxs("section",{children:[a.jsx("h1",{className:"index-title",children:e.title}),a.jsx("span",{className:"index-author",children:e.author}),a.jsxs("span",{className:"index-date",children:[i.year,a.jsx("span",{className:"year",children:"年"}),i.month,a.jsx("span",{className:"month",children:"月"}),i.day,a.jsx("span",{className:"day",children:"日"})]}),e.fromPinnedList&&a.jsx("span",{className:"index-pinned-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&a.jsx("span",{className:"index-featured-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})})]})}),a.jsx("hr",{className:"index-li-divider"})]})}class M{imgE;id;widthResizeObserver;animationBeforeStart;constructor(t,n=-1,i=!1,s,o){this.imgE=t,this.id=E(t,"alt")??void 0,this.animationBeforeStart=s,t.complete?(m("Image complete "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)):t.onload=()=>{m("Image onload "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n),t.onerror=()=>{n!=-1&&this.setImageHeight(t,n)}},i&&(this.widthResizeObserver=new U(t,u=>{m("Image widthResizeObserver "+this.id+", width = "+u),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)}));const r=()=>{m("Image transitionend "+this.id),this.animationDone(i,t,o),d()},l=()=>{m("Image animationcancel "+this.id),this.animationDone(i,t,o),d()},d=()=>{t.removeEventListener("transitionend",r),t.removeEventListener("animationcancel",l)};t.addEventListener("transitionend",r),t.addEventListener("animationcancel",l)}animationDone(t,n,i){t||(P(n,"image-height-animation",!1),n.style.height="auto"),i?.()}setImageHeight(t,n){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){m("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),P(t,"image-height-animation",!1),t.style.height="auto";return}const i=t.width/n;m("SetImageHeight = "+i+", "+this.id),t.style.height=i+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function K(e,t){if(e==null)return{};var n=X(e,t),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)i=o[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function X(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function w(){return w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},w.apply(this,arguments)}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D(Object(n),!0).forEach(function(i){J(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Q={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},I=2;class H extends b.Component{constructor(t){super(t),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||I,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const t=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||I});let i=1/0,s=n.default||I;for(let o in n){const r=parseInt(o);r>0&&t<=r&&r<i&&(i=r,s=n[o])}s=Math.max(1,parseInt(s)||1),this.state.columnCount!==s&&this.setState({columnCount:s})}itemsInColumns(){const t=this.state.columnCount,n=new Array(t),i=b.Children.toArray(this.props.children);for(let s=0;s<i.length;s++){const o=s%t;n[o]||(n[o]=[]),n[o].push(i[s])}return n}renderColumns(){const{column:t,columnAttrs:n={},columnClassName:i}=this.props,s=this.itemsInColumns(),o=`${100/s.length}%`;let r=i;r&&typeof r!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof r>"u"&&(r="my-masonry-grid_column"));const l=C(C(C({},t),n),{},{style:C(C({},n.style),{},{width:o}),className:r});return s.map((d,u)=>b.createElement("div",w({},l,{key:u}),d))}logDeprecated(t){console.error("[Masonry]",t)}render(){const t=this.props,{children:n,breakpointCols:i,columnClassName:s,columnAttrs:o,column:r,className:l}=t,d=K(t,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let u=l;return typeof l!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof l>"u"&&(u="my-masonry-grid")),b.createElement("div",w({},d,{className:u}),this.renderColumns())}}H.defaultProps=Q;function Z(e){const[t,n]=c.useState([]),i=c.useMemo(()=>{const h={tag:e.tag,category:e.category};return new S(new N(h))},[]),s=c.useMemo(()=>new R(new _),[]),o=c.useSyncExternalStore(i.subscribe,()=>i.state),r=c.useSyncExternalStore(s.subscribe,()=>s.state);c.useEffect(()=>{m(`IndexGridLens useEffect, tag: ${e.tag}, category: ${e.category}, filterTags: ${t.toString()} `),e.onMount!=null&&e.onMount();const h=W();return h.on("lensFilterChange",f=>{m("IndexGridLens receive lensFilterChange event, selectedTags = "+f.selectedTags.toString()),n(f.selectedTags)}),()=>{m("IndexGridLens useEffect cleanup"),h.off("lensFilterChange")}},[]);const l=c.useMemo(()=>({filters:{category:{any:["lens"]},tag:[...t]},sort:{"precise-date":"desc"}}),[t]);c.useEffect(()=>{t.length>0?(s.clear(),s.search(null,l)):(i.clear(),i.load())},[t]);const d=c.useCallback(()=>{t.length>0?s.loadMore():i.loadMore()},[t]),u=c.useCallback(()=>{t.length>0?r.posts.length>0?s.loadMore(!0):s.search(null,l,!0):o.posts.length>0?i.loadMore(!0):i.load(!0)},[o.posts,r.posts,t]),g=c.useMemo(()=>({default:3,600:2,350:1}),[]),x=c.useMemo(()=>t.length>0?r.posts:o.posts.length==0?e.loadedPosts:o.posts,[o.posts,r.posts,t]),v=c.useMemo(()=>t.length>0?{loading:r.loading,loadingHint:r.loadingHint}:{loading:o.loading,loadingHint:o.loadingHint},[o.loading,o.loadingHint,r.loading,r.loadingHint,t]);return a.jsxs("ul",{className:"grid-index-ul",children:[a.jsxs(H,{breakpointCols:g,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[t.length==0&&e.pinnedPosts.map((h,f)=>a.jsx(k,{index:f,title:h.title,actors:h.actors,date:h.date,path:h.path,cover:h.cover,last:!1,fromPinnedList:!0,pinned:!0,featured:h.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},h.path)),x.map((h,f)=>a.jsx(k,{index:f,title:h.title,actors:h.actors,date:h.date,path:h.path,cover:h.cover,last:f==x.length-1,fromPinnedList:!1,pinned:h.pinned,featured:h.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},h.path))]}),a.jsx(L,{loading:v.loading,loadHint:v.loadingHint,onClickHint:u,onLoadMore:d})]})}function k(e){const t=c.useRef(null);c.useEffect(()=>{p("IndexItem componentDidMount",e);const r=t.current,l=r.querySelector(".grid-index-card");j(l);const d=r.querySelector(".grid-index-cover.image-height-animation");let u=null;if(d!=null){const g=r.parentElement?.parentElement?.clientWidth??0,x=g>=950?3:2;m("IndexItem parentWidth="+g+" columnCount="+x),e.fromPinnedList&&e.index<6?setTimeout(()=>{u=n(d)},50*e.index):!e.fromPinnedList&&e.index+e.pinnedListSize<6?setTimeout(()=>{u=n(d)},50*(e.index+e.pinnedListSize)):u=n(d)}return y().observe(l),()=>{m("IndexItem componentWillUnmount "+e.title),u?.destroy(),l!=null&&y().unobserve(l)}},[]);function n(r){return new M(r,-1,!1,()=>window.scrollY<=0,()=>{e.coverLoadedCallback()})}const i=c.useMemo(()=>e.actors.join(" "),[e.actors]),s=c.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),o=c.useMemo(()=>O(e.date),[e.date]);return a.jsxs("li",{ref:t,className:"grid-index-li",children:[a.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:a.jsxs("section",{className:"lens-index-container",children:[a.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:i}),e.fromPinnedList&&e.pinned&&a.jsx("span",{className:"lens-index-pinned-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&a.jsx("span",{className:"lens-index-featured-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})}),a.jsx("div",{className:"lens-index-text-container",children:a.jsxs("span",{className:"lens-index-date",children:[o.year,o.month,"｜",i]})})]})}),!e.last&&a.jsx("hr",{className:"grid-index-li-divider"})]})}function ee(e){const t=c.useMemo(()=>{const l={tag:e.tag,category:e.category};return new S(new N(l))},[]),n=c.useSyncExternalStore(t.subscribe,()=>t.state);c.useEffect(()=>(m(`IndexGridPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(),e.onMount!=null&&e.onMount(),()=>{m("IndexGridPosts useEffect cleanup")}),[]);const i=c.useCallback(()=>{t.loadMore()},[]),s=c.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),o=c.useMemo(()=>({default:2,600:1}),[]),r=c.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return a.jsxs("ul",{className:"grid-index-ul",children:[a.jsxs(H,{breakpointCols:o,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[e.pageDescriptionHtml!=null&&e.pageDescriptionHtml.length>0&&a.jsx(ne,{innerHtml:e.pageDescriptionHtml}),r.map((l,d)=>a.jsx(te,{index:d,title:l.title,author:l.author,actor:l.actors,date:l.date,path:l.path,description:l.description,cover:l.indexCover!=null&&l.indexCover.length>0?l.indexCover:l.cover,coverAlt:l.coverAlt,last:d==r.length-1},l.path))]}),a.jsx(L,{loading:n.loading,loadHint:n.loadingHint,onClickHint:s,onLoadMore:i})]})}function te(e){const t=c.useRef(null);c.useEffect(()=>{p("IndexItem componentDidMount",e);const r=t.current,l=r.querySelector(".grid-index-card");j(l);const d=r.querySelector(".grid-index-cover.image-height-animation");let u=null;return d!=null&&(e.index<2?setTimeout(()=>{u=n(d)},50*e.index):u=n(d)),l!=null&&y().observe(l),()=>{m("IndexItem componentWillUnmount "+e.title),u?.destroy(),l!=null&&y().unobserve(l)}},[e.path]);function n(r){return new M(r,-1,!1,()=>window.scrollY<=0,()=>{})}const i=c.useMemo(()=>e.actor.join(" "),[e.actor]),s=c.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),o=c.useMemo(()=>O(e.date),[e.date]);return a.jsxs("li",{ref:t,className:"grid-index-li",children:[a.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:a.jsxs("section",{children:[e.cover!=null&&e.cover.length>0&&a.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:e.coverAlt}),e.cover==null||e.cover.length==0&&a.jsx("div",{style:{height:"0.5rem"}}),a.jsxs("div",{className:"grid-index-text-container",children:[a.jsx("h1",{className:"grid-index-title",children:e.title}),a.jsxs("div",{children:[a.jsxs("span",{className:"grid-index-date",children:[o.year,a.jsx("span",{className:"year",children:"年"}),o.month,a.jsx("span",{className:"month",children:"月"}),o.day,a.jsx("span",{className:"day",children:"日"})]}),a.jsxs("span",{className:"grid-index-author",children:[" ",i]})]}),a.jsx("p",{className:"grid-index-description",children:e.description})]})]})}),!e.last&&a.jsx("hr",{className:"grid-index-li-divider"})]})}function ne(e){const t=c.useRef(null);return c.useEffect(()=>{const n=t.current;p("IndexDescriptionItem useEffect",n);const i=n.querySelector(".grid-index-card");return i!=null&&y().observe(i),n.addEventListener("click",s=>{p("IndexDescriptionItem click event ",s.target);const o=s.target;o.classList.contains("tag-dialog-trigger")&&z(o)}),()=>{m("IndexDescriptionItem useEffect cleanup"),i!=null&&y().unobserve(i)}},[]),a.jsxs("li",{ref:t,className:"grid-index-li grid-index-li--description",children:[a.jsx("section",{className:"mdc-card grid-index-card card-fade-in",dangerouslySetInnerHTML:{__html:e.innerHtml}}),a.jsx("hr",{className:"grid-index-li-divider"})]})}function de(){F(()=>{ie()})}function ie(){const e=document.querySelector("#index-list-wrapper");if(e==null)return;const t=()=>{V(),le()},n=$.createRoot(e),i=B(window.location.pathname).identifier;if(m("Index category = "+i+", path = "+window.location.pathname),i!=G.identifier){if(e.classList.contains("index-list-wrapper")){const s=se(e);p("Index loaded local posts",s),n.render(a.jsx(Y,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}else if(e.classList.contains("grid-index-list-wrapper")){const s=document.querySelector(".grid-index-li--description .grid-index-card");let o="";s!=null&&(o=s.innerHTML);const r=ae(e);p("Index loaded local posts",r),n.render(a.jsx(ee,{tag:"",category:i,pinnedPosts:r[0],loadedPosts:r[1],onMount:t,pageDescriptionHtml:o}))}else if(e.classList.contains("lens-index-list-wrapper")){const s=re(e);p("Index loaded local posts",s),n.render(a.jsx(Z,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}}}function se(e){const t=[],n=[];for(const s of e.querySelectorAll(".index-li")){const o=s.querySelector(".index-title").innerText,r=s.querySelector(".index-author").innerText,l=s.querySelector(".index-date").innerText,d=s.querySelector(".index-a").pathname,u=s.querySelector(".index-pinned-icon-container")!=null,g=s.querySelector(".index-featured-icon-container")!=null,x={title:o,date:l,moreDate:"",path:d,author:r,actors:[],mentions:[],location:"",description:"",cover:"",indexCover:"",coverAlt:"",tags:[],category:"",pinned:u,featured:g};u?t.push(x):n.push(x)}const i=new Array;return i.push(t),i.push(n),i}function re(e){const t=[],n=[];for(const i of e.querySelectorAll(".grid-index-li")){const s=i.querySelector(".lens-index-date"),o=s.innerText.trim().split("｜");o[0].trim();const r=s.getAttribute("full-date")||"2000年01月01日",l=o[1].trim().split(" "),d=i.querySelector(".grid-index-cover"),u=d?.src,g=d?.alt,x=i.querySelector(".index-a").pathname,v=i.querySelector(".lens-index-pinned-icon-container")!=null,h=i.querySelector(".lens-index-featured-icon-container")!=null,f={title:o.join("｜"),date:r,moreDate:"",path:x,author:"",actors:l,mentions:[],location:"",description:"",cover:u,indexCover:"",coverAlt:g,tags:[],category:"",pinned:v,featured:h};v?t.push(f):n.push(f)}return[t,n]}function ae(e){const t=[],n=[];for(const s of e.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const o=s.querySelector(".grid-index-title").innerText,r=s.querySelector(".grid-index-author").innerText.split(" "),l=s.querySelector(".grid-index-date").innerText.trim(),d=s.querySelector(".index-a").pathname,u=s.querySelector(".grid-index-description").innerText,g=s.querySelector(".grid-index-cover"),x=g?.src,v=g?.alt,h=s.querySelector(".index-pinned-icon-container")!=null,f=s.querySelector(".index-featured-icon-container")!=null,A={title:o,date:l,moreDate:"",path:d,author:"",actors:r,mentions:[],location:"",description:u,cover:x,indexCover:"",coverAlt:v,tags:[],category:"",pinned:h,featured:f};h?t.push(A):n.push(A)}const i=new Array;return i.push(t),i.push(n),i}const oe=844/295;function le(){for(const e of document.querySelectorAll(".index-top-card.card-fade-in"))P(e,"card-fade-in-start",!0);for(const e of document.querySelectorAll(".index-top-cover.image-height-animation")){const t=e;new M(t,oe,!0,()=>window.scrollY<=0,()=>{})}for(const e of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))j(e)}export{de as initIndex};

import{h as R,c as m,r as c,H as L,P as M,j as o,L as O,i as A,k as v,l as p,m as _,t as N,R as S,n as W,o as F,p as $,q as B,e as G,u as V,v as U,w as Y,x as K,y as E}from"../blog-scaffold.js";function I(e){e!=null&&new R(e)}class X{callback;lastTimeout;lastWidth=-1;resizeObserver=new ResizeObserver(t=>{const n=t.pop();n.contentRect.width!=this.lastWidth&&n.contentRect.width!=0&&(this.lastWidth=n.contentRect.width,this.lastTimeout!=null&&clearTimeout(this.lastTimeout),this.lastTimeout=setTimeout(()=>{m("ResizeWidthObserver width changed after delay "+n.contentRect.width),this.callback(n.contentRect.width)},200))});constructor(t,n){this.lastWidth=t.clientWidth,this.callback=n,this.resizeObserver.observe(t)}destroy(){this.resizeObserver.disconnect()}}function J(e){const t=c.useMemo(()=>{const s={tag:e.tag,category:e.category};return new L(new M(s))},[]),n=c.useSyncExternalStore(t.subscribe,()=>t.state);c.useEffect(()=>(m(`IndexLinearPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(),e.onMount!=null&&e.onMount(),()=>{m("IndexLinearPosts useEffect cleanup")}),[]);const i=c.useCallback(()=>{t.loadMore()},[]),r=c.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),a=c.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return o.jsxs("ul",{className:"index-ul",children:[e.pinnedPosts.map(s=>o.jsx(D,{title:s.title,author:s.author,date:s.date,description:s.description,path:s.path,fromPinnedList:!0,pinned:!0,featured:s.featured},s.title+s.date)),a.map((s,l)=>o.jsx(D,{title:s.title,author:s.author,date:s.date,description:s.description,path:s.path,fromPinnedList:!1,pinned:s.pinned,featured:s.featured},s.path)),o.jsx(O,{loading:n.loading,loadHint:n.loadingHint,onClickHint:r,onLoadMore:i})]})}function D(e){const t=c.useRef(null),n=c.useRef(null),i=c.useMemo(()=>A(e.date),[e.date]);return c.useEffect(()=>{v("IndexItem component mounted",e);const r=t.current;return n.current=r.querySelector(".index-card"),I(n.current),n.current!=null&&p().observe(n.current),()=>{m("IndexItem component unmount "+e.title),n.current!=null&&p().unobserve(n.current)}},[]),o.jsxs("li",{ref:t,className:"index-li",children:[o.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:e.path,children:o.jsxs("section",{children:[o.jsx("h1",{className:"index-title",children:e.title}),o.jsx("span",{className:"index-author",children:e.author}),o.jsxs("span",{className:"index-date",children:[i.year,o.jsx("span",{className:"year",children:"年"}),i.month,o.jsx("span",{className:"month",children:"月"}),i.day,o.jsx("span",{className:"day",children:"日"})]}),e.fromPinnedList&&o.jsx("span",{className:"index-pinned-icon-container",children:o.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&o.jsx("span",{className:"index-featured-icon-container",children:o.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})})]})}),o.jsx("hr",{className:"index-li-divider"})]})}class H{imgE;id;widthResizeObserver;animationBeforeStart;constructor(t,n=-1,i=!1,r,a){this.imgE=t,this.id=_(t,"alt")??void 0,this.animationBeforeStart=r,t.complete?(m("Image complete "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)):t.onload=()=>{m("Image onload "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n),t.onerror=()=>{n!=-1&&this.setImageHeight(t,n)}},i&&(this.widthResizeObserver=new X(t,h=>{m("Image widthResizeObserver "+this.id+", width = "+h),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)}));const s=()=>{m("Image transitionend "+this.id),this.animationDone(i,t,a),d()},l=()=>{m("Image animationcancel "+this.id),this.animationDone(i,t,a),d()},d=()=>{t.removeEventListener("transitionend",s),t.removeEventListener("animationcancel",l)};t.addEventListener("transitionend",s),t.addEventListener("animationcancel",l)}animationDone(t,n,i){t||(N(n,"image-height-animation",!1),n.style.height="auto"),i?.()}setImageHeight(t,n){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){m("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),N(t,"image-height-animation",!1),t.style.height="auto";return}const i=t.width/n;m("SetImageHeight = "+i+", "+this.id),t.style.height=i+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function Q(e,t){if(e==null)return{};var n=Z(e,t),i,r;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)i=a[r],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function Z(e,t){if(e==null)return{};var n={},i=Object.keys(e),r,a;for(a=0;a<i.length;a++)r=i[a],!(t.indexOf(r)>=0)&&(n[r]=e[r]);return n}function j(){return j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},j.apply(this,arguments)}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(i){ee(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const te={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},P=2;class z extends S.Component{constructor(t){super(t),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||P,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const t=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||P});let i=1/0,r=n.default||P;for(let a in n){const s=parseInt(a);s>0&&t<=s&&s<i&&(i=s,r=n[a])}r=Math.max(1,parseInt(r)||1),this.state.columnCount!==r&&this.setState({columnCount:r})}itemsInColumns(){const t=this.state.columnCount,n=new Array(t),i=S.Children.toArray(this.props.children);for(let r=0;r<i.length;r++){const a=r%t;n[a]||(n[a]=[]),n[a].push(i[r])}return n}renderColumns(){const{column:t,columnAttrs:n={},columnClassName:i}=this.props,r=this.itemsInColumns(),a=`${100/r.length}%`;let s=i;s&&typeof s!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof s>"u"&&(s="my-masonry-grid_column"));const l=b(b(b({},t),n),{},{style:b(b({},n.style),{},{width:a}),className:s});return r.map((d,h)=>S.createElement("div",j({},l,{key:h}),d))}logDeprecated(t){console.error("[Masonry]",t)}render(){const t=this.props,{children:n,breakpointCols:i,columnClassName:r,columnAttrs:a,column:s,className:l}=t,d=Q(t,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let h=l;return typeof l!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof l>"u"&&(h="my-masonry-grid")),S.createElement("div",j({},d,{className:h}),this.renderColumns())}}z.defaultProps=te;function ne(e){const[t,n]=c.useState([]),i=c.useMemo(()=>{const u={tag:e.tag,category:e.category};return new L(new M(u))},[]),r=c.useMemo(()=>new W(new F),[]),a=c.useSyncExternalStore(i.subscribe,()=>i.state),s=c.useSyncExternalStore(r.subscribe,()=>r.state);c.useEffect(()=>{m(`IndexGridLens useEffect, tag: ${e.tag}, category: ${e.category}, filterTags: ${t.toString()} `),e.onMount!=null&&e.onMount();const u=$();return u.on("lensFilterChange",x=>{m("IndexGridLens receive lensFilterChange event, selectedTags = "+x.selectedTags.toString()),n(x.selectedTags)}),()=>{m("IndexGridLens useEffect cleanup"),u.off("lensFilterChange")}},[]);const l=c.useMemo(()=>({filters:{category:{any:["lens"]},tag:[...t]},sort:{"precise-date":"desc"}}),[t]);c.useEffect(()=>{t.length>0?(r.clear(),r.search(null,l)):(i.clear(),i.load())},[t]);const d=c.useCallback(()=>{t.length>0?r.loadMore():i.loadMore()},[t]),h=c.useCallback(()=>{t.length>0?s.posts.length>0?r.loadMore(!0):r.search(null,l,!0):a.posts.length>0?i.loadMore(!0):i.load(!0)},[a.posts,s.posts,t]),f=c.useMemo(()=>({default:3,600:2,350:1}),[]),g=c.useMemo(()=>t.length>0?s.posts:a.posts.length==0?e.loadedPosts:a.posts,[a.posts,s.posts,t]),y=c.useMemo(()=>t.length>0?{loading:s.loading,loadingHint:s.loadingHint}:{loading:a.loading,loadingHint:a.loadingHint},[a.loading,a.loadingHint,s.loading,s.loadingHint,t]);return o.jsxs("ul",{className:"grid-index-ul",children:[o.jsxs(z,{breakpointCols:f,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[t.length==0&&e.pinnedPosts.map((u,x)=>o.jsx(T,{index:x,title:u.title,actors:u.actors,date:u.date,path:u.path,cover:u.cover,coverSize:u.coverSize,last:!1,fromPinnedList:!0,pinned:!0,featured:u.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},u.path)),g.map((u,x)=>o.jsx(T,{index:x,title:u.title,actors:u.actors,date:u.date,path:u.path,cover:u.cover,coverSize:u.coverSize,last:x==g.length-1,fromPinnedList:!1,pinned:u.pinned,featured:u.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},u.path))]}),o.jsx(O,{loading:y.loading,loadHint:y.loadingHint,onClickHint:h,onLoadMore:d})]})}function T(e){const t=c.useRef(null);c.useEffect(()=>{v("IndexItem componentDidMount",e);const l=t.current,d=l.querySelector(".grid-index-card");I(d);const h=l.querySelector(".grid-index-cover.image-height-animation");let f=null;if(h!=null){const g=l.parentElement?.parentElement?.clientWidth??0,y=g>=950?3:2;m("IndexItem parentWidth="+g+" columnCount="+y),e.fromPinnedList&&e.index<6?setTimeout(()=>{f=n(h)},50*e.index):!e.fromPinnedList&&e.index+e.pinnedListSize<6?setTimeout(()=>{f=n(h)},50*(e.index+e.pinnedListSize)):f=n(h)}return p().observe(d),()=>{m("IndexItem componentWillUnmount "+e.title),f?.destroy(),d!=null&&p().unobserve(d)}},[]);function n(l){return new H(l,-1,!1,()=>window.scrollY<=0,()=>{e.coverLoadedCallback()})}const i=c.useMemo(()=>e.actors.join(" "),[e.actors]),r=c.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),a=c.useMemo(()=>A(e.date),[e.date]),s=c.useMemo(()=>{if(e.coverSize!=null&&e.coverSize.length==2)return e.coverSize[0]/e.coverSize[1]},[e.coverSize]);return o.jsxs("li",{ref:t,className:"grid-index-li",children:[o.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+r,href:e.path,children:o.jsxs("section",{className:"lens-index-container",children:[o.jsx("img",{className:"grid-index-cover",style:s?{aspectRatio:s}:{},loading:"lazy",src:e.cover,alt:i}),e.fromPinnedList&&e.pinned&&o.jsx("span",{className:"lens-index-pinned-icon-container",children:o.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&o.jsx("span",{className:"lens-index-featured-icon-container",children:o.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})}),o.jsx("div",{className:"lens-index-text-container",children:o.jsxs("span",{className:"lens-index-date",children:[a.year,a.month,"｜",i]})})]})}),!e.last&&o.jsx("hr",{className:"grid-index-li-divider"})]})}function ie(e){const t=c.useMemo(()=>{const l={tag:e.tag,category:e.category};return new L(new M(l))},[]),n=c.useSyncExternalStore(t.subscribe,()=>t.state);c.useEffect(()=>(m(`IndexGridPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(),e.onMount!=null&&e.onMount(),()=>{m("IndexGridPosts useEffect cleanup")}),[]);const i=c.useCallback(()=>{t.loadMore()},[]),r=c.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),a=c.useMemo(()=>({default:2,600:1}),[]),s=c.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return o.jsxs("ul",{className:"grid-index-ul",children:[o.jsxs(z,{breakpointCols:a,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[e.pageDescriptionHtml!=null&&e.pageDescriptionHtml.length>0&&o.jsx(se,{innerHtml:e.pageDescriptionHtml}),s.map((l,d)=>o.jsx(re,{index:d,title:l.title,author:l.author,actor:l.actors,date:l.date,path:l.path,description:l.description,cover:l.coverForIndex!=null&&l.coverForIndex.length>0?l.coverForIndex:l.cover,coverAlt:l.coverAlt,coverSize:l.coverSize,last:d==s.length-1},l.path))]}),o.jsx(O,{loading:n.loading,loadHint:n.loadingHint,onClickHint:r,onLoadMore:i})]})}function re(e){const t=c.useRef(null);c.useEffect(()=>{v("IndexItem componentDidMount",e);const l=t.current,d=l.querySelector(".grid-index-card");I(d);const h=l.querySelector(".grid-index-cover.image-height-animation");let f=null;return h!=null&&(e.index<2?setTimeout(()=>{f=n(h)},50*e.index):f=n(h)),d!=null&&p().observe(d),()=>{m("IndexItem componentWillUnmount "+e.title),f?.destroy(),d!=null&&p().unobserve(d)}},[e.path]);function n(l){return new H(l,-1,!1,()=>window.scrollY<=0,()=>{})}const i=c.useMemo(()=>e.actor.join(" "),[e.actor]),r=c.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),a=c.useMemo(()=>A(e.date),[e.date]),s=c.useMemo(()=>{if(e.coverSize!=null&&e.coverSize.length==2)return e.coverSize[0]/e.coverSize[1]},[e.coverSize]);return o.jsxs("li",{ref:t,className:"grid-index-li",children:[o.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+r,href:e.path,children:o.jsxs("section",{children:[e.cover!=null&&e.cover.length>0&&o.jsx("img",{className:"grid-index-cover image-height-animation",style:s?{aspectRatio:s}:{},loading:"lazy",src:e.cover,alt:e.coverAlt}),e.cover==null||e.cover.length==0&&o.jsx("div",{style:{height:"0.5rem"}}),o.jsxs("div",{className:"grid-index-text-container",children:[o.jsx("h1",{className:"grid-index-title",children:e.title}),o.jsxs("div",{children:[o.jsxs("span",{className:"grid-index-date",children:[a.year,o.jsx("span",{className:"year",children:"年"}),a.month,o.jsx("span",{className:"month",children:"月"}),a.day,o.jsx("span",{className:"day",children:"日"})]}),o.jsxs("span",{className:"grid-index-author",children:[" ",i]})]}),o.jsx("p",{className:"grid-index-description",children:e.description})]})]})}),!e.last&&o.jsx("hr",{className:"grid-index-li-divider"})]})}function se(e){const t=c.useRef(null);return c.useEffect(()=>{const n=t.current;v("IndexDescriptionItem useEffect",n);const i=n.querySelector(".grid-index-card");return i!=null&&p().observe(i),n.addEventListener("click",r=>{v("IndexDescriptionItem click event ",r.target);const a=r.target;a.classList.contains("tag-dialog-trigger")&&B(a)}),()=>{m("IndexDescriptionItem useEffect cleanup"),i!=null&&p().unobserve(i)}},[]),o.jsxs("li",{ref:t,className:"grid-index-li grid-index-li--description",children:[o.jsx("section",{className:"mdc-card grid-index-card card-fade-in",dangerouslySetInnerHTML:{__html:e.innerHtml}}),o.jsx("hr",{className:"grid-index-li-divider"})]})}function me(){G(()=>{oe()})}function oe(){const e=document.querySelector("#index-list-wrapper");if(e==null)return;const t=()=>{K(),ue()},n=V.createRoot(e),i=U(window.location.pathname).identifier;if(m("Index category = "+i+", path = "+window.location.pathname),i!=Y.identifier){if(e.classList.contains("index-list-wrapper")){const r=ae(e);v("Index loaded local posts",r),n.render(o.jsx(J,{tag:"",category:i,pinnedPosts:r[0],loadedPosts:r[1],onMount:t}))}else if(e.classList.contains("grid-index-list-wrapper")){const r=document.querySelector(".grid-index-li--description .grid-index-card");let a="";r!=null&&(a=r.innerHTML);const s=ce(e);v("Index loaded local posts",s),n.render(o.jsx(ie,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t,pageDescriptionHtml:a}))}else if(e.classList.contains("lens-index-list-wrapper")){const r=le(e);v("Index loaded local posts",r),n.render(o.jsx(ne,{tag:"",category:i,pinnedPosts:r[0],loadedPosts:r[1],onMount:t}))}}}function ae(e){const t=[],n=[];for(const r of e.querySelectorAll(".index-li")){const a=r.querySelector(".index-title").innerText,s=r.querySelector(".index-author").innerText,l=r.querySelector(".index-date").innerText,d=r.querySelector(".index-a").pathname,h=r.querySelector(".index-pinned-icon-container")!=null,f=r.querySelector(".index-featured-icon-container")!=null,g={title:a,date:l,moreDate:"",path:d,author:s,actors:[],mentions:[],location:"",description:"",cover:"",coverForIndex:"",coverAlt:"",tags:[],category:"",pinned:h,featured:f};h?t.push(g):n.push(g)}const i=new Array;return i.push(t),i.push(n),i}function le(e){const t=[],n=[];for(const i of e.querySelectorAll(".grid-index-li")){const r=i.querySelector(".lens-index-date"),a=r.innerText.trim().split("｜");a[0].trim();const s=r.getAttribute("full-date")||"2000年01月01日",l=a[1].trim().split(" "),d=i.querySelector(".grid-index-cover"),h=d?.src,f=d?.alt,g=d?.getAttribute("imageSize"),y=E(g),u=i.querySelector(".index-a").pathname,x=i.querySelector(".lens-index-pinned-icon-container")!=null,C=i.querySelector(".lens-index-featured-icon-container")!=null,w={title:a.join("｜"),date:s,moreDate:"",path:u,author:"",actors:l,mentions:[],location:"",description:"",cover:h,coverForIndex:"",coverAlt:f,coverSize:y,tags:[],category:"",pinned:x,featured:C};x?t.push(w):n.push(w)}return[t,n]}function ce(e){const t=[],n=[];for(const r of e.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const a=r.querySelector(".grid-index-title").innerText,s=r.querySelector(".grid-index-author").innerText.split(" "),l=r.querySelector(".grid-index-date").innerText.trim(),d=r.querySelector(".index-a").pathname,h=r.querySelector(".grid-index-description").innerText,f=r.querySelector(".grid-index-cover"),g=f?.src,y=f?.alt,u=f?.getAttribute("imageSize"),x=E(u),C=r.querySelector(".index-pinned-icon-container")!=null,w=r.querySelector(".index-featured-icon-container")!=null,q={title:a,date:l,moreDate:"",path:d,author:"",actors:s,mentions:[],location:"",description:h,cover:g,coverForIndex:"",coverAlt:y,coverSize:x,tags:[],category:"",pinned:C,featured:w};C?t.push(q):n.push(q)}const i=new Array;return i.push(t),i.push(n),i}const de=844/295;function ue(){for(const e of document.querySelectorAll(".index-top-card.card-fade-in"))N(e,"card-fade-in-start",!0);for(const e of document.querySelectorAll(".index-top-cover.image-height-animation")){const t=e;new H(t,de,!0,()=>window.scrollY<=0,()=>{})}for(const e of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))I(e)}export{me as initIndex};
//# sourceMappingURL=blog-index.js.map

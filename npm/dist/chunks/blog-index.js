import{h as W,c as d,i as N,P,k as L,l as O,j as s,L as D,E as H,r as h,m as k,n as f,o as p,R as g,p as U,t as S,q as _,e as z,u as B,v as F,w as Y}from"../blog-scaffold.js";function v(n){n!=null&&new W(n)}class G{callback;lastTimeout;lastWidth=-1;resizeObserver=new ResizeObserver(e=>{const t=e.pop();t.contentRect.width!=this.lastWidth&&t.contentRect.width!=0&&(this.lastWidth=t.contentRect.width,this.lastTimeout!=null&&clearTimeout(this.lastTimeout),this.lastTimeout=setTimeout(()=>{d("ResizeWidthObserver width changed after delay "+t.contentRect.width),this.callback(t.contentRect.width)},200))});constructor(e,t){this.lastWidth=e.clientWidth,this.callback=t,this.resizeObserver.observe(e)}destroy(){this.resizeObserver.disconnect()}}class $ extends N{createPresenter(){return new P(this,!1)}componentDidMount(){super.componentDidMount(),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),L()}initScroll(){const e=new O(()=>{d("Index scroll should load"),this.state.loadHint!=H&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidUpdate(e,t,i){this.props.onUpdate!=null&&this.props.onUpdate()}render(){return s.jsxs("ul",{className:"index-ul",children:[this.props.pinnedPosts.map(e=>s.jsx(M,{title:e.title,author:e.author,date:e.date,description:e.description,path:e.path,fromPinnedList:!0,pinned:!0,featured:e.featured},e.title+e.date)),this.state.posts.map((e,t)=>s.jsx(M,{title:e.title,author:e.author,date:e.date,description:e.description,path:e.path,fromPinnedList:!1,pinned:e.pinned,featured:e.featured},e.path)),(this.state.loading||this.state.loadHint!=null)&&s.jsx(D,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})]})}}function M(n){const e=h.useRef(null),t=h.useRef(null),i=h.useMemo(()=>k(n.date),[n.date]);return h.useEffect(()=>{f("IndexItem component mounted",n);const r=e.current;return t.current=r.querySelector(".index-card"),v(t.current),t.current!=null&&p().observe(t.current),()=>{d("IndexItem component unmount "+n.title),t.current!=null&&p().unobserve(t.current)}},[]),s.jsxs("li",{ref:e,className:"index-li",children:[s.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:n.path,children:s.jsxs("section",{children:[s.jsx("h1",{className:"index-title",children:n.title}),s.jsx("span",{className:"index-author",children:n.author}),s.jsxs("span",{className:"index-date",children:[i.year,s.jsx("span",{className:"year",children:"年"}),i.month,s.jsx("span",{className:"month",children:"月"}),i.day,s.jsx("span",{className:"day",children:"日"})]}),n.fromPinnedList&&s.jsx("span",{className:"index-pinned-icon-container",children:s.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!n.fromPinnedList&&(n.pinned||n.featured)&&s.jsx("span",{className:"index-featured-icon-container",children:s.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})})]})}),s.jsx("hr",{className:"index-li-divider"})]})}class de extends g.Component{containerRef=g.createRef();cardE;constructor(e){super(e)}componentDidMount(){f("IndexItemWithDescription componentDidMount",this.props);const e=this.containerRef.current;this.cardE=e.querySelector(".index-card"),v(this.cardE),this.cardE!=null&&p().observe(this.cardE)}componentWillUnmount(){d("IndexItemWithDescription componentWillUnmount "+this.props.title),this.cardE!=null&&p().unobserve(this.cardE)}render(){return s.jsxs("li",{ref:this.containerRef,className:"index-li index-with-desc",children:[s.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:this.props.path,children:s.jsxs("section",{children:[s.jsx("h1",{className:"index-width-desc-title",children:this.props.title}),s.jsx("span",{className:"index-width-desc-desc",children:this.props.description})]})}),s.jsx("hr",{className:"index-li-divider"})]})}}class q{imgE;id;widthResizeObserver;animationBeforeStart;constructor(e,t=-1,i=!1,r,o){this.imgE=e,this.id=U(e,"alt")??void 0,this.animationBeforeStart=r,e.complete?(d("Image complete "+this.id+", "+e.width+" : "+e.height+", "+e.naturalWidth+" : "+e.naturalHeight),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t)):e.onload=()=>{d("Image onload "+this.id+", "+e.width+" : "+e.height+", "+e.naturalWidth+" : "+e.naturalHeight),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t),e.onerror=()=>{t!=-1&&this.setImageHeight(e,t)}},i&&(this.widthResizeObserver=new G(e,a=>{d("Image widthResizeObserver "+this.id+", width = "+a),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t)})),e.addEventListener("transitionend",()=>{d("Image transitionend "+this.id),this.animationDone(i,e,o)}),e.addEventListener("animationcancel",()=>{d("Image animationcancel "+this.id),this.animationDone(i,e,o)})}animationDone(e,t,i){e||(S(t,"image-height-animation",!1),t.style.height="auto"),i?.()}setImageHeight(e,t){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){d("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),S(e,"image-height-animation",!1),e.style.height="auto";return}const i=e.width/t;d("SetImageHeight = "+i+", "+this.id),e.style.height=i+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function K(n,e){if(n==null)return{};var t=V(n,e),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}function V(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,o;for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function j(){return j=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},j.apply(this,arguments)}function T(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function y(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?T(Object(t),!0).forEach(function(i){X(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):T(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function X(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const J={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},I=2;class A extends g.Component{constructor(e){super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let t;this.props.breakpointCols&&this.props.breakpointCols.default?t=this.props.breakpointCols.default:t=parseInt(this.props.breakpointCols)||I,this.state={columnCount:t}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const e=window&&window.innerWidth||1/0;let t=this.props.breakpointCols;typeof t!="object"&&(t={default:parseInt(t)||I});let i=1/0,r=t.default||I;for(let o in t){const a=parseInt(o);a>0&&e<=a&&a<i&&(i=a,r=t[o])}r=Math.max(1,parseInt(r)||1),this.state.columnCount!==r&&this.setState({columnCount:r})}itemsInColumns(){const e=this.state.columnCount,t=new Array(e),i=g.Children.toArray(this.props.children);for(let r=0;r<i.length;r++){const o=r%e;t[o]||(t[o]=[]),t[o].push(i[r])}return t}renderColumns(){const{column:e,columnAttrs:t={},columnClassName:i}=this.props,r=this.itemsInColumns(),o=`${100/r.length}%`;let a=i;a&&typeof a!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof a>"u"&&(a="my-masonry-grid_column"));const l=y(y(y({},e),t),{},{style:y(y({},t.style),{},{width:o}),className:a});return r.map((c,u)=>g.createElement("div",j({},l,{key:u}),c))}logDeprecated(e){console.error("[Masonry]",e)}render(){const e=this.props,{children:t,breakpointCols:i,columnClassName:r,columnAttrs:o,column:a,className:l}=e,c=K(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let u=l;return typeof l!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof l>"u"&&(u="my-masonry-grid")),g.createElement("div",j({},c,{className:u}),this.renderColumns())}}A.defaultProps=J;class Q extends N{constructor(e){super(e)}createPresenter(){return new P(this,!1)}initScroll(){const e=new O(()=>{d("Index scroll should check load more"),this.state.loadHint!=H&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidMount(){super.componentDidMount(),d("GridIndex componentDidMount"),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),L()}componentDidUpdate(e,t,i){d("GridIndex componentDidUpdate"),this.props.onUpdate!=null&&this.props.onUpdate()}render(){const e={default:2,600:1};return s.jsx("ul",{className:"grid-index-ul",children:s.jsxs(A,{breakpointCols:e,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[this.props.pageDescriptionHtml!=null&&this.props.pageDescriptionHtml.length>0&&s.jsx(ee,{innerHtml:this.props.pageDescriptionHtml}),this.state.posts.map((t,i)=>s.jsx(Z,{index:i,title:t.title,author:t.author,actor:t.actor,date:t.date,path:t.path,description:t.description,cover:t.cover,coverAlt:t.coverAlt,last:i==this.state.posts.length-1,coverLoadedCallback:()=>{}},t.path)),(this.state.loading||this.state.loadHint!=null)&&s.jsx("li",{className:"grid-index-li",children:s.jsx(D,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})})]})})}}function Z(n){const e=h.useRef(null),t=h.useMemo(()=>n.coverLoadedCallback,[n.coverLoadedCallback]);h.useEffect(()=>{f("IndexItem componentDidMount",n);const l=e.current,c=l.querySelector(".grid-index-card");v(c);const u=l.querySelector(".grid-index-cover.image-height-animation");let m=null;return u!=null&&(n.index<2?setTimeout(()=>{m=i(u)},50*n.index):m=i(u)),c!=null&&p().observe(c),()=>{d("IndexItem componentWillUnmount "+n.title),m?.destroy(),c!=null&&p().unobserve(c)}},[n.path]);function i(l){return new q(l,-1,!1,()=>window.scrollY<=0,()=>{t()})}const r=h.useMemo(()=>n.actor.join(" "),[n.actor]),o=h.useMemo(()=>n.index==0?"card-fade-in":"card-slide-in-middle",[n.index]),a=h.useMemo(()=>k(n.date),[n.date]);return s.jsxs("li",{ref:e,className:"grid-index-li",children:[s.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+o,href:n.path,children:s.jsxs("section",{children:[n.cover!=null&&n.cover.length>0&&s.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:n.cover,alt:n.coverAlt}),n.cover==null||n.cover.length==0&&s.jsx("div",{style:{height:"0.5rem"}}),s.jsxs("div",{className:"grid-index-text-container",children:[s.jsx("h1",{className:"grid-index-title",children:n.title}),s.jsxs("div",{children:[s.jsxs("span",{className:"grid-index-date",children:[a.year,s.jsx("span",{className:"year",children:"年"}),a.month,s.jsx("span",{className:"month",children:"月"}),a.day,s.jsx("span",{className:"day",children:"日"})]}),s.jsxs("span",{className:"grid-index-author",children:[" ",r]})]}),s.jsx("p",{className:"grid-index-description",children:n.description})]})]})}),!n.last&&s.jsx("hr",{className:"grid-index-li-divider"})]})}function ee(n){const e=h.useRef(null);return h.useEffect(()=>{const t=e.current;f("IndexDescriptionItem useEffect",t);const i=t.querySelector(".grid-index-card");return i!=null&&p().observe(i),t.addEventListener("click",r=>{f("IndexDescriptionItem click event ",r.target);const o=r.target;o.classList.contains("tag-dialog-trigger")&&_(o)}),()=>{d("IndexDescriptionItem useEffect cleanup"),i!=null&&p().unobserve(i)}},[]),s.jsxs("li",{ref:e,className:"grid-index-li grid-index-li--description",children:[s.jsx("section",{className:"mdc-card grid-index-card card-fade-in",dangerouslySetInnerHTML:{__html:n.innerHtml}}),s.jsx("hr",{className:"grid-index-li-divider"})]})}class te extends N{constructor(e){super(e)}createPresenter(){return new P(this,!1)}initScroll(){const e=new O(()=>{d("Index scroll should check load more"),this.state.loadHint!=H&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidMount(){super.componentDidMount(),d("LensIndex componentDidMount"),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),L()}componentDidUpdate(e,t,i){d("LensIndex componentDidUpdate"),this.props.onUpdate!=null&&this.props.onUpdate()}render(){const e={default:3,600:2,350:1};return s.jsxs("ul",{className:"grid-index-ul",children:[s.jsxs(A,{breakpointCols:e,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[this.props.pinnedPosts.map((t,i)=>s.jsx(E,{index:i,title:t.title,actors:t.actor,date:t.date,path:t.path,cover:t.cover,last:!1,fromPinnedList:!0,pinned:!0,featured:t.featured,pinnedListSize:this.props.pinnedPosts.length,coverLoadedCallback:()=>{}},t.path)),this.state.posts.map((t,i)=>s.jsx(E,{index:i,title:t.title,actors:t.actor,date:t.date,path:t.path,cover:t.cover,last:i==this.state.posts.length-1,fromPinnedList:!1,pinned:t.pinned,featured:t.featured,pinnedListSize:this.props.pinnedPosts.length,coverLoadedCallback:()=>{}},t.path))]}),(this.state.loading||this.state.loadHint!=null)&&s.jsx(D,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})]})}}function E(n){const e=h.useRef(null);h.useEffect(()=>{f("IndexItem componentDidMount",n);const a=e.current,l=a.querySelector(".grid-index-card");v(l);const c=a.querySelector(".grid-index-cover.image-height-animation");let u=null;if(c!=null){const m=a.parentElement?.parentElement?.clientWidth??0,x=m>=950?3:2;d("IndexItem parentWidth="+m+" columnCount="+x),n.fromPinnedList&&n.index<6?setTimeout(()=>{u=t(c)},50*n.index):!n.fromPinnedList&&n.index+n.pinnedListSize<6?setTimeout(()=>{u=t(c)},50*(n.index+n.pinnedListSize)):u=t(c)}return l!=null&&p().observe(l),()=>{d("IndexItem componentWillUnmount "+n.title),u?.destroy(),l!=null&&p().unobserve(l)}},[]);function t(a){return new q(a,-1,!1,()=>window.scrollY<=0,()=>{n.coverLoadedCallback()})}const i=h.useMemo(()=>n.actors.join(" "),[n.actors]),r=h.useMemo(()=>n.index==0?"card-fade-in":"card-slide-in-middle",[n.index]),o=h.useMemo(()=>k(n.date),[n.date]);return s.jsxs("li",{ref:e,className:"grid-index-li",children:[s.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+r,href:n.path,children:s.jsxs("section",{className:"lens-index-container",children:[s.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:n.cover,alt:i}),n.fromPinnedList&&n.pinned&&s.jsx("span",{className:"lens-index-pinned-icon-container",children:s.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!n.fromPinnedList&&(n.pinned||n.featured)&&s.jsx("span",{className:"lens-index-featured-icon-container",children:s.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})}),s.jsxs("div",{className:"lens-index-text-container",children:[s.jsxs("span",{className:"lens-index-date",children:[o.year,o.month]}),n.actors.length>0&&n.actors.map((a,l)=>s.jsx("span",{className:"lens-index-date",children:a},l))]})]})}),!n.last&&s.jsx("hr",{className:"grid-index-li-divider"})]})}function ce(){z(()=>{ne()})}function ne(){const n=document.querySelector("#index-list-wrapper");if(n==null)return;const e=B.createRoot(n),t=F(window.location.pathname).identifier;if(d("Index category = "+t+", path = "+window.location.pathname),t!=Y.identifier){if(n.classList.contains("index-list-wrapper")){const i=ie(n);f("Index loaded posts",i),e.render(s.jsx($,{tag:"",category:t,pinnedPosts:i[0],loadedPosts:i[1],onMount:()=>{ae()},onUpdate:()=>{}}))}else if(n.classList.contains("grid-index-list-wrapper")){const i=document.querySelector(".grid-index-li--description .grid-index-card");let r="";i!=null&&(r=i.innerHTML);const o=re(n);f("Index loaded posts",o),e.render(s.jsx(Q,{tag:"",category:t,pinnedPosts:o[0],loadedPosts:o[1],onMount:()=>{},onUpdate:()=>{},pageDescriptionHtml:r}))}else if(n.classList.contains("lens-index-list-wrapper")){const i=se(n);f("Lens Index loaded posts",i),e.render(s.jsx(te,{tag:"",category:t,pinnedPosts:i[0],loadedPosts:i[1],onMount:()=>{},onUpdate:()=>{}}))}}}function ie(n){const e=[],t=[];for(const r of n.querySelectorAll(".index-li")){const o=r.querySelector(".index-title").innerText,a=r.querySelector(".index-author").innerText,l=r.querySelector(".index-date").innerText,c=r.querySelector(".index-a").pathname,u=r.querySelector(".index-pinned-icon-container")!=null,m=r.querySelector(".index-featured-icon-container")!=null,x={title:o,author:a,actor:[],date:l,mention:[],location:"",path:c,description:"",cover:"",coverAlt:"",pinned:u,featured:m};u?e.push(x):t.push(x)}const i=new Array;return i.push(e),i.push(t),i}function se(n){const e=[],t=[];for(const i of n.querySelectorAll(".grid-index-li")){const r=i.querySelector(".lens-index-date"),o=r.innerText.trim().split("｜");o[0].trim();const a=r.getAttribute("full-date")||"2000年01月01日",l=o[1].trim().split(" "),c=i.querySelector(".grid-index-cover"),u=c?.src,m=c?.alt,x=i.querySelector(".index-a").pathname,w=i.querySelector(".lens-index-pinned-icon-container")!=null,b=i.querySelector(".lens-index-featured-icon-container")!=null,C={title:o.join("｜"),author:"",actor:l,mention:[],location:"",date:a,path:x,description:"",cover:u,coverAlt:m,pinned:w,featured:b};w?e.push(C):t.push(C)}return[e,t]}function re(n){const e=[],t=[];for(const r of n.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const o=r.querySelector(".grid-index-title").innerText,a=r.querySelector(".grid-index-author").innerText.split(" "),l=r.querySelector(".grid-index-date").innerText.trim(),c=r.querySelector(".index-a").pathname,u=r.querySelector(".grid-index-description").innerText,m=r.querySelector(".grid-index-cover"),x=m?.src,w=m?.alt,b=r.querySelector(".index-pinned-icon-container")!=null,C=r.querySelector(".index-featured-icon-container")!=null,R={title:o,author:"",actor:a,mention:[],location:"",date:l,path:c,description:u,cover:x,coverAlt:w,pinned:b,featured:C};b?e.push(R):t.push(R)}const i=new Array;return i.push(e),i.push(t),i}const oe=844/295;function ae(){for(const n of document.querySelectorAll(".index-top-card.card-fade-in"))S(n,"card-fade-in-start",!0);for(const n of document.querySelectorAll(".index-top-cover.image-height-animation")){const e=n;new q(e,oe,!0,()=>window.scrollY<=0,()=>{})}for(const n of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))v(n)}export{ce as initIndex};

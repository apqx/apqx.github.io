import{h as k,c as m,r as c,H as S,P as L,j as r,L as N,i as M,k as O,l as y,m as w,n as R,t as P,R as b,o as _,p as W,q as z,u as F,e as $,v as B,w as G,x as V,y as Y}from"../blog-scaffold.js";function j(e){e!=null&&new k(e)}class U{callback;lastTimeout;lastWidth=-1;resizeObserver=new ResizeObserver(t=>{const n=t.pop();n.contentRect.width!=this.lastWidth&&n.contentRect.width!=0&&(this.lastWidth=n.contentRect.width,this.lastTimeout!=null&&clearTimeout(this.lastTimeout),this.lastTimeout=setTimeout(()=>{m("ResizeWidthObserver width changed after delay "+n.contentRect.width),this.callback(n.contentRect.width)},200))});constructor(t,n){this.lastWidth=t.clientWidth,this.callback=n,this.resizeObserver.observe(t)}destroy(){this.resizeObserver.disconnect()}}function K(e){const t=c.useMemo(()=>{const o={tag:e.tag,category:e.category};return new S(new L(o))},[]),n=c.useSyncExternalStore(t.subscribe,()=>t.state),i=c.useMemo(()=>e.onMount,[e.onMount]);c.useEffect(()=>{m(`IndexLinearPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(!1),i?.();const o=new M(()=>{t.loadMore(!1)}),l=()=>{o.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",l),()=>{m("IndexLinearPosts useEffect cleanup"),window.removeEventListener("scroll",l)}},[]);const s=c.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),a=c.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return r.jsxs("ul",{className:"index-ul",children:[e.pinnedPosts.map(o=>r.jsx(q,{title:o.title,author:o.author,date:o.date,description:o.description,path:o.path,fromPinnedList:!0,pinned:!0,featured:o.featured},o.title+o.date)),a.map((o,l)=>r.jsx(q,{title:o.title,author:o.author,date:o.date,description:o.description,path:o.path,fromPinnedList:!1,pinned:o.pinned,featured:o.featured},o.path)),(n.loading||n.loadingHint!=null)&&r.jsx(N,{loading:n.loading,loadHint:n.loadingHint,onClickHint:s})]})}function q(e){const t=c.useRef(null),n=c.useRef(null),i=c.useMemo(()=>O(e.date),[e.date]);return c.useEffect(()=>{y("IndexItem component mounted",e);const s=t.current;return n.current=s.querySelector(".index-card"),j(n.current),n.current!=null&&w().observe(n.current),()=>{m("IndexItem component unmount "+e.title),n.current!=null&&w().unobserve(n.current)}},[]),r.jsxs("li",{ref:t,className:"index-li",children:[r.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:e.path,children:r.jsxs("section",{children:[r.jsx("h1",{className:"index-title",children:e.title}),r.jsx("span",{className:"index-author",children:e.author}),r.jsxs("span",{className:"index-date",children:[i.year,r.jsx("span",{className:"year",children:"年"}),i.month,r.jsx("span",{className:"month",children:"月"}),i.day,r.jsx("span",{className:"day",children:"日"})]}),e.fromPinnedList&&r.jsx("span",{className:"index-pinned-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&r.jsx("span",{className:"index-featured-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})})]})}),r.jsx("hr",{className:"index-li-divider"})]})}class H{imgE;id;widthResizeObserver;animationBeforeStart;constructor(t,n=-1,i=!1,s,a){this.imgE=t,this.id=R(t,"alt")??void 0,this.animationBeforeStart=s,t.complete?(m("Image complete "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)):t.onload=()=>{m("Image onload "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n),t.onerror=()=>{n!=-1&&this.setImageHeight(t,n)}},i&&(this.widthResizeObserver=new U(t,o=>{m("Image widthResizeObserver "+this.id+", width = "+o),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)})),t.addEventListener("transitionend",()=>{m("Image transitionend "+this.id),this.animationDone(i,t,a)}),t.addEventListener("animationcancel",()=>{m("Image animationcancel "+this.id),this.animationDone(i,t,a)})}animationDone(t,n,i){t||(P(n,"image-height-animation",!1),n.style.height="auto"),i?.()}setImageHeight(t,n){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){m("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),P(t,"image-height-animation",!1),t.style.height="auto";return}const i=t.width/n;m("SetImageHeight = "+i+", "+this.id),t.style.height=i+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function X(e,t){if(e==null)return{};var n=J(e,t),i,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)i=a[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function J(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,a;for(a=0;a<i.length;a++)s=i[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},C.apply(this,arguments)}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D(Object(n),!0).forEach(function(i){Q(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Z={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},I=2;class E extends b.Component{constructor(t){super(t),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||I,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const t=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||I});let i=1/0,s=n.default||I;for(let a in n){const o=parseInt(a);o>0&&t<=o&&o<i&&(i=o,s=n[a])}s=Math.max(1,parseInt(s)||1),this.state.columnCount!==s&&this.setState({columnCount:s})}itemsInColumns(){const t=this.state.columnCount,n=new Array(t),i=b.Children.toArray(this.props.children);for(let s=0;s<i.length;s++){const a=s%t;n[a]||(n[a]=[]),n[a].push(i[s])}return n}renderColumns(){const{column:t,columnAttrs:n={},columnClassName:i}=this.props,s=this.itemsInColumns(),a=`${100/s.length}%`;let o=i;o&&typeof o!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof o>"u"&&(o="my-masonry-grid_column"));const l=v(v(v({},t),n),{},{style:v(v({},n.style),{},{width:a}),className:o});return s.map((d,h)=>b.createElement("div",C({},l,{key:h}),d))}logDeprecated(t){console.error("[Masonry]",t)}render(){const t=this.props,{children:n,breakpointCols:i,columnClassName:s,columnAttrs:a,column:o,className:l}=t,d=X(t,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let h=l;return typeof l!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof l>"u"&&(h="my-masonry-grid")),b.createElement("div",C({},d,{className:h}),this.renderColumns())}}E.defaultProps=Z;function ee(e){const[t,n]=c.useState([]),i=c.useMemo(()=>{const u={tag:e.tag,category:e.category};return new S(new L(u))},[]),s=c.useMemo(()=>new _(new W),[]),a=c.useSyncExternalStore(i.subscribe,()=>i.state),o=c.useSyncExternalStore(s.subscribe,()=>s.state),l=c.useMemo(()=>e.onMount,[e.onMount]);c.useEffect(()=>{m(`IndexGridLens useEffect, tag: ${e.tag}, category: ${e.category}, filterTags: ${t.toString()} `),i.load(!1),l?.();const u=z();return u.on("lensFilterChange",f=>{m("IndexGridLens receive lensFilterChange event, selectedTags = "+f.selectedTags.toString()),n(f.selectedTags)}),()=>{m("IndexGridLens useEffect cleanup"),u.off("lensFilterChange")}},[]),c.useEffect(()=>{const u=new M(()=>{t.length>0?s.loadMore(!1):i.loadMore(!1)}),f=()=>{u.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",f),()=>{window.removeEventListener("scroll",f)}},[t]);const d=c.useMemo(()=>({filters:{category:{any:["lens"]},tag:[...t]},sort:{"precise-date":"desc"}}),[t]);c.useEffect(()=>{t.length>0?(s.clear(),s.search(null,d,!0)):(i.clear(),i.load(!0))},[t]);const h=c.useCallback(()=>{t.length>0?o.posts.length>0?s.loadMore(!0):s.search(null,d,!0):a.posts.length>0?i.loadMore(!0):i.load(!0)},[a.posts,o.posts,t]),g=c.useMemo(()=>({default:3,600:2,350:1}),[]),x=c.useMemo(()=>t.length>0?o.posts:a.posts.length==0?e.loadedPosts:a.posts,[a.posts,o.posts,t]),p=c.useMemo(()=>t.length>0?{loading:o.loading,loadingHint:o.loadingHint}:{loading:a.loading,loadingHint:a.loadingHint},[a.loading,a.loadingHint,o.loading,o.loadingHint]);return r.jsxs("ul",{className:"grid-index-ul",children:[r.jsxs(E,{breakpointCols:g,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[t.length==0&&e.pinnedPosts.map((u,f)=>r.jsx(T,{index:f,title:u.title,actors:u.actors,date:u.date,path:u.path,cover:u.cover,last:!1,fromPinnedList:!0,pinned:!0,featured:u.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},u.path)),x.map((u,f)=>r.jsx(T,{index:f,title:u.title,actors:u.actors,date:u.date,path:u.path,cover:u.cover,last:f==x.length-1,fromPinnedList:!1,pinned:u.pinned,featured:u.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},u.path))]}),(p.loading||p.loadingHint!=null)&&r.jsx(N,{loading:p.loading,loadHint:p.loadingHint,onClickHint:h})]})}function T(e){const t=c.useRef(null);c.useEffect(()=>{y("IndexItem componentDidMount",e);const o=t.current,l=o.querySelector(".grid-index-card");j(l);const d=o.querySelector(".grid-index-cover.image-height-animation");let h=null;if(d!=null){const g=o.parentElement?.parentElement?.clientWidth??0,x=g>=950?3:2;m("IndexItem parentWidth="+g+" columnCount="+x),e.fromPinnedList&&e.index<6?setTimeout(()=>{h=n(d)},50*e.index):!e.fromPinnedList&&e.index+e.pinnedListSize<6?setTimeout(()=>{h=n(d)},50*(e.index+e.pinnedListSize)):h=n(d)}return l!=null&&w().observe(l),()=>{m("IndexItem componentWillUnmount "+e.title),h?.destroy(),l!=null&&w().unobserve(l)}},[]);function n(o){return new H(o,-1,!1,()=>window.scrollY<=0,()=>{e.coverLoadedCallback()})}const i=c.useMemo(()=>e.actors.join(" "),[e.actors]),s=c.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),a=c.useMemo(()=>O(e.date),[e.date]);return r.jsxs("li",{ref:t,className:"grid-index-li",children:[r.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:r.jsxs("section",{className:"lens-index-container",children:[r.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:i}),e.fromPinnedList&&e.pinned&&r.jsx("span",{className:"lens-index-pinned-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&r.jsx("span",{className:"lens-index-featured-icon-container",children:r.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})}),r.jsx("div",{className:"lens-index-text-container",children:r.jsxs("span",{className:"lens-index-date",children:[a.year,a.month,"｜",i]})})]})}),!e.last&&r.jsx("hr",{className:"grid-index-li-divider"})]})}function te(e){const t=c.useMemo(()=>{const l={tag:e.tag,category:e.category};return new S(new L(l))},[]),n=c.useSyncExternalStore(t.subscribe,()=>t.state),i=c.useMemo(()=>e.onMount,[e.onMount]);c.useEffect(()=>{m(`IndexGridPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(!1),i?.();const l=new M(()=>{t.loadMore(!1)}),d=()=>{l.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",d),()=>{m("IndexGridPosts useEffect cleanup"),window.removeEventListener("scroll",d)}},[]);const s=c.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),a=c.useMemo(()=>({default:2,600:1}),[]),o=c.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return r.jsx("ul",{className:"grid-index-ul",children:r.jsxs(E,{breakpointCols:a,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[e.pageDescriptionHtml!=null&&e.pageDescriptionHtml.length>0&&r.jsx(ie,{innerHtml:e.pageDescriptionHtml}),o.map((l,d)=>r.jsx(ne,{index:d,title:l.title,author:l.author,actor:l.actors,date:l.date,path:l.path,description:l.description,cover:l.indexCover!=null&&l.indexCover.length>0?l.indexCover:l.cover,coverAlt:l.coverAlt,last:d==o.length-1},l.path)),(n.loading||n.loadingHint!=null)&&r.jsx("li",{className:"grid-index-li",children:r.jsx(N,{loading:n.loading,loadHint:n.loadingHint,onClickHint:s})})]})})}function ne(e){const t=c.useRef(null);c.useEffect(()=>{y("IndexItem componentDidMount",e);const o=t.current,l=o.querySelector(".grid-index-card");j(l);const d=o.querySelector(".grid-index-cover.image-height-animation");let h=null;return d!=null&&(e.index<2?setTimeout(()=>{h=n(d)},50*e.index):h=n(d)),l!=null&&w().observe(l),()=>{m("IndexItem componentWillUnmount "+e.title),h?.destroy(),l!=null&&w().unobserve(l)}},[e.path]);function n(o){return new H(o,-1,!1,()=>window.scrollY<=0,()=>{})}const i=c.useMemo(()=>e.actor.join(" "),[e.actor]),s=c.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),a=c.useMemo(()=>O(e.date),[e.date]);return r.jsxs("li",{ref:t,className:"grid-index-li",children:[r.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:r.jsxs("section",{children:[e.cover!=null&&e.cover.length>0&&r.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:e.coverAlt}),e.cover==null||e.cover.length==0&&r.jsx("div",{style:{height:"0.5rem"}}),r.jsxs("div",{className:"grid-index-text-container",children:[r.jsx("h1",{className:"grid-index-title",children:e.title}),r.jsxs("div",{children:[r.jsxs("span",{className:"grid-index-date",children:[a.year,r.jsx("span",{className:"year",children:"年"}),a.month,r.jsx("span",{className:"month",children:"月"}),a.day,r.jsx("span",{className:"day",children:"日"})]}),r.jsxs("span",{className:"grid-index-author",children:[" ",i]})]}),r.jsx("p",{className:"grid-index-description",children:e.description})]})]})}),!e.last&&r.jsx("hr",{className:"grid-index-li-divider"})]})}function ie(e){const t=c.useRef(null);return c.useEffect(()=>{const n=t.current;y("IndexDescriptionItem useEffect",n);const i=n.querySelector(".grid-index-card");return i!=null&&w().observe(i),n.addEventListener("click",s=>{y("IndexDescriptionItem click event ",s.target);const a=s.target;a.classList.contains("tag-dialog-trigger")&&F(a)}),()=>{m("IndexDescriptionItem useEffect cleanup"),i!=null&&w().unobserve(i)}},[]),r.jsxs("li",{ref:t,className:"grid-index-li grid-index-li--description",children:[r.jsx("section",{className:"mdc-card grid-index-card card-fade-in",dangerouslySetInnerHTML:{__html:e.innerHtml}}),r.jsx("hr",{className:"grid-index-li-divider"})]})}function ue(){$(()=>{se()})}function se(){const e=document.querySelector("#index-list-wrapper");if(e==null)return;const t=()=>{Y(),ce()},n=B.createRoot(e),i=G(window.location.pathname).identifier;if(m("Index category = "+i+", path = "+window.location.pathname),i!=V.identifier){if(e.classList.contains("index-list-wrapper")){const s=oe(e);y("Index loaded local posts",s),n.render(r.jsx(K,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}else if(e.classList.contains("grid-index-list-wrapper")){const s=document.querySelector(".grid-index-li--description .grid-index-card");let a="";s!=null&&(a=s.innerHTML);const o=ae(e);y("Index loaded local posts",o),n.render(r.jsx(te,{tag:"",category:i,pinnedPosts:o[0],loadedPosts:o[1],onMount:t,pageDescriptionHtml:a}))}else if(e.classList.contains("lens-index-list-wrapper")){const s=re(e);y("Index loaded local posts",s),n.render(r.jsx(ee,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}}}function oe(e){const t=[],n=[];for(const s of e.querySelectorAll(".index-li")){const a=s.querySelector(".index-title").innerText,o=s.querySelector(".index-author").innerText,l=s.querySelector(".index-date").innerText,d=s.querySelector(".index-a").pathname,h=s.querySelector(".index-pinned-icon-container")!=null,g=s.querySelector(".index-featured-icon-container")!=null,x={title:a,date:l,moreDate:"",path:d,author:o,actors:[],mentions:[],location:"",description:"",cover:"",indexCover:"",coverAlt:"",tags:[],category:"",pinned:h,featured:g};h?t.push(x):n.push(x)}const i=new Array;return i.push(t),i.push(n),i}function re(e){const t=[],n=[];for(const i of e.querySelectorAll(".grid-index-li")){const s=i.querySelector(".lens-index-date"),a=s.innerText.trim().split("｜");a[0].trim();const o=s.getAttribute("full-date")||"2000年01月01日",l=a[1].trim().split(" "),d=i.querySelector(".grid-index-cover"),h=d?.src,g=d?.alt,x=i.querySelector(".index-a").pathname,p=i.querySelector(".lens-index-pinned-icon-container")!=null,u=i.querySelector(".lens-index-featured-icon-container")!=null,f={title:a.join("｜"),date:o,moreDate:"",path:x,author:"",actors:l,mentions:[],location:"",description:"",cover:h,indexCover:"",coverAlt:g,tags:[],category:"",pinned:p,featured:u};p?t.push(f):n.push(f)}return[t,n]}function ae(e){const t=[],n=[];for(const s of e.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const a=s.querySelector(".grid-index-title").innerText,o=s.querySelector(".grid-index-author").innerText.split(" "),l=s.querySelector(".grid-index-date").innerText.trim(),d=s.querySelector(".index-a").pathname,h=s.querySelector(".grid-index-description").innerText,g=s.querySelector(".grid-index-cover"),x=g?.src,p=g?.alt,u=s.querySelector(".index-pinned-icon-container")!=null,f=s.querySelector(".index-featured-icon-container")!=null,A={title:a,date:l,moreDate:"",path:d,author:"",actors:o,mentions:[],location:"",description:h,cover:x,indexCover:"",coverAlt:p,tags:[],category:"",pinned:u,featured:f};u?t.push(A):n.push(A)}const i=new Array;return i.push(t),i.push(n),i}const le=844/295;function ce(){for(const e of document.querySelectorAll(".index-top-card.card-fade-in"))P(e,"card-fade-in-start",!0);for(const e of document.querySelectorAll(".index-top-cover.image-height-animation")){const t=e;new H(t,le,!0,()=>window.scrollY<=0,()=>{})}for(const e of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))j(e)}export{ue as initIndex};

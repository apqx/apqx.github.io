import{e as S,P as O,f as D,j as s,L as N,c as l,E as P,R as c,g as f,h as w,k as u,l as q,m as R,t as C,n as M,b as T,o as U,p as E,S as W}from"../blog-scaffold.js";class L{timeMsIgnore;shouldLoad;lastLoadTime=0;constructor(e,t=50){this.shouldLoad=e,this.timeMsIgnore=t}onScroll(e,t,n){if(n-t-e<e){if(Date.now()-this.lastLoadTime<this.timeMsIgnore)return;this.shouldLoad(),this.lastLoadTime=Date.now()}}}class B extends S{createPresenter(){return new O(this,!1)}componentDidMount(){super.componentDidMount(),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),D()}initScroll(){const e=new L(()=>{l("Index scroll should load"),this.state.loadHint!=P&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidUpdate(e,t,n){this.props.onUpdate!=null&&this.props.onUpdate()}render(){return s.jsxs("ul",{className:"index-ul",children:[this.props.pinedPosts.map(e=>s.jsx(v,{title:e.title,author:e.author,date:e.date,description:e.description,path:e.path,pin:e.pin,last:!1},e.title+e.date)),this.state.posts.map((e,t)=>!e.hide&&s.jsx(v,{title:e.title,author:e.author,date:e.date,description:e.description,path:e.path,pin:!1,last:t==this.state.posts.length-1},e.path)),(this.state.loading||this.state.loadHint!=null)&&s.jsx(N,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})]})}}let v=class extends c.Component{containerRef=c.createRef();cardE=null;constructor(e){super(e)}componentDidMount(){f("IndexItem componentDidMount",this.props);const e=this.containerRef.current;this.cardE=e.querySelector(".index-card"),this.props.pin&&e.classList.add("index-li--pin"),new w(this.cardE),this.cardE!=null&&u().observe(this.cardE)}componentWillUnmount(){l("IndexItem componentWillUnmount "+this.props.title),this.cardE!=null&&u().unobserve(this.cardE)}render(){return s.jsxs("li",{ref:this.containerRef,className:"index-li",children:[s.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:this.props.path,children:s.jsxs("section",{children:[s.jsx("h1",{className:"index-title",children:this.props.title}),s.jsx("span",{className:"index-author",children:this.props.author}),s.jsx("span",{className:"index-date",children:this.props.date}),this.props.pin&&s.jsx("i",{className:"material-symbols-rounded-light index-pin-icon",children:"keep"})]})}),!this.props.last&&s.jsx("hr",{className:"index-li-divider"})]})}};class k{imgE;id;widthResizeObserver=null;animationBeforeStart=null;constructor(e,t=-1,n=!1,r=null,o=null){this.imgE=e,this.id=q(e,"alt"),this.animationBeforeStart=r,e.complete?(l("Image complete "+this.id+", "+e.width+" : "+e.height+", "+e.naturalWidth+" : "+e.naturalHeight),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t)):e.onload=()=>{l("Image onload "+this.id+", "+e.width+" : "+e.height+", "+e.naturalWidth+" : "+e.naturalHeight),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t),e.onerror=()=>{t!=-1&&this.setImageHeight(e,t)}},n&&(this.widthResizeObserver=new R(e,a=>{l("Image widthResizeObserver "+this.id+", width = "+a),t==-1&&(t=e.naturalWidth/e.naturalHeight),this.setImageHeight(e,t)})),e.addEventListener("transitionend",()=>{l("Image transitionend "+this.id),this.animationDone(n,e,o)}),e.addEventListener("animationcancel",()=>{l("Image animationcancel "+this.id),this.animationDone(n,e,o)})}animationDone(e,t,n){e||(C(t,"image-height-animation",!1),t.style.height="auto"),n?.()}setImageHeight(e,t){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){l("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),C(e,"image-height-animation",!1),e.style.height="auto";return}const n=e.width/t;l("SetImageHeight = "+n+", "+this.id),e.style.height=n+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function F(i,e){if(i==null)return{};var t=z(i,e),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}function z(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,o;for(o=0;o<n.length;o++)r=n[o],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function x(){return x=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},x.apply(this,arguments)}function I(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function g(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?I(Object(t),!0).forEach(function(n){Y(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function Y(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}const G={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},y=2;class A extends c.Component{constructor(e){super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let t;this.props.breakpointCols&&this.props.breakpointCols.default?t=this.props.breakpointCols.default:t=parseInt(this.props.breakpointCols)||y,this.state={columnCount:t}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const e=window&&window.innerWidth||1/0;let t=this.props.breakpointCols;typeof t!="object"&&(t={default:parseInt(t)||y});let n=1/0,r=t.default||y;for(let o in t){const a=parseInt(o);a>0&&e<=a&&a<n&&(n=a,r=t[o])}r=Math.max(1,parseInt(r)||1),this.state.columnCount!==r&&this.setState({columnCount:r})}itemsInColumns(){const e=this.state.columnCount,t=new Array(e),n=c.Children.toArray(this.props.children);for(let r=0;r<n.length;r++){const o=r%e;t[o]||(t[o]=[]),t[o].push(n[r])}return t}renderColumns(){const{column:e,columnAttrs:t={},columnClassName:n}=this.props,r=this.itemsInColumns(),o=`${100/r.length}%`;let a=n;a&&typeof a!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof a>"u"&&(a="my-masonry-grid_column"));const d=g(g(g({},e),t),{},{style:g(g({},t.style),{},{width:o}),className:a});return r.map((h,p)=>c.createElement("div",x({},d,{key:p}),h))}logDeprecated(e){console.error("[Masonry]",e)}render(){const e=this.props,{children:t,breakpointCols:n,columnClassName:r,columnAttrs:o,column:a,className:d}=e,h=F(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let p=d;return typeof d!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof d>"u"&&(p="my-masonry-grid")),c.createElement("div",x({},h,{className:p}),this.renderColumns())}}A.defaultProps=G;class $ extends S{constructor(e){super(e)}createPresenter(){return new O(this,!1)}initScroll(){const e=new L(()=>{l("Index scroll should check load more"),this.state.loadHint!=P&&this.loadMore()});window.addEventListener("scroll",()=>{e.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)})}componentDidMount(){super.componentDidMount(),l("GridIndex componentDidMount"),this.props.onUpdate!=null&&this.props.onUpdate(),this.initScroll(),D()}componentDidUpdate(e,t,n){l("GridIndex componentDidUpdate"),this.props.onUpdate!=null&&this.props.onUpdate()}render(){const e={default:2,600:1};return s.jsx("ul",{className:"grid-index-ul",children:s.jsxs(A,{breakpointCols:e,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[this.props.pageDescriptionHtml!=null&&this.props.pageDescriptionHtml.length>0&&s.jsx(K,{innerHtml:this.props.pageDescriptionHtml}),this.state.posts.map((t,n)=>!t.pin&&!t.hide&&s.jsx(J,{index:n,title:t.title,author:t.author,actor:t.actor,date:t.date,path:t.path,description:t.description,cover:t.cover,coverAlt:t.coverAlt,last:n==this.state.posts.length-1,coverLoadedCallback:()=>{}},t.path)),(this.state.loading||this.state.loadHint!=null)&&s.jsx("li",{className:"grid-index-li",children:s.jsx(N,{loading:this.state.loading,loadHint:this.state.loadHint,onClickHint:this.loadMoreByClick})})]})})}}class J extends c.Component{containerRef=c.createRef();imageLoadAnimator=null;cardE=null;constructor(e){super(e)}componentDidMount(){f("IndexItem componentDidMount",this.props);const e=this.containerRef.current;this.cardE=e.querySelector(".grid-index-card"),new w(e.querySelector(".grid-index-card__ripple"));const t=e.querySelector(".grid-index-cover.image-height-animation");t!=null&&(this.imageLoadAnimator=new k(t,-1,!1,()=>window.scrollY<=0,()=>{this.props.coverLoadedCallback()})),this.cardE!=null&&u().observe(this.cardE)}componentWillUnmount(){l("IndexItem componentWillUnmount "+this.props.title),this.imageLoadAnimator!=null&&this.imageLoadAnimator.destroy(),this.cardE!=null&&u().unobserve(this.cardE)}render(){const e=this.props.actor.join(" ");return s.jsxs("li",{ref:this.containerRef,className:"grid-index-li",children:[s.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple card-slide-in-middle",href:this.props.path,children:s.jsxs("section",{children:[this.props.cover!=null&&this.props.cover.length>0&&s.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:this.props.cover,alt:this.props.coverAlt}),this.props.cover==null||this.props.cover.length==0&&s.jsx("div",{style:{height:"0.5rem"}}),s.jsxs("div",{className:"grid-index-text-container",children:[s.jsx("h1",{className:"grid-index-title",children:this.props.title}),s.jsxs("div",{children:[s.jsxs("span",{className:"grid-index-date",children:[this.props.date," "]}),s.jsx("span",{className:"grid-index-author",children:e})]}),s.jsx("p",{className:"grid-index-description",children:this.props.description})]})]})}),!this.props.last&&s.jsx("hr",{className:"index-li-divider"})]})}}class K extends c.Component{containerRef=c.createRef();cardE=null;constructor(e){super(e)}componentDidMount(){const e=this.containerRef.current;f("IndexDescriptionItem componentDidMount",e);const t=e.querySelector(".grid-index-card");t!=null&&u().observe(t);const n=e.querySelectorAll(".tag-dialog-trigger");for(const r of n)M(r)}componentWillUnmount(){l("IndexDescriptionItem componentWillUnmount"),this.cardE!=null&&u().unobserve(this.cardE)}render(){return s.jsxs("li",{ref:this.containerRef,className:"grid-index-li grid-index-li--description",children:[s.jsx("section",{className:"mdc-card grid-index-card card-fade-in",children:s.jsxs("div",{className:"grid-index-text-container",children:[s.jsxs("p",{children:["2021年08月08日，我在博客里开辟这个分区来承载曾经在剧场看过的剧和拍过的剧照，以昆曲为主，使用",s.jsx("a",{href:"/post/original/2021/09/01/基于Jekyll实现博客文章-标签化.html",children:"标签"}),"把每一场演出按剧种、剧团、剧目、演员、剧场分类归档。这里每一篇文章既是记录也是分享，亲手按下快门捕捉到的舞台瞬间，如此美丽的戏妆油彩，不应该只我一人看到。"]}),s.jsxs("p",{children:["关于我与戏剧的渊源以及为什么会喜欢昆曲，参见之前的自述",s.jsx("a",{href:"/post/original/2019/05/18/槐安国内春生酒.html",children:"《槐安国内春生酒》"}),"，还有一些由看剧衍生的",s.jsx("a",{id:"chip_tag_看剧&碎碎念",className:"tag-dialog-trigger clickable-empty-link",children:"碎碎念"}),"。"]}),s.jsx("p",{children:"只是时常偷懒，日渐事繁，更新剧目不多，我会慢慢整理上传的。"}),s.jsxs("div",{style:{marginBottom:"0.2rem"},children:[s.jsx("a",{id:"chip_tag_看剧&杭州",className:"tag-dialog-trigger clickable-empty-link tag-link grid-index-description-tag",children:"@杭州"}),s.jsx("a",{id:"chip_tag_看剧&南京",className:"tag-dialog-trigger clickable-empty-link tag-link grid-index-description-tag",children:"@南京"}),s.jsx("a",{id:"chip_tag_看剧&上海",className:"tag-dialog-trigger clickable-empty-link tag-link grid-index-description-tag",children:"@上海"}),s.jsx("a",{className:"tag-link grid-index-description-tag",href:"https://space.bilibili.com/11037907",target:"_blank",children:"@哔哩"})]})]})}),s.jsx("hr",{className:"index-li-divider"})]})}}function ie(){T(()=>{V()})}function V(){const i=document.querySelector("#index-list-wrapper");if(i==null)return;const e=U.createRoot(i),t=E(window.location.pathname).identifier;if(l("Index category = "+t+", path = "+window.location.pathname),t==W.identifier)return;const n=()=>{},r=()=>{ee()};if(i.querySelectorAll(".index-ul").length>0){const o=X(i);f("Index loaded posts",o),e.render(s.jsx(B,{tag:"",category:t,pinedPosts:o[0],loadedPosts:o[1],onMount:r,onUpdate:n}))}else if(i.querySelectorAll(".grid-index-ul").length>0){const o=document.querySelector(".grid-index-li--description");let a="";o!=null&&(a=o.innerHTML);const d=Q(i);f("Index loaded posts",d),e.render(s.jsx($,{tag:"",category:t,pinedPosts:d[0],loadedPosts:d[1],onMount:r,onUpdate:n,pageDescriptionHtml:a}))}}function X(i){const e=[],t=[];for(const r of i.querySelectorAll(".index-li")){const o=r.querySelector(".index-title").innerText,a=r.querySelector(".index-author").innerText,d=r.querySelector(".index-date").innerText,h=r.querySelector(".index-a").pathname,p=r.classList.contains("index-li--pin"),m={title:o,author:a,actor:[],date:d,mention:[],path:h,description:"",cover:"",coverAlt:"",pin:p,hide:!1};p?e.push(m):t.push(m)}const n=new Array;return n.push(e),n.push(t),n}function Q(i){const e=[],t=[];for(const r of i.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const o=r.querySelector(".grid-index-title").innerText,a=r.querySelector(".grid-index-author").innerText.split(" "),d=r.querySelector(".grid-index-date").innerText.trim(),h=r.querySelector(".index-a").pathname,p=r.querySelector(".grid-index-description").innerText,m=r.querySelector(".grid-index-cover"),H=m?.src,_=m?.alt,b=r.classList.contains("grid-index-li--pin"),j={title:o,author:"",actor:a,mention:[],date:d,path:h,description:p,cover:H,coverAlt:_,pin:b,hide:!1};b?e.push(j):t.push(j)}const n=new Array;return n.push(e),n.push(t),n}const Z=844/295;function ee(){for(const i of document.querySelectorAll(".index-top-card.card-fade-in"))C(i,"card-fade-in-start",!0);for(const i of document.querySelectorAll(".index-top-cover.image-height-animation")){const e=i;new k(e,Z,!0,()=>window.scrollY<=0,()=>{})}for(const i of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))new w(i)}export{ie as initIndex};

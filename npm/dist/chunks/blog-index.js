import{h as k,c as m,r as l,H as S,P as L,j as a,L as N,i as O,k as H,l as p,m as y,n as R,t as P,R as b,o as _,p as W,q as z,u as F,e as $,v as B,w as G,x as V,y as Y}from"../blog-scaffold.js";function j(e){e!=null&&new k(e)}class U{callback;lastTimeout;lastWidth=-1;resizeObserver=new ResizeObserver(t=>{const n=t.pop();n.contentRect.width!=this.lastWidth&&n.contentRect.width!=0&&(this.lastWidth=n.contentRect.width,this.lastTimeout!=null&&clearTimeout(this.lastTimeout),this.lastTimeout=setTimeout(()=>{m("ResizeWidthObserver width changed after delay "+n.contentRect.width),this.callback(n.contentRect.width)},200))});constructor(t,n){this.lastWidth=t.clientWidth,this.callback=n,this.resizeObserver.observe(t)}destroy(){this.resizeObserver.disconnect()}}function K(e){const t=l.useMemo(()=>{const r={tag:e.tag,category:e.category};return new S(new L(r))},[]),n=l.useSyncExternalStore(t.subscribe,()=>t.state);l.useEffect(()=>{m(`IndexLinearPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(),e.onMount!=null&&e.onMount();const r=new O(()=>{t.loadMore()}),o=()=>{r.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",o),()=>{m("IndexLinearPosts useEffect cleanup"),window.removeEventListener("scroll",o)}},[]);const i=l.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),s=l.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return a.jsxs("ul",{className:"index-ul",children:[e.pinnedPosts.map(r=>a.jsx(q,{title:r.title,author:r.author,date:r.date,description:r.description,path:r.path,fromPinnedList:!0,pinned:!0,featured:r.featured},r.title+r.date)),s.map((r,o)=>a.jsx(q,{title:r.title,author:r.author,date:r.date,description:r.description,path:r.path,fromPinnedList:!1,pinned:r.pinned,featured:r.featured},r.path)),(n.loading||n.loadingHint!=null)&&a.jsx(N,{loading:n.loading,loadHint:n.loadingHint,onClickHint:i})]})}function q(e){const t=l.useRef(null),n=l.useRef(null),i=l.useMemo(()=>H(e.date),[e.date]);return l.useEffect(()=>{p("IndexItem component mounted",e);const s=t.current;return n.current=s.querySelector(".index-card"),j(n.current),n.current!=null&&y().observe(n.current),()=>{m("IndexItem component unmount "+e.title),n.current!=null&&y().unobserve(n.current)}},[]),a.jsxs("li",{ref:t,className:"index-li",children:[a.jsx("a",{className:"index-a mdc-card index-card card-slide-in",href:e.path,children:a.jsxs("section",{children:[a.jsx("h1",{className:"index-title",children:e.title}),a.jsx("span",{className:"index-author",children:e.author}),a.jsxs("span",{className:"index-date",children:[i.year,a.jsx("span",{className:"year",children:"年"}),i.month,a.jsx("span",{className:"month",children:"月"}),i.day,a.jsx("span",{className:"day",children:"日"})]}),e.fromPinnedList&&a.jsx("span",{className:"index-pinned-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&a.jsx("span",{className:"index-featured-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})})]})}),a.jsx("hr",{className:"index-li-divider"})]})}class M{imgE;id;widthResizeObserver;animationBeforeStart;constructor(t,n=-1,i=!1,s,r){this.imgE=t,this.id=R(t,"alt")??void 0,this.animationBeforeStart=s,t.complete?(m("Image complete "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)):t.onload=()=>{m("Image onload "+this.id+", "+t.width+" : "+t.height+", "+t.naturalWidth+" : "+t.naturalHeight),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n),t.onerror=()=>{n!=-1&&this.setImageHeight(t,n)}},i&&(this.widthResizeObserver=new U(t,o=>{m("Image widthResizeObserver "+this.id+", width = "+o),n==-1&&(n=t.naturalWidth/t.naturalHeight),this.setImageHeight(t,n)})),t.addEventListener("transitionend",()=>{m("Image transitionend "+this.id),this.animationDone(i,t,r)}),t.addEventListener("animationcancel",()=>{m("Image animationcancel "+this.id),this.animationDone(i,t,r)})}animationDone(t,n,i){t||(P(n,"image-height-animation",!1),n.style.height="auto"),i?.()}setImageHeight(t,n){if(this.animationBeforeStart!=null&&!this.animationBeforeStart()){m("ImageLoadAnimator animationBeforeStart returned false, not animating "+this.id),P(t,"image-height-animation",!1),t.style.height="auto";return}const i=t.width/n;m("SetImageHeight = "+i+", "+this.id),t.style.height=i+"px"}destroy(){this.widthResizeObserver!=null&&this.widthResizeObserver.destroy()}}function X(e,t){if(e==null)return{};var n=J(e,t),i,s;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)i=r[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function J(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,r;for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},C.apply(this,arguments)}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D(Object(n),!0).forEach(function(i){Q(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Z={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},I=2;class E extends b.Component{constructor(t){super(t),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||I,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const t=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||I});let i=1/0,s=n.default||I;for(let r in n){const o=parseInt(r);o>0&&t<=o&&o<i&&(i=o,s=n[r])}s=Math.max(1,parseInt(s)||1),this.state.columnCount!==s&&this.setState({columnCount:s})}itemsInColumns(){const t=this.state.columnCount,n=new Array(t),i=b.Children.toArray(this.props.children);for(let s=0;s<i.length;s++){const r=s%t;n[r]||(n[r]=[]),n[r].push(i[s])}return n}renderColumns(){const{column:t,columnAttrs:n={},columnClassName:i}=this.props,s=this.itemsInColumns(),r=`${100/s.length}%`;let o=i;o&&typeof o!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof o>"u"&&(o="my-masonry-grid_column"));const c=w(w(w({},t),n),{},{style:w(w({},n.style),{},{width:r}),className:o});return s.map((h,u)=>b.createElement("div",C({},c,{key:u}),h))}logDeprecated(t){console.error("[Masonry]",t)}render(){const t=this.props,{children:n,breakpointCols:i,columnClassName:s,columnAttrs:r,column:o,className:c}=t,h=X(t,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let u=c;return typeof c!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof c>"u"&&(u="my-masonry-grid")),b.createElement("div",C({},h,{className:u}),this.renderColumns())}}E.defaultProps=Z;function ee(e){const[t,n]=l.useState([]),i=l.useMemo(()=>{const d={tag:e.tag,category:e.category};return new S(new L(d))},[]),s=l.useMemo(()=>new _(new W),[]),r=l.useSyncExternalStore(i.subscribe,()=>i.state),o=l.useSyncExternalStore(s.subscribe,()=>s.state);l.useEffect(()=>{m(`IndexGridLens useEffect, tag: ${e.tag}, category: ${e.category}, filterTags: ${t.toString()} `),e.onMount!=null&&e.onMount();const d=z();return d.on("lensFilterChange",f=>{m("IndexGridLens receive lensFilterChange event, selectedTags = "+f.selectedTags.toString()),n(f.selectedTags)}),()=>{m("IndexGridLens useEffect cleanup"),d.off("lensFilterChange")}},[]),l.useEffect(()=>{const d=new O(()=>{t.length>0?s.loadMore():i.loadMore()}),f=()=>{d.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",f),()=>{window.removeEventListener("scroll",f)}},[t,r.posts,o.posts]);const c=l.useMemo(()=>({filters:{category:{any:["lens"]},tag:[...t]},sort:{"precise-date":"desc"}}),[t]);l.useEffect(()=>{t.length>0?(s.clear(),s.search(null,c)):(i.clear(),i.load())},[t]);const h=l.useCallback(()=>{t.length>0?o.posts.length>0?s.loadMore(!0):s.search(null,c,!0):r.posts.length>0?i.loadMore(!0):i.load(!0)},[r.posts,o.posts,t]),u=l.useMemo(()=>({default:3,600:2,350:1}),[]),x=l.useMemo(()=>t.length>0?o.posts:r.posts.length==0?e.loadedPosts:r.posts,[r.posts,o.posts,t]),g=l.useMemo(()=>t.length>0?{loading:o.loading,loadingHint:o.loadingHint}:{loading:r.loading,loadingHint:r.loadingHint},[r.loading,r.loadingHint,o.loading,o.loadingHint,t]);return a.jsxs("ul",{className:"grid-index-ul",children:[a.jsxs(E,{breakpointCols:u,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[t.length==0&&e.pinnedPosts.map((d,f)=>a.jsx(T,{index:f,title:d.title,actors:d.actors,date:d.date,path:d.path,cover:d.cover,last:!1,fromPinnedList:!0,pinned:!0,featured:d.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},d.path)),x.map((d,f)=>a.jsx(T,{index:f,title:d.title,actors:d.actors,date:d.date,path:d.path,cover:d.cover,last:f==x.length-1,fromPinnedList:!1,pinned:d.pinned,featured:d.featured,pinnedListSize:e.pinnedPosts.length,coverLoadedCallback:()=>{}},d.path))]}),(g.loading||g.loadingHint!=null)&&a.jsx(N,{loading:g.loading,loadHint:g.loadingHint,onClickHint:h})]})}function T(e){const t=l.useRef(null);l.useEffect(()=>{p("IndexItem componentDidMount",e);const o=t.current,c=o.querySelector(".grid-index-card");j(c);const h=o.querySelector(".grid-index-cover.image-height-animation");let u=null;if(h!=null){const x=o.parentElement?.parentElement?.clientWidth??0,g=x>=950?3:2;m("IndexItem parentWidth="+x+" columnCount="+g),e.fromPinnedList&&e.index<6?setTimeout(()=>{u=n(h)},50*e.index):!e.fromPinnedList&&e.index+e.pinnedListSize<6?setTimeout(()=>{u=n(h)},50*(e.index+e.pinnedListSize)):u=n(h)}return c!=null&&y().observe(c),()=>{m("IndexItem componentWillUnmount "+e.title),u?.destroy(),c!=null&&y().unobserve(c)}},[]);function n(o){return new M(o,-1,!1,()=>window.scrollY<=0,()=>{e.coverLoadedCallback()})}const i=l.useMemo(()=>e.actors.join(" "),[e.actors]),s=l.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),r=l.useMemo(()=>H(e.date),[e.date]);return a.jsxs("li",{ref:t,className:"grid-index-li",children:[a.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:a.jsxs("section",{className:"lens-index-container",children:[a.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:i}),e.fromPinnedList&&e.pinned&&a.jsx("span",{className:"lens-index-pinned-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"keep"})}),!e.fromPinnedList&&(e.pinned||e.featured)&&a.jsx("span",{className:"lens-index-featured-icon-container",children:a.jsx("i",{className:"material-symbols-rounded-variable",children:"editor_choice"})}),a.jsx("div",{className:"lens-index-text-container",children:a.jsxs("span",{className:"lens-index-date",children:[r.year,r.month,"｜",i]})})]})}),!e.last&&a.jsx("hr",{className:"grid-index-li-divider"})]})}function te(e){const t=l.useMemo(()=>{const o={tag:e.tag,category:e.category};return new S(new L(o))},[]),n=l.useSyncExternalStore(t.subscribe,()=>t.state);l.useEffect(()=>{m(`IndexGridPosts useEffect, tag: ${e.tag}, category: ${e.category}`),t.load(),e.onMount!=null&&e.onMount();const o=new O(()=>{t.loadMore()}),c=()=>{o.onScroll(document.body.clientHeight,window.scrollY,document.body.scrollHeight)};return window.addEventListener("scroll",c),()=>{m("IndexGridPosts useEffect cleanup"),window.removeEventListener("scroll",c)}},[]);const i=l.useCallback(()=>{n.posts.length>0?t.loadMore(!0):t.load(!0)},[n.posts]),s=l.useMemo(()=>({default:2,600:1}),[]),r=l.useMemo(()=>n.posts.length==0?e.loadedPosts:n.posts,[n.posts]);return a.jsx("ul",{className:"grid-index-ul",children:a.jsxs(E,{breakpointCols:s,className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:[e.pageDescriptionHtml!=null&&e.pageDescriptionHtml.length>0&&a.jsx(ie,{innerHtml:e.pageDescriptionHtml}),r.map((o,c)=>a.jsx(ne,{index:c,title:o.title,author:o.author,actor:o.actors,date:o.date,path:o.path,description:o.description,cover:o.indexCover!=null&&o.indexCover.length>0?o.indexCover:o.cover,coverAlt:o.coverAlt,last:c==r.length-1},o.path)),(n.loading||n.loadingHint!=null)&&a.jsx("li",{className:"grid-index-li",children:a.jsx(N,{loading:n.loading,loadHint:n.loadingHint,onClickHint:i})})]})})}function ne(e){const t=l.useRef(null);l.useEffect(()=>{p("IndexItem componentDidMount",e);const o=t.current,c=o.querySelector(".grid-index-card");j(c);const h=o.querySelector(".grid-index-cover.image-height-animation");let u=null;return h!=null&&(e.index<2?setTimeout(()=>{u=n(h)},50*e.index):u=n(h)),c!=null&&y().observe(c),()=>{m("IndexItem componentWillUnmount "+e.title),u?.destroy(),c!=null&&y().unobserve(c)}},[e.path]);function n(o){return new M(o,-1,!1,()=>window.scrollY<=0,()=>{})}const i=l.useMemo(()=>e.actor.join(" "),[e.actor]),s=l.useMemo(()=>e.index==0?"card-fade-in":"card-slide-in-middle",[e.index]),r=l.useMemo(()=>H(e.date),[e.date]);return a.jsxs("li",{ref:t,className:"grid-index-li",children:[a.jsx("a",{className:"index-a mdc-card grid-index-card grid-index-card__ripple "+s,href:e.path,children:a.jsxs("section",{children:[e.cover!=null&&e.cover.length>0&&a.jsx("img",{className:"grid-index-cover image-height-animation",loading:"lazy",src:e.cover,alt:e.coverAlt}),e.cover==null||e.cover.length==0&&a.jsx("div",{style:{height:"0.5rem"}}),a.jsxs("div",{className:"grid-index-text-container",children:[a.jsx("h1",{className:"grid-index-title",children:e.title}),a.jsxs("div",{children:[a.jsxs("span",{className:"grid-index-date",children:[r.year,a.jsx("span",{className:"year",children:"年"}),r.month,a.jsx("span",{className:"month",children:"月"}),r.day,a.jsx("span",{className:"day",children:"日"})]}),a.jsxs("span",{className:"grid-index-author",children:[" ",i]})]}),a.jsx("p",{className:"grid-index-description",children:e.description})]})]})}),!e.last&&a.jsx("hr",{className:"grid-index-li-divider"})]})}function ie(e){const t=l.useRef(null);return l.useEffect(()=>{const n=t.current;p("IndexDescriptionItem useEffect",n);const i=n.querySelector(".grid-index-card");return i!=null&&y().observe(i),n.addEventListener("click",s=>{p("IndexDescriptionItem click event ",s.target);const r=s.target;r.classList.contains("tag-dialog-trigger")&&F(r)}),()=>{m("IndexDescriptionItem useEffect cleanup"),i!=null&&y().unobserve(i)}},[]),a.jsxs("li",{ref:t,className:"grid-index-li grid-index-li--description",children:[a.jsx("section",{className:"mdc-card grid-index-card card-fade-in",dangerouslySetInnerHTML:{__html:e.innerHtml}}),a.jsx("hr",{className:"grid-index-li-divider"})]})}function ue(){$(()=>{se()})}function se(){const e=document.querySelector("#index-list-wrapper");if(e==null)return;const t=()=>{Y(),ce()},n=B.createRoot(e),i=G(window.location.pathname).identifier;if(m("Index category = "+i+", path = "+window.location.pathname),i!=V.identifier){if(e.classList.contains("index-list-wrapper")){const s=re(e);p("Index loaded local posts",s),n.render(a.jsx(K,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}else if(e.classList.contains("grid-index-list-wrapper")){const s=document.querySelector(".grid-index-li--description .grid-index-card");let r="";s!=null&&(r=s.innerHTML);const o=ae(e);p("Index loaded local posts",o),n.render(a.jsx(te,{tag:"",category:i,pinnedPosts:o[0],loadedPosts:o[1],onMount:t,pageDescriptionHtml:r}))}else if(e.classList.contains("lens-index-list-wrapper")){const s=oe(e);p("Index loaded local posts",s),n.render(a.jsx(ee,{tag:"",category:i,pinnedPosts:s[0],loadedPosts:s[1],onMount:t}))}}}function re(e){const t=[],n=[];for(const s of e.querySelectorAll(".index-li")){const r=s.querySelector(".index-title").innerText,o=s.querySelector(".index-author").innerText,c=s.querySelector(".index-date").innerText,h=s.querySelector(".index-a").pathname,u=s.querySelector(".index-pinned-icon-container")!=null,x=s.querySelector(".index-featured-icon-container")!=null,g={title:r,date:c,moreDate:"",path:h,author:o,actors:[],mentions:[],location:"",description:"",cover:"",indexCover:"",coverAlt:"",tags:[],category:"",pinned:u,featured:x};u?t.push(g):n.push(g)}const i=new Array;return i.push(t),i.push(n),i}function oe(e){const t=[],n=[];for(const i of e.querySelectorAll(".grid-index-li")){const s=i.querySelector(".lens-index-date"),r=s.innerText.trim().split("｜");r[0].trim();const o=s.getAttribute("full-date")||"2000年01月01日",c=r[1].trim().split(" "),h=i.querySelector(".grid-index-cover"),u=h?.src,x=h?.alt,g=i.querySelector(".index-a").pathname,d=i.querySelector(".lens-index-pinned-icon-container")!=null,f=i.querySelector(".lens-index-featured-icon-container")!=null,v={title:r.join("｜"),date:o,moreDate:"",path:g,author:"",actors:c,mentions:[],location:"",description:"",cover:u,indexCover:"",coverAlt:x,tags:[],category:"",pinned:d,featured:f};d?t.push(v):n.push(v)}return[t,n]}function ae(e){const t=[],n=[];for(const s of e.querySelectorAll(".grid-index-li:not(.grid-index-li--description)")){const r=s.querySelector(".grid-index-title").innerText,o=s.querySelector(".grid-index-author").innerText.split(" "),c=s.querySelector(".grid-index-date").innerText.trim(),h=s.querySelector(".index-a").pathname,u=s.querySelector(".grid-index-description").innerText,x=s.querySelector(".grid-index-cover"),g=x?.src,d=x?.alt,f=s.querySelector(".index-pinned-icon-container")!=null,v=s.querySelector(".index-featured-icon-container")!=null,A={title:r,date:c,moreDate:"",path:h,author:"",actors:o,mentions:[],location:"",description:u,cover:g,indexCover:"",coverAlt:d,tags:[],category:"",pinned:f,featured:v};f?t.push(A):n.push(A)}const i=new Array;return i.push(t),i.push(n),i}const le=844/295;function ce(){for(const e of document.querySelectorAll(".index-top-card.card-fade-in"))P(e,"card-fade-in-start",!0);for(const e of document.querySelectorAll(".index-top-cover.image-height-animation")){const t=e;new M(t,le,!0,()=>window.scrollY<=0,()=>{})}for(const e of document.querySelectorAll(".index-top-card,.grid-index-card__ripple"))j(e)}export{ue as initIndex};

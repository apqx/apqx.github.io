<!DOCTYPE html>
<html>

<head>
    <title>apqx.me</title>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="../../../css/materialize.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="../../../css/custom.css" media="screen,projection" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta name="theme-color" content="#ee6e73" />
    <link rel="shortcut icon" href="../../../apqx.ico" />
</head>

<body class="gray">

    <!-- nav-bar -->
    <div class="navbar-fixed">
        <nav class="light-red lighten-1">
            <!-- nav-tag -->
            <div class="nav-wrapper container">
                <a href="http://apqx.me" class="brand-logo">APQX</a>
                <a href="#" data-target="nav-mobile" class="sidenav-trigger">
                    <i class="material-icons">menu</i>
                </a>
                <ul class="right hide-on-med-and-down clear">
                    <li class="active">
                        <a class="waves-effect waves-effect" href="../../../index.html">随笔</a>
                    </li>
                    <li>
                        <a class="waves-effect waves-effect" href="../../share/html/index.html">转载</a>
                    </li>
                    <li>
                        <a class="waves-effect waves-effect modal-trigger" href="#about_me">关于我</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    <!-- pop-up-about-me -->
    <div id="about_me" class="modal container">
        <div class="modal-content">
            <center>
                <img height="100px" width="100dx" class="circle responsive-img" src="../../../assets/me.jpg" />
            </center>
            <center>
                <h4>APQX</h4>
            </center>
            <p class="flow-text center-align">野生散养攻城狮，努力晋级中。</p>
            <div class="collection">
                <a href="https://github.com/apqx" class="collection-item">GitHub</a>
                <a href="https://www.facebook.com/apqx.me" class="collection-item">Facebook</a>
                <a href="mailto:changgongapq@gmail.com" class="collection-item">changgongapq@gmail.com</a>
            </div>
        </div>
    </div>
    <!-- slide-to-show-nav-tag -->
    <ul id="nav-mobile" class="sidenav clear">
        <li class="active">
            <a class="waves-effect waves-red" href="../../../index.html">随笔</a>
        </li>
        <li>
            <a class="waves-effect waves-red" href="../../share/html/index.html">转载</a>
        </li>
        <li>
            <a class="waves-effect waves-red modal-trigger" href="#about_me">关于我</a>
        </li>
    </ul>
    <!-- parallax-slid-img -->
    <div class="parallax-container">
        <div class="parallax">
            <img src="../assets/raspberryBg.png">
        </div>
    </div>
    <!-- content-card -->
    <div class="container">
        <div class="card-panel hoverable">
            <!-- content -->
            <h1>树莓派遇上Java_05-摄像头篇</h1>
            <h2>APQX</h2>
            <h2>2016年9月15日</h2>
            <p>对于我来说，当然希望树莓派驱动的小车可以实时传输画面到控制器，这样才可以远程遥控嘛，一般将摄像头固定在一个两自由度云台上，使之可以自由旋转，拍摄各个方向的画面，具体的操作实现逻辑因人而异，但是基本的摄像头命令都是一样的。树莓派支持两种类型的摄像头，一种是普通USB摄像头（最好是免驱的），一种是树莓派专用的Pi
                Cam，都可以在淘宝上买到，后者的某些型号还具有红外线夜视功能，价格当然也高一些。这里以树莓派专用的Pi Cam为例，介绍摄像头的基本使用方法。</p>
            <p>
                <img class="materialboxed responsive-img" src="../assets/pi_cam.jpg" alt="pic">
            </p>
            <p>Pi Cam接在树莓派中部的CSI接口上，不需要额外供电，这里再次强烈建议为树莓派提供独立电源通过USB口供电而不要使用GPIO针脚供电，否则在摄像头开启的瞬间树莓派可能因为电压不稳而重启。</p>
            <p>在我的项目中，摄像头通过网络传输视频的原理是，使用MJPG-Streamer调用摄像头拍摄画面并将画面发送到指定的端口上，在浏览器里通过IP地址访问该端口即可显示实时画面。</p>
            <p>首先开启摄像头</p>
            <pre><code>sudo raspi-config
</code></pre>
            <p>简单的拍照指令</p>
            <pre><code>// 拍照并将照片旋转180度
raspistill -o image.jpg -rot 180
</code></pre>
            <p>安装依赖库</p>
            <pre><code>sudo apt-get install libjpeg62-dev
sudo apt-get install libjpeg8-dev
</code></pre>
            <p>下载
                <a href="https://github.com/jacksonliam/mjpg-streamer">MJPG-Streamer</a>
            </p>
            <p>解压</p>
            <pre><code>unzip mjpg-streamer-master.zip
</code></pre>
            <p>安装cmake</p>
            <pre><code>sudo apt-get install cmake
</code></pre>
            <p>切换到mjpg的路径下并编译</p>
            <pre><code>cd  ~/mjpg-streamer-master/mjpg-streamer-experimental
sudo make clean all
</code></pre>
            <p>将MJPG-Streamer加入环境变量，编辑/etc/profile，在文件底部添加其路径：</p>
            <pre><code>export LD_LIBRARY_PATH=/opt/mjpg-streamer-master/mjpg-streamer-experimental/
</code></pre>
            <p>开启摄像头，图像旋转180度，分辨率为320x240，30fps，输出到8080端口</p>
            <pre><code>// 如果是USB摄像头，将input_raspicam.so改为input_uvc.so即可
mjpg_streamer -i &quot;input_raspicam.so  -rot 180 -x 320 -y 240 -fps 30&quot; -o &quot;output_http.so –p 8080 -w /usr/local/www&quot;
</code></pre>
            <p>在浏览器中输入以下地址以接收传输的图像</p>
            <pre><code>// 静态图片
http://树莓派IP:8080/?action=snapshot
// 动态图像
http://树莓派IP:8080/?action=stream
// 动态图像
http://树莓派IP:8080/javascript_simple.html
</code></pre>
            <p>以上就是树莓派摄像头的基本操作方法，对于Android控制端，一般通过WebView来接受图像，我们可以监听WebView的触控事件，当手指在WebView上滑动的时候，控制摄像头云台转动让摄像头根据手指的滑动来拍摄指定角度的画面，是一个不错的体验。</p>
            <p>那么当摄像头正在工作的情况下如何远程关掉摄像头呢？比如正在传输视频，现在需要调用摄像头拍照，那么必须先使摄像头停止工作才能调用它做另外的事，这里可以远程命令Linux杀掉开启摄像头的进程。一般通过进程名来杀掉进程，因为进程名不会像PID那样变化，分为两步：</p>
            <p>获取进程名</p>
            <pre><code>ps -eo pid,comm,cmd
</code></pre>
            <p>杀掉指定的进程</p>
            <pre><code>killall 进程名
</code></pre>
            <p>对于摄像头传输视频的质量，可以根据自己的网络状况自定义，配合相应的FPS，使画面流畅显示。有时会出现断流的情况，刷新浏览器即可。</p>
            <!-- content -->
        </div>
    </div>
    <!-- float-btn -->
    <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
        <a class="btn-floating btn-large waves-effect waves-light green" href="#">
            <i class="material-icons">arrow_upward</i>
        </a>
    </div>
    <!-- foot -->
    <footer class="page-footer ">
        <div class="container">
            <h5 class="white-text">联系我</h5>
            <ul class="clear">
                <li>
                    <a class="white-text" href="mailto:changgongapq@gmail.com">changgongapq@gmail.com</a>
                </li>
            </ul>
        </div>
        <div class="footer-copyright">
            <div class="container">
                Based on
                <a class="orange-text text-lighten-3" href="http://materializecss.com">Materialize</a>
            </div>
        </div>
    </footer>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="../../../js/materialize.js"></script>
    <script type="text/javascript" src="../../../js/init.js"></script>
    <script type="text/javascript" src="../../../codeHighLight/highlight.pack.js"></script>
    <link rel="stylesheet" href="../../../codeHighLight/styles/darcula.css">
</body>

</html>
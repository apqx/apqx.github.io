<!DOCTYPE html>
<html>

<head>
    <title>apqx.me</title>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="../../../css/materialize.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="../../../css/custom.css" media="screen,projection" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta name="theme-color" content="#ee6e73" />
    <link rel="shortcut icon" href="../../../apqx.ico" />
</head>

<body class="gray">

    <!-- nav-bar -->
    <div class="navbar-fixed">
        <nav class="light-red lighten-1">
            <!-- nav-tag -->
            <div class="nav-wrapper container">
                <a href="http://apqx.me" class="brand-logo">APQX</a>
                <a href="#" data-target="nav-mobile" class="sidenav-trigger">
                    <i class="material-icons">menu</i>
                </a>
                <ul class="right hide-on-med-and-down clear">
                    <li class="active">
                        <a class="waves-effect waves-effect" href="../../../index.html">随笔</a>
                    </li>
                    <li>
                        <a class="waves-effect waves-effect" href="../../share/html/index.html">转载</a>
                    </li>
                    <li>
                        <a class="waves-effect waves-effect modal-trigger" href="#about_me">关于我</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    <!-- pop-up-about-me -->
    <div id="about_me" class="modal container">
        <div class="modal-content">
            <center>
                <img height="100px" width="100dx" class="circle responsive-img" src="../../../assets/me.jpg" />
            </center>
            <center>
                <h4>APQX</h4>
            </center>
            <p class="flow-text center-align">野生散养攻城狮，努力晋级中。</p>
            <div class="collection">
                <a href="https://github.com/apqx" class="collection-item">GitHub</a>
                <a href="https://www.facebook.com/apqx.me" class="collection-item">Facebook</a>
                <a href="mailto:changgongapq@gmail.com" class="collection-item">changgongapq@gmail.com</a>
            </div>
        </div>
    </div>
    <!-- slide-to-show-nav-tag -->
    <ul id="nav-mobile" class="sidenav clear">
        <li class="active">
            <a class="waves-effect waves-red" href="../../../index.html">随笔</a>
        </li>
        <li>
            <a class="waves-effect waves-red" href="../../share/html/index.html">转载</a>
        </li>
        <li>
            <a class="waves-effect waves-red modal-trigger" href="#about_me">关于我</a>
        </li>
    </ul>
    <!-- parallax-slid-img -->
    <div class="parallax-container">
        <div class="parallax">
            <img src="../assets/raspberryBg.png">
        </div>
    </div>
    <!-- content-card -->
    <div class="container">
        <div class="card-panel hoverable">
            <!-- content -->
            <h1>树莓派遇上Java_03-马达篇</h1>
            <h2>APQX</h2>
            <h2>2016年9月12日</h2>
            <p>树莓派3B拥有40个针脚，其中8个Ground针脚、4个VDC电源针脚、23个GPIO针脚，每个GPIO针脚都可以输出基本的高、低电平信号，这样树莓派就可以通过这些GPIO针脚来控制继电器，实现相应的功能。对于驱动马达而言，我们需要一块L298N马达驱动板和两个独立电源，其中一个电源为马达供电，另一个为树莓派单独供电。关于供电问题，大致有三种方案：</p>
            <ul>
                <li>
                    <p>方案一：使用5V电源为树莓派供电，然后从树莓派的5V电源针脚上取电给L298N即马达供电，树莓派和L298N共地线。这种方法很不可取，因为马达在启动瞬间会因为低电阻和不做功产生一个大的电流，很可能会损坏树莓派。</p>
                </li>
                <li>
                    <p>方案二： 电源给L298N供电，然后从L298N的5V电压输出口取电接在树莓派5V电源针脚上，树莓派和L298N共地线。这种方法在简单情况下可以使用，但是当树莓派驱动的设备多了之后，很容易由于电压不稳而重启。我在为树莓派安装了摄像头后发现，只要马达转动，树莓派就会重启，后来用一个移动电源给树莓派单独供电才解决。
                    </p>
                </li>
                <li>
                    <p>方案三： 使用独立电源分别为树莓派和L298N供电，这是最稳妥的方法，并且以后增加的舵机等设备可以直接从L298N的5V电压输出口接电，而不用担心影响到树莓派。
                    </p>
                </li>
            </ul>
            <p>
                <img class="materialboxed responsive-img" src="../assets/L298N.jpg" alt="pic">
            </p>
            <p>在上面的L298N驱动板中，1、2和3、4分别接两个马达的正负极，它们是L298N的电流输出口。树莓派的任意4个GPIO针脚接在in1、in2、in3、in4上，可以通过改变4个针脚的高低电平来控制两侧马达的转向，我更建议实际写一个测试程序来看看不同的电平组合会导致马达的转向发生什么样的变化，这样可比枯燥的说明有意思多了。5、6是L298N的电源接入口，5接电源正极，6接电源负极（据说接反会直接烧掉哦），L298N内置了变压模块，当输入电压大于5V时，7可以作为正极稳定输出5V电压，和作为负极的6一起可以为其他设备供电。至于in1、in2、in3、in4两边用跳线帽连接的使能端，可以用它给电机调速，我没有用到，可以忽略。</p>
            <p>在接线时要注意，L298N要与树莓派共地线，即6要与树莓派的某个Ground针脚相连，这样输出的电平信号才能构成一个回路，不然是不能控制的。</p>
            <p>接线完成后可以写一个小程序测试马达转向与高低电平的组合，我推荐在PC上使用Intellj IDEA或Eclipse导入pi4j库并编写代码，然后复制到树莓派上编译运行，或者将生成的Jar包传到树莓派上直接运行。pi4j项目目录下有很多示例程序，基本涵盖了对GPIO的所有操作，详细的注解使我们很容易弄懂如何使用它，可以参考pi4j官方关于控制GPIO电平的示例
                <a
                    href="http://pi4j.com/example/control.html">示例</a>。</p>
            <p>我在这里也提供一个简单的控制GPIO电平的示例</p>
            <pre><code>import com.pi4j.io.gpio.*;


/**
 * Created by apqx on 2016/9/11.
 */
public class Demo {

    public static void main(String[] args)throws Exception{
        GpioController gpio=GpioFactory.getInstance();
        //L298N in1
        GpioPinDigitalOutput RIGHT_1=gpio.provisionDigitalOutputPin(RaspiPin.GPIO_00,&quot;right_1&quot;, PinState.LOW);
        //L298N in2
        GpioPinDigitalOutput RIGHT_2=gpio.provisionDigitalOutputPin(RaspiPin.GPIO_02,&quot;right_2&quot;,PinState.LOW);
        //L298N in4
        GpioPinDigitalOutput LEFT_1=gpio.provisionDigitalOutputPin(RaspiPin.GPIO_04,&quot;left_1&quot;,PinState.LOW);
        //L298N in3
        GpioPinDigitalOutput LEFT_2=gpio.provisionDigitalOutputPin(RaspiPin.GPIO_03,&quot;left_2&quot;,PinState.LOW);
        
        //设置in1为高电平，in2为低电平
        RIGHT_1.high();
        RIGHT_2.low();
        //延时2秒钟
        Thread.currentThread().sleep(2000);
        //设置in1为低电平，in2为低电平
        RIGHT_1.low();
        RIGHT_2.low();
        //设置in3为高电平，in4为低电平
        LEFT_2.high();
        LEFT_1.low();
        //延时2秒钟
        Thread.currentThread().sleep(2000);
        //设置in3为低电平，in4为低电平
        LEFT_2.low();
        LEFT_1.low();
        gpio.shutdown();
    }

}
</code></pre>
            <p>
                <img class="materialboxed responsive-img" src="../assets/j8header-2b.png" alt="pic">
            </p>
            <p>一定要注意的是，代码中的GPIO序号对应的是图中两侧的黑体数字，而不是中间的针脚号！</p>
            <p>在树莓派上新建一个文件</p>
            <pre><code>vim Demo.java
</code></pre>
            <p>并将以上代码复制到Demo.java文件中，编译</p>
            <pre><code>pi4j -c Demo.java
</code></pre>
            <p>运行</p>
            <pre><code>pi4j Demo
</code></pre>
            <p>这时应该可以看到两个马达依次转动。</p>
            <!-- content -->
        </div>
    </div>
    <!-- float-btn -->
    <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
        <a class="btn-floating btn-large waves-effect waves-light green" href="#">
            <i class="material-icons">arrow_upward</i>
        </a>
    </div>
    <!-- foot -->
    <footer class="page-footer ">
        <div class="container">
            <h5 class="white-text">联系我</h5>
            <ul class="clear">
                <li>
                    <a class="white-text" href="mailto:changgongapq@gmail.com">changgongapq@gmail.com</a>
                </li>
            </ul>
        </div>
        <div class="footer-copyright">
            <div class="container">
                Based on
                <a class="orange-text text-lighten-3" href="http://materializecss.com">Materialize</a>
            </div>
        </div>
    </footer>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="../../../js/materialize.js"></script>
    <script type="text/javascript" src="../../../js/init.js"></script>
    <script type="text/javascript" src="../../../codeHighLight/highlight.pack.js"></script>
    <link rel="stylesheet" href="../../../codeHighLight/styles/darcula.css">
</body>

</html>
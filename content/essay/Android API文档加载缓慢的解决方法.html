<!DOCTYPE html>
<html>
    <head>
        <title>Android API文档加载缓慢的解决方法</title>
        <!--Import Google Icon Font-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
        <!--Import materialize.css-->
        <link type="text/css" rel="stylesheet" href="../../css/materialize.css"  media="screen,projection"/>
        
        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta charset="utf-8"/>
		<meta name="theme-color" content="#ee6e73"/>
		<link rel="shortcut icon" href="../../favicon.ico"/>
    </head>
    <body class="gray">
        <div class="navbar-fixed">
			<nav class="navbar-fixed light-red lighten-1" role="navigation">
				<div class="nav-wrapper container">
					<a id="logo-container" href="http://apqx.me" class="brand-logo">APQX</a>
					<ul id="nav-mobile" class="side-nav">
						<li><a class="waves-effect waves-red" href="../../content/essay/index.html">随笔</a></li>
						<li><a class="waves-effect waves-red" href="../../content/share/index.html">转载</a></li>
                        <li><a class="waves-effect waves-red modal-trigger" href="#about_me">关于我</a></li>
					</ul>
					<a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
				</div>
			</nav>
		</div>
<!--------------------------------------------------------------------------->
        <div class="parallax-container">
            <div class="parallax"><img src=assets/androidStudio.png></div>
        </div>
<!-------------------------------------------------------------------------->
        <div class="row section">
            <div class="col l2 hide-on-med-and-down">                
                    <div class="collection hoverable z-depth-1">
                    <a href="../../content/essay/index.html" class="waves-effect waves-red collection-item active">随笔</a>
                    <a href="../../content/share/index.html" class="waves-effect waves-red collection-item">转载</a>
                    <a href="#about_me" class="waves-effect waves-red collection-item modal-trigger">关于我</a>
                    </div>
            </div>
            <div class="col l2 hide-on-med-and-down"><pre></pre></div>
            <div class="col s12 m12 l6">
            <div class="card-panel hoverable">
            <div class="container">
                

            <!-- Modal Structure -->
            <div id="about_me" class="modal">
                <div class="modal-content">
                    <center><img height="100px" width="100dx" class="circle responsive-img" src="../../assets/me.jpg"/></center>
                    <center><h4>APQX</h4></center>
                    <p class="flow-text center-align">野生散养攻城狮，沉醉于Android开发技术，任重而道远，我也十分乐意分享自己在学习过程中的收获和经验。</p>
                    <div class="collection">
                            <a href="https://github.com/apqx" target="_blank" class="collection-item">GitHub</a>
                            <a href="https://www.facebook.com/me.apqx" target="_blank" class="collection-item">Facebook</a>
                            <a href="mailto:changgongapq@gmail.com" class="collection-item">changgongapq@outlook.com</a>
                        </div>
                </div>
            </div>

<!---------------------------------------------content------------------------------------------------------------------->
                <h4 align="center">Android API文档加载缓慢的解决方法</h4>
                <p class="center flow-text">APQX</p>
                <p class="center">2016年6月12日</p>
                <p class="flow-text">在学习Android的过程中，自然要使用Android系统提供的应用开发接口，即要参阅Android API文档来选择需要的功能接口以调用相应的功能。实际上在Android SDK的本地文件夹中就有一份HTML版的API文档，理论上可以使用浏览器离线查看，但是当我使用浏览器打开这些文档的时候，却发现在联网状态下加载速度极慢，而当断开网络的时候加载速度就正常了。考虑到墙的存在，我猜测应该是HTML文档中存在需要联网下载的StyleSheet或Javascript,而要连接的网站十有八九就是Google。</p>
                <p class="flow-text">果然，我在文件中发现了以下两段代码</p>
                <pre>
                    <code>
&ltscript src="http://www.google.com/jsapi" type="text/javascript">&lt/script>

&ltscript>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-5831155-1', 'android.com');
  ga('create', 'UA-49880327-2', 'android.com', {'name': 'universal'});  // New tracker);
  ga('send', 'pageview');
  ga('universal.send', 'pageview'); // Send page view for new tracker.
&lt/script>
                    </code>
                </pre>
                <p class="flow-text">可以看到，这些文档要使用的一些Javascript代码存放在Google的网站上，正常情况下自然无法访问，浏览器等待网站回应直至达到规定时间，自然就造成了加载缓慢的现象，经过检验，删除这部分代码即可使浏览器正常加载这些文件，而且不会对文档内容造成影响，只是缺少了某些交互效果，这些交互操作在大部分情况下并不重要，我们需要的是API内容。当然还有一种完美的解决方法，科学上网，但是,这种方法在某种程度上说并不方便。</p>
                <p class="flow-text">我写了下面的一个小程序来处理这几千个HTML文件，即扫描所有文件，一旦发现含有以上代码即删除，然后重新输出回原文件。逐一读写数千个文档是一个相当费时的操作，耐心等待吧。</p>
                <pre>
                    <code>
package me.apqx.util;

import java.awt.*;
import java.io.*;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * Created by chang on 2016/6/11.
 * 功能是删除Android API文档中需要链接Google的两段Javascript代码，以使阅读这些文档时更流畅，就像在断网情况下一样
 */
public class ChangeFile {
    public static void main(String[] args){
        ChangeFile changeFile=new ChangeFile();
        //文档所在的文件夹
        File file=new File("F:/docs");
        changeFile.scanFile(file);
        try {
            Desktop.getDesktop().open(new File(file,"index.html"));
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    private void scanFile(File file){
        if (file.isDirectory()){
            File[] list=file.listFiles(new FileFilter() {
                @Override
                public boolean accept(File pathname) {
                    if (pathname.isDirectory()){
                        return true;
                    }else if (pathname.getName().contains("html")){
                        return true;
                    }else {
                        return false;
                    }
                }
            });
            for (File f:list){
                scanFile(f);
            }
        }else {
            restoreFile(file);
        }
    }
    private void restoreFile(File file){
        BufferedReader bufferedReader=null;
        BufferedWriter bufferedWriter=null;
        try {
            bufferedReader=new BufferedReader(new InputStreamReader(new FileInputStream(file)));
            StringBuilder stringBuilder=new StringBuilder();
            String string;
            while ((string=bufferedReader.readLine())!=null){
                stringBuilder.append(string+"\n");
            }
            string=stringBuilder.toString();
            Matcher matcher= Pattern.compile("(&ltscript .*http.*>&lt/script>)|((?s)&ltscript>\n.*tracker\\.\n&lt/script>)").matcher(string);
            while (matcher.find()){
                string=matcher.replaceAll("");
            }
            bufferedWriter=new BufferedWriter(new FileWriter(file));
            bufferedWriter.write(string);
            System.out.println("已处理\n"+file.getAbsolutePath());
        } catch (Exception e) {
            e.printStackTrace();
        }finally {
            try {
                bufferedReader.close();
                bufferedWriter.close();
            }catch (Exception e){
                e.printStackTrace();
            }
        }
    }
}
                    </code>
                </pre>
                
                
<!---------------------------------------------content------------------------------------------------------------------->
            </div>
            </div>
            </div>
        </div>                
<!----------------------------------------------foot--------------------------------------------------------------------->
         <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
            <a class="btn-floating btn-large waves-effect waves-light green" href="#"><i class="material-icons">publish</i></a>
        </div>
        <footer class="page-footer ">
            <div class="container">
                <div class="row">
                    <div class="col l6 s12">
                        <h5 class="white-text">关于本站</h5>
                        <p class="grey-text text-lighten-4">这是我的个人网站，我会在这里记录自己成长的点滴，也会经常在这里分享学习中的收获。</p>
                    </div>
                    <div class="col l3 s12">
                    <h5 class="white-text">联系我</h5>
                     <ul>
                         <li><a class="white-text" href="mailto:changgongapq@gmail.com">changgongapq@outlook.com</a></li>
                    </ul>
                    </div>
                </div>
            </div>
            <div class="footer-copyright">
                <div class="container">
                    Based on <a class="orange-text text-lighten-3" href="http://materializecss.com" target="_blank">Materialize</a>
                </div>
            </div>
        </footer>
		<!--Import jQuery before materialize.js-->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="../../js/materialize.js"></script>
        <script src="../../js/init.js"></script>
        <!--Code highlight-->
        <link rel="stylesheet" href="../../codeHighLight/styles/darcula.css">
        <script src="../../codeHighLight/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
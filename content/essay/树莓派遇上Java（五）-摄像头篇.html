<!DOCTYPE html>
<html>
    <head>
        <title>树莓派遇上Java（五）-摄像头篇</title>
        <!--Import Google Icon Font-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
        <!--Import materialize.css-->
        <link type="text/css" rel="stylesheet" href="../../css/materialize.css"  media="screen,projection"/>
        
        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta charset="utf-8"/>
		<meta name="theme-color" content="#ee6e73"/>
		<link rel="shortcut icon" href="../../favicon.ico"/>
    </head>
    <body class="gray">
        <div class="navbar-fixed">
			<nav class="navbar-fixed light-red lighten-1" role="navigation">
				<div class="nav-wrapper container">
					<a id="logo-container" href="http://apqx.me" class="brand-logo">APQX</a>
					<ul id="nav-mobile" class="side-nav">
						<li><a class="waves-effect waves-red" href="../../content/essay/index.html">随笔</a></li>
						<li><a class="waves-effect waves-red" href="../../content/share/index.html">分享</a></li>
                        <li><a class="waves-effect waves-red modal-trigger" href="#about_me">关于我</a></li>
					</ul>
					<a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
				</div>
			</nav>
		</div>
<!--------------------------------------------------------------------------->
        <div class="parallax-container">
            <div class="parallax"><img src=./assets/Screen.png></div>
        </div>
<!-------------------------------------------------------------------------->
        <div class="row section">
            <div class="col s2 hide-on-med-and-down">                
                    <div class="collection hoverable z-depth-1">
                    <a href="../../content/essay/index.html" class="waves-effect waves-red collection-item active">随笔</a>
                    <a href="../../content/share/index.html" class="waves-effect waves-red collection-item">分享</a>
                    <a href="#about_me" class="waves-effect waves-red collection-item modal-trigger">关于我</a>
                    </div>
            </div>
            <div class="col l2 hide-on-med-and-down"><pre></pre></div>
            <div class="col s12 m12 l6">
            <div class="card-panel hoverable">
            <div class="container">
                

            <!-- Modal Structure -->
            <div id="about_me" class="modal">
                <div class="modal-content">
                    <center><img height="100px" width="100dx" class="circle responsive-img" src="../../assets/me.jpg"/></center>
                    <center><h4>APQX</h4></center>
                    <p class="flow-text center-align">野生散养攻城狮，沉醉于Android开发技术，任重而道远，我也十分乐意分享自己在学习过程中的收获和经验。</p>
                    <div class="collection">
                            <a href="https://github.com/apqx" target="_blank" class="collection-item">GitHub</a>
                            <a href="https://www.facebook.com/me.apqx" target="_blank" class="collection-item">Facebook</a>
                        </div>
                </div>
            </div>
        
<!---------------------------------------------content------------------------------------------------------------------->
                <h4 align="center">树莓派遇上Java（五）-摄像头篇</h4>
                <p class="center flow-text">APQX</p>
                <p class="center">2016年9月15日</p>
                <p class="flow-text">对于我来说，当然希望树莓派驱动的小车可以实时传输画面到控制器，这样才可以远程遥控嘛，一般将摄像头固定在一个两自由度云台上，使之可以自由旋转，拍摄各个方向的画面，具体的操作实现逻辑因人而异，但是基本的摄像头命令都是一样的。树莓派支持两种类型的摄像头，一种是普通USB摄像头（最好是免驱的），一种是树莓派专用的Pi Cam，都可以在淘宝上买到，后者的某些型号还具有红外线夜视功能，价格当然也高一些。这里以树莓派专用的Pi Cam为例，介绍摄像头的基本使用方法。</p>
                <center><img class="materialboxed responsive-img" src="./assets/pi_cam.jpg"></center>
                <p class="flow-text">Pi Cam接在树莓派中部的CSI接口上，不需要额外供电，这里再次强烈建议为树莓派提供独立电源通过USB口供电而不要使用GPIO针脚供电，否则在摄像头开启的瞬间树莓派可能因为电压不稳而重启。</p>
                <p class="flow-text">摄像头通过网络传输视频的原理是，使用MJPG-Streamer调用摄像头拍摄画面并将画面发送到指定的端口上，在浏览器里通过IP地址访问该端口即可显示实时画面。</p>
                <p class="flow-text">首先开启摄像头</p>
                <pre><code>sudo raspi-config</code></pre>
                <p class="flow-text">拍照并将照片旋转180度</p>
                <pre><code>raspistill -o image.jpg -rot 180</code></pre>
                <p class="flow-text">安装依赖库</p>
                <pre><code>sudo apt-get install libjpeg62-dev
sudo apt-get install libjpeg8-dev</code></pre>
                <p class="flow-text">下载MJPG-Streamer<br/><a href="https://github.com/jacksonliam/mjpg-streamer" target="_blank">https://github.com/jacksonliam/mjpg-streamer</a><br/>下载zip安装包mjpg-streamer-master.zip并解压</p>
                <pre><code>unzip mjpg-streamer-master.zip</code></pre>
                <p class="flow-text">安装cmake</p>
                <pre><code>sudo apt-get install cmake</code></pre>
                <p class="flow-text">切换到mjpg的路径下并编译</p>
                <pre><code>cd  ~/mjpg-streamer-master/mjpg-streamer-experimental
sudo make clean all</code></pre>
                <p class="flow-text">将MJPG-Streamer加入环境变量，编辑/etc/profile，在文件底部添加其路径：</p>
                <pre><code>export LD_LIBRARY_PATH=/opt/mjpg-streamer-master/mjpg-streamer-experimental/</code></pre>
                <p class="flow-text">开启摄像头，图像旋转180度，分辨率为320x240，30fps，输出到8080端口</p>
                <pre><code>mjpg_streamer -i "input_raspicam.so  -rot 180 -x 320 -y 240 -fps 30" -o "output_http.so –p 8080 -w /usr/local/www"</code></pre>
                <p class="flow-text">如果是USB摄像头，将input_raspicam.so改为input_uvc.so即可</p>
                <p class="flow-text">在浏览器中输入以下地址以接收传输的图像</p>
                <pre><code>//静态图片
http://树莓派IP:8080/?action=snapshot
//动态图像
http://树莓派IP:8080/?action=stream
//动态图像
http://树莓派IP:8080/javascript_simple.html</code></pre>
                <p class="flow-text">以上就是树莓派摄像头的基本操作方法，那么当摄像头正在工作的情况下如何远程关掉摄像头呢？比如正在传输视频，现在需要调用摄像头拍照，那么必须先使摄像头停止工作才能调用它做另外的事，这里可以远程命令Linux杀掉开启摄像头的进程，分为两步<br/>获取进程名</p>
                <pre><code>ps -eo pid,comm,cmd</code></pre>
                <p class="flow-text">杀掉指定的进程</p>
                <pre><code>killall 进程名</code></pre>
                <p class="flow-text">对于摄像头传输视频的质量，可以根据自己的网络状况自定义，配合相应的FPS，使画面流畅显示。有时会出现断流的情况，刷新浏览器即可。</p>
            
                
<!---------------------------------------------content------------------------------------------------------------------->
            </div>
            </div>
            </div>
        </div>
<!----------------------------------------------foot--------------------------------------------------------------------->
         <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
            <a class="btn-floating btn-large waves-effect waves-light green" href="#"><i class="material-icons">publish</i></a>
        </div>
        <footer class="page-footer ">
            <div class="container">
                <div class="row">
                    <div class="col l6 s12">
                        <h5 class="white-text">关于本站</h5>
                        <p class="grey-text text-lighten-4">这是我的个人网站，我会在这里记录自己成长的点滴，也会经常在这里分享各种实用的技巧。</p>
                    </div>
                    <div class="col l3 s12">
                    <h5 class="white-text">联系我</h5>
                     <ul>
                         <li><a class="white-text" href="mailto:changgongapq@gmail.com">changgongapq@outlook.com</a></li>
                    </ul>
                    </div>
                </div>
            </div>
            <div class="footer-copyright">
                <div class="container">
                    Based on <a class="orange-text text-lighten-3" href="http://materializecss.com" target="_blank">Materialize</a>
                </div>
            </div>
        </footer>
		<!--Import jQuery before materialize.js-->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="../../js/materialize.js"></script>
        <script src="../../js/init.js"></script>
        <!--Code highlight-->
        <link rel="stylesheet" href="../../codeHighLight/styles/darcula.css">
        <script src="../../codeHighLight/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
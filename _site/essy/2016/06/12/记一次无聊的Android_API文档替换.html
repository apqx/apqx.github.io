<!DOCTYPE html>
<html>

<head>

  <title>记一次无聊的Android_API文档替换</title>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="/css/materialize.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="/css/custom.css" media="screen,projection" />
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <meta name="theme-color" content="#ee6e73" />
  <link rel="shortcut icon" href="/apqx.ico" />
</head>

<body class="gray">

  <header>
  <!-- nav-bar -->
  <div class="navbar-fixed">
    <nav class="light-red lighten-1">
      <!-- nav-tag -->
      <div class="nav-wrapper container">
        <a href="http://apqx.me" class="brand-logo">APQX</a>
        <a href="#" data-target="nav-mobile" class="sidenav-trigger">
          <i class="material-icons">menu</i>
        </a>
        <ul class="right hide-on-med-and-down clear">
          <li  class="active" >
            <a class="waves-effect waves-effect" href="/index.html">随笔</a>
          </li>
          <li >
            <a class="waves-effect waves-effect" href="/index-share.html">转载</a>
          </li>
          <li>
            <a class="waves-effect waves-effect modal-trigger" href="#about_me">关于我</a>
          </li>
        </ul>
      </div>
    </nav>
  </div>
  <!-- pop-up-about-me -->
  <div id="about_me" class="modal container">
    <div class="modal-content">
      <center>
        <img height="100px" width="100dx" class="circle responsive-img" src="/assets/me.jpg" />
      </center>
      <center>
        <h4>APQX</h4>
      </center>
      <p class="flow-text center-align">野生散养攻城狮，努力晋级中。</p>
      <div class="collection">
        <a href="https://github.com/apqx" class="collection-item">GitHub</a>
        <a href="https://www.facebook.com/apqx.me" class="collection-item">Facebook</a>
        <a href="mailto:changgongapq@gmail.com" class="collection-item">changgongapq@gmail.com</a>
      </div>
    </div>
  </div>
  <!-- slide-to-show-nav-tag -->
  <ul id="nav-mobile" class="sidenav clear">
    <li  class="active" >
      <a class="waves-effect waves-red" href="/index.html">随笔</a>
    </li>
    <li >
      <a class="waves-effect waves-red" href="/index-share.html">转载</a>
    </li>
    <li>
      <a class="waves-effect waves-red modal-trigger" href="#about_me">关于我</a>
    </li>
  </ul>
  <!-- parallax-slid-img -->
  <!-- 索引页面不显示 -->
  
  <div class="parallax-container hide-on-med-and-down">
    <div class="parallax">
      <img src="/assets/androidStudio.png">
    </div>
  </div>
  
</header>

  
  <!-- content-card -->
  <div class="container">
    <div class="card-panel hoverable">
      <!-- content -->
  

      <h1 id="记一次无聊的android-api文档替换">记一次无聊的Android API文档替换</h1>

<h2 id="apqx">APQX</h2>

<h2 id="2016年6月12日">2016年6月12日</h2>

<p>在学习Android的过程中，自然要使用Android系统提供的应用开发接口，即要参阅Android API文档来选择需要的功能接口以调用相应的功能。实际上在Android SDK的本地文件夹中就有一份HTML版本的API文档，可以使用浏览器离线查看，但是当我用浏览器打开这些文档的时候，却发现在联网状态下加载速度极慢，而当断开网络的时候加载速度就正常了。考虑到墙的存在，猜测应该是HTML文档中存在需要联网下载的StyleSheet或Javascript，而要连接的网站十有八九就是Google。</p>

<p>经排查，加载缓慢的元凶就是以下两段代码：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s">"http://www.google.com/jsapi"</span> <span class="n">type</span><span class="o">=</span><span class="s">"text/javascript"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
  <span class="o">(</span><span class="n">function</span><span class="o">(</span><span class="n">i</span><span class="o">,</span><span class="n">s</span><span class="o">,</span><span class="n">o</span><span class="o">,</span><span class="n">g</span><span class="o">,</span><span class="n">r</span><span class="o">,</span><span class="n">a</span><span class="o">,</span><span class="n">m</span><span class="o">){</span><span class="n">i</span><span class="o">[</span><span class="err">'</span><span class="n">GoogleAnalyticsObject</span><span class="err">'</span><span class="o">]=</span><span class="n">r</span><span class="o">;</span><span class="n">i</span><span class="o">[</span><span class="n">r</span><span class="o">]=</span><span class="n">i</span><span class="o">[</span><span class="n">r</span><span class="o">]||</span><span class="n">function</span><span class="o">(){</span>
  <span class="o">(</span><span class="n">i</span><span class="o">[</span><span class="n">r</span><span class="o">].</span><span class="na">q</span><span class="o">=</span><span class="n">i</span><span class="o">[</span><span class="n">r</span><span class="o">].</span><span class="na">q</span><span class="o">||[]).</span><span class="na">push</span><span class="o">(</span><span class="n">arguments</span><span class="o">)},</span><span class="n">i</span><span class="o">[</span><span class="n">r</span><span class="o">].</span><span class="na">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="k">new</span> <span class="n">Date</span><span class="o">();</span><span class="n">a</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">createElement</span><span class="o">(</span><span class="n">o</span><span class="o">),</span>
  <span class="n">m</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="n">o</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span><span class="n">a</span><span class="o">.</span><span class="na">async</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span><span class="n">a</span><span class="o">.</span><span class="na">src</span><span class="o">=</span><span class="n">g</span><span class="o">;</span><span class="n">m</span><span class="o">.</span><span class="na">parentNode</span><span class="o">.</span><span class="na">insertBefore</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">m</span><span class="o">)</span>
  <span class="o">})(</span><span class="n">window</span><span class="o">,</span><span class="n">document</span><span class="o">,</span><span class="err">'</span><span class="n">script</span><span class="sc">','</span><span class="c1">//www.google-analytics.com/analytics.js','ga');</span>
  <span class="n">ga</span><span class="o">(</span><span class="err">'</span><span class="n">create</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">UA</span><span class="o">-</span><span class="mi">5831155</span><span class="o">-</span><span class="mi">1</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">android</span><span class="o">.</span><span class="na">com</span><span class="err">'</span><span class="o">);</span>
  <span class="n">ga</span><span class="o">(</span><span class="err">'</span><span class="n">create</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">UA</span><span class="o">-</span><span class="mi">49880327</span><span class="o">-</span><span class="mi">2</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">android</span><span class="o">.</span><span class="na">com</span><span class="err">'</span><span class="o">,</span> <span class="o">{</span><span class="err">'</span><span class="n">name</span><span class="err">'</span><span class="o">:</span> <span class="err">'</span><span class="n">universal</span><span class="err">'</span><span class="o">});</span>  <span class="c1">// New tracker);</span>
  <span class="n">ga</span><span class="o">(</span><span class="err">'</span><span class="n">send</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">pageview</span><span class="err">'</span><span class="o">);</span>
  <span class="n">ga</span><span class="o">(</span><span class="err">'</span><span class="n">universal</span><span class="o">.</span><span class="na">send</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">pageview</span><span class="err">'</span><span class="o">);</span> <span class="c1">// Send page view for new tracker.</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>这些代码在“正常”情况下自然无法访问，浏览器等待服务器响应直至超时，造成了加载缓慢的现象，所以，删除这部分代码即可使浏览器正常加载这些文件，而且不会对文档内容造成影响，只是缺少了某些交互效果，这些交互操作在大部分情况下并不重要，我们需要的是API内容。当然还有一种完美的解决方法，科学上网，但是，这种方法在某种程度上说并不方便。</p>

<p>我写了下面的一个小程序来处理这几千个HTML文件，即扫描所有文件，一旦发现含有以上代码即删除，然后重新输出回原文件。逐一读写数千个文档是一个相当费时的操作，所幸我并不赶时间。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">apqx</span><span class="o">.</span><span class="na">me</span><span class="o">.</span><span class="na">util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Matcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="cm">/**
 * Created by apqx on 2016/6/11.
 * 功能是删除Android API文档中需要链接Google的两段Javascript代码，以使阅读这些文档时更流畅，就像在断网情况下一样
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChangeFile</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">ChangeFile</span> <span class="n">changeFile</span><span class="o">=</span><span class="k">new</span> <span class="n">ChangeFile</span><span class="o">();</span>
        <span class="c1">//文档所在的文件夹</span>
        <span class="n">File</span> <span class="n">file</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"F:/docs"</span><span class="o">);</span>
        <span class="n">changeFile</span><span class="o">.</span><span class="na">scanFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Desktop</span><span class="o">.</span><span class="na">getDesktop</span><span class="o">().</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">file</span><span class="o">,</span><span class="s">"index.html"</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">scanFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">){</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()){</span>
            <span class="n">File</span><span class="o">[]</span> <span class="n">list</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">listFiles</span><span class="o">(</span><span class="k">new</span> <span class="n">FileFilter</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="o">(</span><span class="n">File</span> <span class="n">pathname</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">pathname</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()){</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="o">}</span><span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">pathname</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">"html"</span><span class="o">)){</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">File</span> <span class="nl">f:</span><span class="n">list</span><span class="o">){</span>
                <span class="n">scanFile</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="n">restoreFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">restoreFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">){</span>
        <span class="n">BufferedReader</span> <span class="n">bufferedReader</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">BufferedWriter</span> <span class="n">bufferedWriter</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">bufferedReader</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">)));</span>
            <span class="n">StringBuilder</span> <span class="n">stringBuilder</span><span class="o">=</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">string</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">string</span><span class="o">=</span><span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">string</span><span class="o">+</span><span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">string</span><span class="o">=</span><span class="n">stringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="n">Matcher</span> <span class="n">matcher</span><span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"(&lt;script .*http.*&gt;&lt;/script&gt;)|((?s)&lt;script&gt;\n.*tracker\\.\n&lt;/script&gt;)"</span><span class="o">).</span><span class="na">matcher</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">matcher</span><span class="o">.</span><span class="na">find</span><span class="o">()){</span>
                <span class="n">string</span><span class="o">=</span><span class="n">matcher</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">bufferedWriter</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
            <span class="n">bufferedWriter</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"已处理\n"</span><span class="o">+</span><span class="n">file</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">bufferedReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="n">bufferedWriter</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>


  
      <!-- content -->
    </div>
  </div>
   
  <!-- float-btn -->
  <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
    <a class="btn-floating btn-large waves-effect waves-light green" href="#">
      <i class="material-icons">arrow_upward</i>
    </a>
  </div>

  <footer class="page-footer ">
  <div class="container">
    <h5 class="white-text">联系我</h5>
    <ul class="clear">
      <li>
        <a class="white-text" href="mailto:changgongapq@gmail.com">changgongapq@gmail.com</a>
      </li>
    </ul>
  </div>
  <div class="footer-copyright">
    <div class="container">
      Based on
      <a class="orange-text text-lighten-3" href="http://materializecss.com">Materialize</a>
    </div>
  </div>
</footer>

  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="/js/materialize.js"></script>
  <script type="text/javascript" src="/js/init.js"></script>
  <script type="text/javascript" src="/codeHighLight/highlight.pack.js"></script>
  <link rel="stylesheet" href=" /codeHighLight/styles/darcula.css">
</body>

</html>
---
layout: post
type: essy
title:  "åœ¨Ubuntu 18.04 ä¸­æ­å»ºShadowsocksæœåŠ¡"
author: APQX
date:   2018-12-9 +0800
categories: essy
---

# å‰è¨€

æˆ‘åœ¨é«˜äºŒå°±æ³¨å†Œäº†`Gmail`ï¼Œå°è±¡ä¸­åº”è¯¥æ˜¯ä»å¤§ä¸€ä¸‹å­¦æœŸå¼€å§‹ï¼Œå‘ç°`Gmail`ä¼šæ—¶ä¸æ—¶çš„æ— æ³•è®¿é—®ï¼Œä¹Ÿç¬¬ä¸€æ¬¡å¬åˆ°`ç¿»å¢™`è¿™ä¸ªè¯ï¼Œç”¨è¿‡ä¸€äº›è¯¸å¦‚`è“ç¯`ã€`èµ›é£`ä¹‹ç±»çš„å…è´¹å·¥å…·ï¼Œå®è¯è¯´ï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œè¿æ¥ä¹Ÿå¾ˆä¸ç¨³å®šï¼Œå› æ­¤é‚£æ®µæ—¶é—´çš„ä½“éªŒå¾ˆä¸å¥½ã€‚åæ¥å¼€å§‹æ¥è§¦`Shadowsocks`å³`å½±æ¢­`ï¼Œä»[æ«å¶ä¸»æœº](https://www.fengye.io/)é‚£é‡Œè´­ä¹°è´¦å·ï¼Œåœ¨æ‰‹æœºå’Œç”µè„‘ä¸Šéƒ½å¯ä»¥ç”¨ï¼Œé€Ÿåº¦å’Œç¨³å®šæ€§ä¹Ÿè¿˜å¥½ï¼Œä½†æµé‡æ¯æœˆåªæœ‰40Gï¼Œå‹‰å‹‰å¼ºå¼ºï¼Œå°±è¿™æ ·æ’‘åˆ°äº†æ¯•ä¸šã€‚åæ¥ï¼Œ`æ«å¶ä¸»æœº`å¼€å§‹æ¶¨ä»·ï¼Œæˆ‘è§‰å¾—ï¼Œä¸èƒ½å†è¿™æ ·ä¸‹å»äº†ï¼Œä»–ä»¬èƒ½åšåˆ°çš„ï¼Œæˆ‘ä¹Ÿå¯ä»¥åšåˆ°ï¼Œä¸ºä»€ä¹ˆä¸è‡ªå·±æ­å»ºä¸€å°`Shadowsocks`æœåŠ¡å™¨å‘¢ï¼Œäºæ˜¯ï¼Œåœ¨[Vultr](https://www.vultr.com/?ref=7355474)ä¸Šä¹°äº†ä¸€å°ä½äºæ´›æ‰çŸ¶çš„`VPS`ï¼Œå› ä¸ºé‚£ä¸ªæ—¶å€™ï¼Œæˆ‘å…¶å®åˆšå¼€å§‹æ¥è§¦`Linux`ï¼Œä¸€ç‚¹éƒ½ä¸ç†Ÿæ‚‰`Terminal`çš„é‚£ä¸€å¥—ä¸œè¥¿ï¼Œä¸è¿‡ï¼Œæ€»ç®—æˆåŠŸäº†ã€‚è¿™å°æœåŠ¡å™¨æˆ‘ç”¨äº†ä¸€å¹´ï¼Œé€Ÿåº¦å¯ä»¥è·‘æ»¡å¸¦å®½ï¼Œæ¯æœˆçš„1000Gæµé‡ä¹Ÿè®©æˆ‘å½»åº•æ²¡æœ‰äº†é‚£ç§`æµé‡ç„¦è™‘`æ„Ÿï¼Œç›´åˆ°æ˜¨å¤©ï¼Œæˆ‘å‘ç°æ— æ³•è¿æ¥åˆ°å®ƒäº†ï¼Œå¦‚æœä¸æ˜¯æš‚æ—¶çš„æœåŠ¡å™¨æ•…éšœï¼Œé‚£å¾ˆå¯èƒ½å°±æ˜¯IPè¢«å¢™äº†ã€‚å…¶å®è¿™æ ·ä¹Ÿå¥½ï¼Œå†å¼€ä¸€å°æœåŠ¡å™¨ï¼Œé¡ºä¾¿æŠŠè¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œåšç‚¹æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚

# Shadowsocksæ˜¯ä»€ä¹ˆ

> **Shadowsocks** is an open-source encrypted proxy project, widely used in mainland China to circumvent [Internet censorship](https://en.wikipedia.org/wiki/Internet_censorship_in_China). It was created in 2012 by a Chinese programmer named "clowwindy", and multiple implementations of the protocol have been made available since.[[4]](https://en.wikipedia.org/wiki/Shadowsocks#cite_note-github-init-4)[[5]](https://en.wikipedia.org/wiki/Shadowsocks#cite_note-github-ports-5) Typically, the client software will open a socks5 proxy on the machine it is run, which internet traffic can then be directed towards, similarly to an [SSH tunnel](https://en.wikipedia.org/wiki/SSH_tunnel).[[6]](https://en.wikipedia.org/wiki/Shadowsocks#cite_note-6) Unlike an SSH tunnel, shadowsocks can also proxy UDP traffic.

è‡ªç”±çš„è®¿é—®ç½‘ç»œåœ¨21ä¸–çºªçš„ä¸­å›½å¤§é™†è¢«æˆç§°ä¸º`ç§‘å­¦ä¸Šç½‘`ï¼Œ`Shadowsocks`æ˜¯ä¸€ç§æµè¡Œçš„ç©¿å¢™å·¥å…·ï¼Œå®ƒåŒ…æ‹¬`ä»£ç†æœåŠ¡å™¨`å’Œ`å®¢æˆ·ç«¯`ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­`å®¢æˆ·ç«¯`å°±æ˜¯æˆ‘ä»¬å®é™…åœ¨æ‰‹æœºå’Œç”µè„‘ä¸Šå®‰è£…çš„`Shadowsocks`ç¨‹åºï¼Œåœ¨`Mac`ã€`Windows`ã€`Linux`ã€`Android`ã€`iOS`ä¸Šéƒ½æœ‰å¯¹åº”çš„`å®¢æˆ·ç«¯`å®ç°ã€‚å› ä¸º`å®¢æˆ·ç«¯`çš„æµé‡éƒ½å°†è¢«å¯¼å‘`ä»£ç†æœåŠ¡å™¨`ï¼Œä»è€Œç»•è¿‡å¤§é™†çš„`é˜²ç«é•¿åŸ`ï¼Œæ‰€ä»¥ï¼Œè¿™å°`æœåŠ¡å™¨`ä¸€å®šä¸èƒ½ä½äºä¸­å›½å¤§é™†ï¼Œé¦™æ¸¯ã€æ—¥æœ¬å’Œç¾å›½éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„åœ°ç‚¹ã€‚

æ¨èçš„å¹³å°å®¢æˆ·ç«¯ï¼š

* MACï¼š[ShadowsocksX-NG](https://github.com/shadowsocks/ShadowsocksX-NG/releases)

* Windowsï¼š[shadowsocks-win](https://github.com/shadowsocks/ShadowsocksX-NG/releases)

* Linuxï¼š[Shadowsocks-Qt5](https://github.com/shadowsocks/shadowsocks-qt5/wiki/Installation)

* Androidï¼š[shadowsocks-androidï¼ˆç¾åŒºå•†åº—ï¼‰](https://play.google.com/store/apps/details?id=com.github.shadowsocks)

* iOSï¼š[Potatso Liteï¼ˆç¾åŒºå•†åº—ï¼‰](https://itunes.apple.com/us/app/potatso-lite/id1239860606?mt=8)

# éœ€è¦å‡†å¤‡äº›ä»€ä¹ˆ

æ­å»ºè‡ªå·±çš„`ShadowsocksæœåŠ¡å™¨`ï¼Œéœ€è¦ä»¥ä¸‹ï¼š

* æµ·å¤–`VPS`æˆ–å®ä½“`Server`ï¼Œæˆ‘è‡ªç”¨çš„æ˜¯[Vultr](https://www.vultr.com/?ref=7355474)
* `Linux`åŸºç¡€

# ä¸ºä»€ä¹ˆæ˜¯Vultr

`VPS`æä¾›å•†å…¶å®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è‘—åçš„[æ¬ç“¦å·¥](https://bandwagonhost.com/)ï¼Œæˆ‘ä¸ºä»€ä¹ˆé€‰`Vultr`å‘¢ï¼Ÿå…¶å®ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸ºä»€ä¹ˆï¼Œæˆ‘éšä¾¿é€‰äº†ä¸€å®¶ï¼Œæ°å¥½å‘ç°å®ƒçš„å®˜ç½‘åšçš„å¾ˆæ¼‚äº®ï¼Œè€Œæˆ‘åˆæ˜¯ä¸ªåè¶³çš„`é¢œå€¼å…š`ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå®˜ç½‘åŸºæœ¬èƒ½ååº”ä¸€å®¶å…¬å¸çš„æŠ€æœ¯è¿½æ±‚ï¼Œå°±åƒæŸäº›ç½‘ç«™ï¼Œçœ‹çœ‹å°±æ²¡æœ‰ä½¿ç”¨çš„æ¬²æœ›ï¼Œå¦å¤–ï¼Œå¦‚æœæœ‰äººä»[è¿™ä¸ªé“¾æ¥](https://www.vultr.com/?ref=7355474)æ³¨å†Œ`Vultr`çš„è¯ï¼Œæˆ‘èƒ½å¾—åˆ°10åˆ€çš„ä¼˜æƒ åˆ¸ğŸ¤“ï¼Œè€Œä¸”ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå®ƒæ˜¯æ”¯æŒ`æ”¯ä»˜å®`çš„ğŸ‘½ã€‚

# å¦‚ä½•è´­ä¹°å¹¶åˆ›å»ºVPS

è¿›å…¥[Vultrå®˜ç½‘](https://www.vultr.com/?ref=7355474)ï¼Œæ³¨å†Œè´¦å·

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_1.png" }}" alt="pic">

åœ¨`Servers`è§†å›¾ä¸­å¯ä»¥çœ‹åˆ°å½“å‰å·²è´­ä¹°çš„`æœåŠ¡å™¨`ï¼Œæˆ‘è¿™é‡Œå·²ç»ä¹°è¿‡ä¸€å°äº†ï¼Œæ‰€ä»¥èƒ½çœ‹åˆ°`apqxss`ï¼Œç‚¹å‡»å³ä¸Šè§’çš„`+`åˆ›å»ºè‡ªå·±çš„`æœåŠ¡å™¨`

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_2.png" }}" alt="pic">

é€‰æ‹©`æœåŠ¡å™¨`åœ°å€ï¼Œåªè¦ä¸æ˜¯å¤§é™†ï¼Œéšæ„ï¼Œè¿™é‡Œé€‰æ‹©çš„`æœåŠ¡å™¨`åœ°å€ï¼Œå¯èƒ½ä¼šå½±å“åé¢çš„å¥—é¤ä»·æ ¼

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_3.png" }}" alt="pic">

æ“ä½œç³»ç»Ÿæ¨è64ä½`Ubuntu 18.04`ï¼Œè¿™æ˜¯ä¸€ä¸ªé•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œæœˆå¥—é¤çš„è¯ï¼Œ3.5ç¾å…ƒçš„é‚£ä¸ªï¼Œæ¯æœˆæœ‰500Gæµé‡ï¼Œä½œä¸º`ShadowsocksæœåŠ¡å™¨`æ˜¯è¶³å¤Ÿçš„ï¼Œå½“ç„¶ï¼ŒåœŸè±ªè¯·éšæ„

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_4.png" }}" alt="pic">

å…¶å®ƒé€‰é¡¹ï¼Œä¸é‡è¦ï¼Œç‚¹å‡»`Deploy Now`æ¥åˆ›å»ºã€å¯åŠ¨è¿™å°`æœåŠ¡å™¨`

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_5.png" }}" alt="pic">

è¿›å…¥è¿™å°`æœåŠ¡å™¨`çš„è¯¦æƒ…é¡µï¼Œå¯ä»¥çœ‹åˆ°å…³é”®çš„`IPåœ°å€`å’Œ`rootç”¨æˆ·å¯†ç `ç­‰ä¿¡æ¯

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_6.png" }}" alt="pic">

å¦‚æœè´¦æˆ·ä½™é¢ä¸è¶³çš„è¯ï¼Œå¯ä»¥åœ¨`Billing`è§†å›¾ä¸­ç”¨æ”¯ä»˜å®å……å€¼

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_7.png" }}" alt="pic">

# å¼€å§‹æ­å»ºShadowsocksæœåŠ¡

## ä½¿ç”¨SSHè¿æ¥åˆ°è´­ä¹°çš„æœåŠ¡å™¨

`Windows`å¹³å°å¯ä»¥ä½¿ç”¨[Xshell](https://www.netsarang.com/products/xsh_overview.html)ï¼Œæˆ–è€…ç›´æ¥åœ¨`PowerShell`ä¸­ä½¿ç”¨`ssh`å‘½ä»¤ï¼Œå°±åƒåœ¨`Linux`ä¸­é‚£æ ·

```
// ç”¨æˆ·åå’Œip
ssh username@ip
// æ¯”å¦‚
ssh root@127.0.0.1
```

æŒ‰æç¤ºè¾“å…¥å¯†ç ï¼Œå³å¯è¿æ¥

## ä¿®æ”¹å¯†ç 

`Vultr`é»˜è®¤åˆ†é…çš„`root`ç”¨æˆ·å¯†ç å¤ªå¤æ‚äº†ï¼Œä½ ç»å¯¹ä¸ä¼šæƒ³åœ¨`ssh`ä¸­è¾“å…¥ç¬¬äºŒæ¬¡ï¼Œæ‰€ä»¥ï¼Œç¬¬ä¸€ä»¶äº‹ï¼Œä¿®æ”¹å¯†ç 

```
passwd root
```

æŒ‰æç¤ºè¾“å…¥2æ¬¡æ–°å¯†ç å³å¯ï¼Œè¿™é‡Œä¿®æ”¹åï¼Œ`æœåŠ¡å™¨`è¯¦æƒ…é¡µä»ç„¶ä¼šæ˜¾ç¤ºåŸå¯†ç ï¼Œä½†å·²ç»å¯ä»¥ç”¨æ–°å¯†ç ç™»é™†äº†

## å®‰è£…Shadowsocks

å¯¹äº`Ubuntu 18.04`åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥ç”¨`apt`å‘½ä»¤å®‰è£…

```
apt install shadowsocks
```

éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ

```
ssserver --help
```

## é…ç½®å‚æ•°

`Shadowsocks`é»˜è®¤ä»`/etc/shadowsocks/config.json`ä¸­åŠ è½½é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ä¿®æ”¹è¯¥æ–‡ä»¶æ¥è¿›è¡Œè‡ªå®šä¹‰

```
vim /etc/shadowsocks/config.json
```

å†…å®¹å¦‚ä¸‹
```
{ 
	// è‡ªå®šä¹‰
	"server":"VPSçš„ipåœ°å€", 
	// è‡ªå®šä¹‰
	"server_port":æœåŠ¡å™¨ç«¯å£ï¼ˆ1000~65535ï¼‰, 
 	"local_address": "127.0.0.1", 
	"local_port":1081, 
	// è‡ªå®šä¹‰
	"password":"è‡ªå®šä¹‰å¯†ç ", 
	"timeout":300, 
	// åŠ å¯†æ–¹å¼
	"method":"aes-256-cfb", 
	"fast_open": false 
} 
 ```

## å¯åŠ¨ä¸å…³é—­æœåŠ¡

å¯ä»¥ç›´æ¥ä½¿ç”¨`ssserver`å‘½ä»¤æ¥å¯åŠ¨`Shadowsocks`

```
// ä½¿ç”¨ssserveråŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶
ssserver -c /etc/shadowsocks/config.json 
```

å¦‚æœæƒ³è¦å…³é—­å®ƒ

```
killall ssserver
```

## å¯åŠ¨ä¸å…³é—­æœåŠ¡ï¼ˆæ¨èçš„æ–¹å¼ï¼‰

`Shadowsocks`é»˜è®¤ä¼šåœ¨`/etc/init.d/shadowsocks`ä¸­é…ç½®`Linux`æœåŠ¡ï¼Œä½¿ç”¨`Vim`æŸ¥çœ‹

```
vim /etc/init.d/shadowsocks
```

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_9.png" }}" alt="pic">

å¯ä»¥å‘ç°å®ƒä½¿ç”¨çš„ä¹Ÿæ˜¯`ssserver`å‘½ä»¤ï¼Œé»˜è®¤åŠ è½½`/etc/shadowsocks/config.json`ä½œä¸ºé…ç½®æ–‡ä»¶

```
// å¯åŠ¨æœåŠ¡
/etc/init.d/shadowsocks start
// å…³é—­æœåŠ¡
/etc/init.d/shadowsocks stop
// å¦‚æœä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œåœ¨å¯åŠ¨æœåŠ¡ä¹‹å‰ï¼Œè¦è¿›è¡Œé‡æ–°åŠ è½½
systemctl daemon-reload
```

## éªŒè¯æœåŠ¡

åœ¨ä»»æ„å¹³å°çš„`å®¢æˆ·ç«¯`è¾“å…¥æ­¤`ShadowsocksæœåŠ¡å™¨`çš„`IP`ã€`ç«¯å£`ã€`åŠ å¯†æ–¹å¼`ã€`å¯†ç `ï¼Œè¿›è¡Œè¿æ¥ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥è®¿é—®[Google](https://Google.com)

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_8.png" }}" alt="pic">

## é…ç½®å¼€æœºè‡ªå¯åŠ¨

ä¸Šé¢æåˆ°`Shadowsocks`ä¼šè‡ªåŠ¨åˆ›å»º`Linux`æœåŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªæœåŠ¡æ˜¯é»˜è®¤å¼€æœºå¯åŠ¨çš„

```
// æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
service --status-all
```

`shadowsocks`ä¹‹å‰æœ‰`+`ï¼Œè¡¨ç¤ºå®ƒæ˜¯å¼€æœºè‡ªå¯åŠ¨çš„

<img class="materialboxed responsive-img" src="{{ "/assets/ScreenShot_10.png" }}" alt="pic">

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¥æ‰‹åŠ¨é…ç½®æœåŠ¡çš„å¼€æœºè‡ªå¯è¡Œä¸º

```
// å°†ä¸€ä¸ªserviceåŠ å…¥å¼€æœºå¯åŠ¨
update-rc.d serviceName defaults
// å–æ¶ˆè¯¥serviceçš„å¼€æœºå¯åŠ¨
update-rc.d -f serviceName remove
```

å½“ç„¶ï¼Œå¦‚æœå¾ˆé—²çš„è¯ï¼Œä¹Ÿå¯ä»¥ç¦ç”¨`Shadowsocks`è‡ªåŠ¨åˆ›å»ºçš„`Linux`æœåŠ¡ï¼Œè‡ªå·±å°†ä¸‹é¢è¿™æ¡æŒ‡ä»¤åŠ å…¥ç³»ç»Ÿçš„å¼€æœºå¯åŠ¨é¡¹ğŸ˜

```
ssserver -c /etc/shadowsocks/config.json
```

## å¼€å¯BBRåŠ é€Ÿ

`BBR`ç®—æ³•å·²ç»åœ¨`Linux`å†…æ ¸`4.9`åŠä»¥ä¸Šç‰ˆæœ¬ä¸­åŒ…æ‹¬ï¼Œä½†å¹¶æ²¡æœ‰é»˜è®¤å¼€å¯ï¼Œæ ¹æ®[ç½‘å‹å®æµ‹](https://segmentfault.com/a/1190000008395823)ï¼Œå®ƒå¯ä»¥æ˜æ˜¾çš„æå‡TCPè¿æ¥é€Ÿåº¦

å¯¹äº`Ubuntu 18.04`åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå†…æ ¸å·²åœ¨`4.9`ä¹‹ä¸Šï¼Œå¯ä»¥ç›´æ¥å¼€å¯æ­¤åŠŸèƒ½

```
modprobe tcp_bbr
echo "tcp_bbr" >> /etc/modules-load.d/modules.conf
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
sysctl -p
```
  
## é‡å¯ä»¥éªŒè¯æ˜¯å¦æ­£ç¡®é…ç½®

```
reboot
```
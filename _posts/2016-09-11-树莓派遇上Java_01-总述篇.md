---
layout: post
type: original
title: "树莓派遇上Java_01-总述篇"
author: 立泉
date: 2016-09-11 +0800
description: 
cover: 
categories: essy
tags: CS Java RaspberryPi
---

我是一个喜欢玩的人，尤其对遥控玩具情有独钟，小时候为了看看它们的工作原理，不知有多少玩具被我大卸八块，而除了发现几块电路板，几节电池和一堆马达外几乎总是一无所获。另外，即使在我小时候，也能发现它们在做工和功能上都有着这样或那样的缺陷，我确实很想拥有一款可以完全自定义的大玩具。

三个月前，我拿到了自己的第一个`树莓派`，这是一种为方便学生计算机教育而设计的卡片式电脑，机身集成了`RJ45`、`USB`、`HDMI`、`AV`等接口和`MicroSD`卡插槽，可以运行`Linux`和`Windowns10 IoT`操作系统，配有的23个`GPIO`针脚则为控制其他设备提供了无限的可能性。我拿到的是`RaspberryPi 3B`，板载`蓝牙`和`无线网卡`，淘宝200元左右。

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20160911/raspberrypi.jpg){: loading="lazy" class="clickable" onclick="clickShowOriginalImg(event)" alt="pic"}

对于操作系统，我接触过`Linux`，所以选择了`树莓派`官方的`Raspbian`，安装过程极其简单，只需要按照说明把系统文件拷录到一张`MicroSD`卡上，再将卡插入`树莓派`即可。由于我身边没有显示器，只能通过`SSH`远程连接`树莓派`进行操作，也可以使用`VNC-Viewer`这种远程桌面软件来使用图形化界面，具体的细节我将在随后的文章中说明。

在安装了一些必要的软件后，就可以开始为`树莓派`编程了，它支持很多语言，最受欢迎的应该是`Python`，但对我来说，`Java`才是最合适的（实际上我只学过`Java`和`C++`）。`Raspbian`集成了`JDK`，对`GPIO`的操作则借助于[pi4j](http://pi4j.com/){: target="_blank" }项目，它对底层的`C`接口利用`JNI`进行了封装，旨在为`Java`开发者提供友好的面向对象`API`，使开发者将更多精力放在自己的业务逻辑上。`Java`一直宣称它具有良好的跨平台性，所谓“一次编译，到处运行”，所以使用`Java`操作`树莓派`，在不用`串口`的情况下，最好的方法是，在PC上使用`Intellij IDEA`或`Eclipse`这种成熟`IDE`编程并生成`Jar`包，再用[FileZilla](https://filezilla-project.org/){: target="_blank" }之类的`FTP`工具把`Jar`包传输到`树莓派`上执行。

借助`GPIO`接口，`树莓派`可以控制很多设备，诸如各种传感器、马达、`舵机`、Led灯、显示屏等，近年来虽然也有很多类似`树莓派`的廉价设备出现，但是`树莓派`的核心优势在于开源社区的力量，无数开发者在为`树莓派`贡献代码，各种框架、套件层出不穷，有大量的扩展版可用，它的可玩性和易用性是其他设备不可比肩的。大部分普通玩家常利用`树莓派`控制物联网设备，制作各种轮式或仿形机器人，用自己的双手打造自己想要的设备，其中的乐趣自然无穷。

我利用`树莓派`制作了一个履带式机器人，配有机械手和摄像头，还有一些传感器没来得及安装，机器人和`Android`控制程序初期效果如下:

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20160911/pi_robot_thumb.jpg){: loading="lazy" class="clickable" onclick="clickShowOriginalImg(event)" alt="pic"}

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20160911/pi_controller_android.png){: loading="lazy" class="clickable" onclick="clickShowOriginalImg(event)" alt="pic"}


用到的配件淘宝上都能买到，需要自己接线并安排各组件的安装位置，手动编写`Linux`端和`Android`端的控制程序。在不依赖互联网的情况下，手机和`树莓派`建立连接有两种方式，但都要保证两台设备处在同一个局域网中。

1. `树莓派`和手机连接在同一个路由器上
2. `树莓派`发射一个`WiFi`热点，手机连接该热点

一般对于这种移动机器人会使用第二种方式，因为它不依赖路由器，准确的说，发射`WiFi`的手机就是路由器，可以在任何地点进行遥控。如果把`树莓派`做成接入互联网的物联网设备，从外网访问局域网中的`树莓派`，则要依赖路由器的`端口映射`功能，或者直接加上带`物联网卡`的移动通信模块。在具体的建立连接方面，我使用的是`Java`的原生`Socket`连接，通过`IP`地址和`端口`找到对应设备的对应软件，然后建立`数据流`连接，即可传递数据。但在连接方面有一个小问题，那就是`Java`的`Socket`连接如果中间意外断开了，则服务端和客户端是不会收到任何通知的，在我的控制软件上有一个`View`用来显示时时的连接状态，这可以通过不断发送心跳包来实现，在指定的时间内收不到心跳包即判断连接已经断开。

我在打造自己设备的时候遇到了很多小问题，但都被一一解决，不得不说，发现问题、解决问题的过程才是软件开发中最大的乐趣，有时候实现一种功能有多种不同的方案，这时就要比较取舍，选择最高效简洁的方案来解决实际的问题。
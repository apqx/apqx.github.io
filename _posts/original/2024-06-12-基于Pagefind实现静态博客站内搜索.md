---
layout: post
categories: original
title: "åŸºäºPagefindå®ç°é™æ€åšå®¢ç«™å†…æœç´¢"
author: ç«‹æ³‰
mention: Jekyll Webpack Async
date: 2024-06-12 +0800
description: Jekyllç”Ÿæˆçš„é™æ€åšå®¢å¹¶ä¸æ”¯æŒç«™å†…æœç´¢ï¼Œä»¥å¾€å®ç°è¦ä¹ˆä½¿ç”¨æœç´¢å¼•æ“çš„site:mudan.meé™å®šç«™ç‚¹ï¼Œè¦ä¹ˆæ­é…æœåŠ¡å™¨è‡ªå»ºå…¨æ–‡æœç´¢æœåŠ¡ï¼Œä½†æ˜¯å‰è€…ç´¢å¼•æ›´æ–°ç¼“æ…¢ï¼Œåè€…åˆ™å¤ªâ€œé‡â€ï¼Œæ€»ä¹‹å¯¹äºå€¾å‘å…è´¹æ‰˜ç®¡çš„é™æ€åšå®¢å¹¶æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ–¹æ¡ˆã€‚
cover: 
tags: Code Blog Pagefind Webpack Jekyll æœç´¢
---

`Jekyll`ç”Ÿæˆçš„é™æ€åšå®¢å¹¶ä¸æ”¯æŒç«™å†…æœç´¢ï¼Œä»¥å¾€å®ç°è¦ä¹ˆä½¿ç”¨æœç´¢å¼•æ“çš„`site:mudan.me`é™å®šç«™ç‚¹ï¼Œè¦ä¹ˆæ­é…æœåŠ¡å™¨è‡ªå»ºå…¨æ–‡æœç´¢æœåŠ¡ï¼Œä½†å‰è€…ç´¢å¼•æ›´æ–°ç¼“æ…¢ï¼Œåè€…åˆ™å¤ªâ€œé‡â€ï¼Œæ€»ä¹‹å¯¹äºå€¾å‘å…è´¹æ‰˜ç®¡çš„é™æ€åšå®¢å¹¶æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ–¹æ¡ˆã€‚

ç›´åˆ°2022å¹´[Pagefind](https://pagefind.app/){: target="_blank" }å‡ºç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº`Rust`å’Œ`WebAssembly`çš„è½»é‡é™æ€æœç´¢å·¥å…·ã€‚å…ˆä½¿ç”¨å®ƒçš„`å‘½ä»¤è¡Œ`å·¥å…·æ‰«æç«™ç‚¹ç”Ÿæˆç´¢å¼•æ–‡ä»¶å’Œå¯¹åº”çš„æ£€ç´¢`API`ï¼Œæ‰€è°“`API`å…¶å®å°±æ˜¯`Wasm`ç¨‹åºæä¾›çš„`Javascript`å‡½æ•°æ¥å£ï¼Œæœç´¢æ—¶åœ¨`Web`é¡µé¢è°ƒç”¨å®ƒä»¬ä¼šè‡ªåŠ¨è®¿é—®ç´¢å¼•æ–‡ä»¶ç”Ÿæˆç»“æœã€‚

è¿™ç§æ¨¡å¼åªæ˜¯ä»æµè§ˆå™¨è®¿é—®äº‘ç«¯é™æ€èµ„æºï¼Œæœç´¢ç®—æ³•åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå¹¶ä¸éœ€è¦é€šå¸¸æ„ä¹‰ä¸Šçš„â€œæœç´¢æœåŠ¡å™¨â€ï¼Œè€Œä¸”å®ƒä¼šå°½é‡é™ä½æ£€ç´¢æ—¶ä¼ è¾“çš„æ•°æ®é‡æ¥èŠ‚çœå¸¦å®½ã€‚å®˜æ–¹æè¿°æ˜¯10000ä¸ªé¡µé¢çš„å…¨æ–‡æœç´¢åŒ…æ‹¬ä¸‹è½½`Wasm`ç¨‹åºåœ¨å†…ä¼ è¾“çš„æ•°æ®é‡ä¸è¶…è¿‡400KBï¼Œå¤§éƒ¨åˆ†ç½‘ç«™ä¼šåœ¨100KBå·¦å³ã€‚

## ç´¢å¼•

ç”Ÿæˆç´¢å¼•éœ€è¦å…ˆå®‰è£…`Pagefind`ï¼Œå®˜æ–¹æä¾›`npm`åŒ…ï¼Œå¯ä»¥é€šè¿‡`npx`ç›´æ¥ä½¿ç”¨:

```sh
# æ‰«æ --site æŒ‡å®šçš„ç›®å½•ï¼Œå°†ç´¢å¼•è¾“å‡ºåˆ° --output-path æŒ‡å®šçš„ç›®å½•ä¸‹
npx -y pagefind --site _site --output-path npm/pagefind
# æ³¨æ„æ­¤å‘½ä»¤å¹¶ä¸ä¼šæ¸…é™¤å·²æœ‰æ•°æ®ï¼Œè€Œæ˜¯è¦†ç›–
# æ‰€ä»¥æ¯æ¬¡æ‰§è¡Œå‰éœ€è¦æ‰‹åŠ¨åˆ é™¤ä¸Šæ¬¡çš„ç´¢å¼•ï¼Œå¦åˆ™å¯èƒ½ä¼šè¶Šç§¯è¶Šå¤š
```

æˆ–ä¸‹è½½é¢„ç¼–è¯‘çš„[äºŒè¿›åˆ¶æ–‡ä»¶](https://github.com/CloudCannon/pagefind/releases){: target="_blank" }å®‰è£…åˆ°æœ¬æœºï¼Œè¿è¡Œé€Ÿåº¦æ›´å¿«ã€‚æ³¨æ„å¦‚æœè¦å¤„ç†ä¸­æ–‡å¿…é¡»å®‰è£…`pagefind_extended`è€Œä¸æ˜¯é»˜è®¤çš„`pagefind`ï¼Œå¦åˆ™æœç´¢åŒ¹é…æ•ˆæœä¼šå¾ˆå·®ï¼Œä¸Šé¢`npx`ä½¿ç”¨çš„å°±æ˜¯`extended`ç‰ˆæœ¬ã€‚

```sh
# è§£å‹åæŠŠ pagefind_extended å¯æ‰§è¡Œæ–‡ä»¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥æ–¹ä¾¿åœ¨ Terminal ä¸­ä½¿ç”¨
# å¯¹ macOSï¼Œåªéœ€å°†å…¶è½¯é“¾æ¥åˆ° /usr/local/bin ä¸­
ln -s /Users/apqx/Documents/MyApp/pagefind_extended-v1.1.1-x86_64-apple-darwin/pagefind_extended /usr/local/bin/pagefind 
# ç”Ÿæˆç´¢å¼•ï¼Œå®‰è£…åˆ°æœ¬æœºçœå»äº† npx æ£€æµ‹ç½‘ç»œçš„æ­¥éª¤ï¼Œæ‰§è¡Œæ—¶æ›´å¿«
pagefind --site _site --output-path npm/pagefind
```

æ‰§è¡Œåä¼šåœ¨`./npm/pagefind`ç›®å½•ä¸­ç”Ÿæˆä»¥ä¸‹å†…å®¹:

```sh
# ç´¢å¼•åˆ†é¡µ
|-fragment/
|-index/
# æœç´¢ API
|-pagefind.js
# é»˜è®¤ UI
|-pagefind-ui.js
|-pagefind-ui.css
# æ¨¡å—åŒ– UI
|-pagefind-modular-ui.js
|-pagefind-modular-ui.css
# å…¶å®ƒç´¢å¼•é¡¹å’Œ Wasm ç¨‹åºæ–‡ä»¶
...
```

æ³¨æ„åˆ°é‡Œé¢æœ‰åä¸º`*-ui`çš„`JS`å’Œ`CSS`ï¼Œå®ƒä»¬æ˜¯`Pagefind`é¢„ç½®çš„æœç´¢ç•Œé¢ï¼Œç®€å•å‡ æ­¥å³å¯åµŒå…¥ç«™ç‚¹:

```html
<!-- å¼•å…¥UIèµ„æº -->
<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<div id="search"></div>
<script>
    // åˆ›å»ºUIæ’å…¥ç‚¹
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script>
```

`pagefind-ui`å¤§æ¦‚é•¿è¿™æ ·ï¼Œæœç´¢ç»“æœåŒ…å«ä¸‹çº§æ ‡é¢˜å’Œæ‘˜è¦ã€‚å…³é”®æ ·å¼å¯ä»¥é€šè¿‡`CSS`å…¨å±€å˜é‡è‡ªå®šä¹‰ï¼Œæ¯”å¦‚èƒŒæ™¯è‰²å¯¹åº”çš„æ˜¯`--pagefind-ui-background`ã€‚

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/original/20240612/pagefind-ui.webp){: loading="lazy" class="clickable clickShowOriginalImg" alt="Pagefind" }

è‡³äº`pagefind-modular-ui`åˆ™æ˜¯æ¨¡å—åŒ–çš„ç»„ä»¶`UI`ï¼Œæœç´¢æ¡†å’Œæœç´¢ç»“æœåˆ†å¼€ï¼Œå¯ä»¥è‡ªç”±æ’å…¥åˆ°æŒ‡å®šä½ç½®ï¼Œé…ç½®æ›´åŠ çµæ´»ã€‚è¯¦ç»†ä¿¡æ¯å‚è€ƒ[è¿™é‡Œ](https://www.npmjs.com/package/@pagefind/modular-ui){: target="_blank" }ã€‚

ä¸€èˆ¬è¿™äº›æ–‡ä»¶åº”è¯¥å’Œåšå®¢ä¸»ç«™æ”¾åœ¨ä¸€èµ·ï¼Œä½†å¯¹äºè€ƒè™‘å›½å†…è®¿é—®çš„æµ·å¤–ç«™ç‚¹ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒä»¬å•ç‹¬æ”¾åˆ°å¤§é™†çš„æœåŠ¡å™¨æˆ–`OSS`ä¸Šä¼˜åŒ–è®¿é—®é€Ÿåº¦ã€‚

## æœç´¢

å¦‚æœå¯¹é¢„ç½®`UI`ä¸æ»¡æ„ï¼Œå¯ä»¥ä½¿ç”¨`Pagefind`æä¾›çš„`JS`å‡½æ•°æ¥å£æ‰‹åŠ¨è°ƒç”¨æœç´¢`API`ï¼Œè‡ªè¡Œå¤„ç†æœç´¢é€»è¾‘å’Œç»“æœå±•ç¤ºã€‚

```ts
// pagefind.js æ–‡ä»¶ URLï¼Œæˆ‘åœ¨éƒ¨ç½²æ—¶æŠŠå®ƒæ”¾åˆ°å›½å†… OSS ä¸Šï¼Œä¸ä¸»ç«™åˆ†ç¦»
const pagefindUrl: string = isDebug() ? "/npm/pagefind/pagefind.js" : "https://apqx.***.com/blog/pagefind/pagefind.js"
// åŠ¨æ€åŠ è½½
const pagefind = await import(pagefindUrl)
// åˆå§‹åŒ–
pagefind.init()
// æ‰§è¡Œæœç´¢ï¼Œè·å–ç»“æœ
const pagefindResult = await this.pagefind.search(key)
```

é…åˆ`Material Design`åšå‡ºçš„æœç´¢`Dialog`:

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/original/20240612/pagefind-api.webp){: loading="lazy" class="clickable clickShowOriginalImg" alt="Pagefind Material Design" }

æ³¨æ„å›¾ä¸­`Tips`ï¼Œ`Pagefind`ä¸ºå®ç°è½»é‡åŒ–æ˜¯å¯¹`å•è¯`å»ºç«‹ç´¢å¼•ï¼Œè€Œå®ƒçš„ä¸­æ–‡`åˆ†è¯`å¹¶ä¸å®Œå–„ï¼Œä¸€äº›äººåä¹‹ç±»çš„ä½é¢‘è¯å¹¶ä¸èƒ½è¢«æ­£ç¡®è¯†åˆ«ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å°è¯•åœ¨`å•å­—`ä¹‹é—´åŠ ç©ºæ ¼ï¼Œå®ƒä¼šæœç´¢åŒæ—¶åŒ…å«è¿™äº›`å­—`çš„ç»“æœï¼ŒåŒ¹é…å‡†ç¡®åº¦æ›´å¥½ã€‚

### Webpack

å¦‚ä¸Šæ‰€è¿°è°ƒç”¨æœç´¢`API`å¾ˆç®€å•ï¼Œåªéœ€è¦`import`å¯¹åº”çš„`JS`æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨`Webpack`ä¸­ï¼Œ`import`çš„`JS`å¿…é¡»æ˜¯æœ¬åœ°æ–‡ä»¶ä¸”ä¼šè¢«ç›´æ¥æ‰“åŒ…è€Œéè¿è¡Œæ—¶åŠ¨æ€ä»æŒ‡å®šä½ç½®åŠ è½½ï¼Œå¯¼è‡´`Pagefind`æœç´¢å‡½æ•°æ€»æ˜¯ä¸èƒ½æ­£ç¡®è®¿é—®åˆ°äº‘ç«¯ç´¢å¼•ã€‚è¿™ä¸ªè«åé—®é¢˜å›°æ‰°æˆ‘å¾ˆä¹…ï¼Œæ¯•ç«Ÿä¸æ˜¯`Web`å¼€å‘è€…ï¼Œæ˜æ˜æ˜¯æŒ‰ç…§æ–‡æ¡£ä¸€æ­¥æ­¥åšç»“æœå´å¡ä½èµ°ä¸é€š...ä¹‹åä¸æ–­è¯•é”™ï¼Œ`Google`ä¸€é•¿ä¸²`Error`ç¿»å¥½å¤šé¡µæ‰ç»ˆäºæ‰¾åˆ°ä¸ä¹‹ç›¸å…³çš„ä¸€ç¯‡æ–‡ç« ã€‚

æ­£ç¡®åšæ³•ä»…ä»…æ˜¯æ·»åŠ ä¸€ä¸ª`webpackIgnore`æ³¨é‡Šï¼Œå‘Šè¯‰`Webpack`ä¸è¦æ‰“åŒ…`import`çš„è¿™ä¸ª`pagefind.js`æ–‡ä»¶ï¼Œç•™åˆ°è¿è¡Œæ—¶å†åŠ è½½ã€‚

```ts
const pagefind = await import(/*webpackIgnore: true*/ pagefindUrl)
```

å°±æ˜¯è¿™ä¹ˆç®€å•ğŸ™„ã€‚

## æœªå®Œå¾…ç»­

å¯¹äºåšå®¢`Pagefind`æä¾›çš„åŸºç¡€æœç´¢å·²ç»è¶³å¤Ÿï¼Œæ­¤å¤–å®ƒä¹Ÿæ”¯æŒé™å®šç´¢å¼•èŒƒå›´ã€æŒ‡å®šç´¢å¼•å…ƒæ•°æ®ã€æœç´¢è¿‡æ»¤ã€æœç´¢æ’åºã€æœç´¢å¤šä¸ªæºç­‰é«˜é˜¶åŠŸèƒ½ï¼Œå¦‚æœé…ç½®å¾—å½“ç”šè‡³å¯ä»¥æ›¿ä»£`Jekyll`çš„`Tag`æ ‡ç­¾å’Œ`Pagination`åˆ†é¡µã€‚

è¿™æ˜¯æˆ‘æœ€è¿‘è€ƒè™‘è¦åšçš„äº‹ï¼Œåˆ†é¡µï¼Œç”¨å®ƒè¿˜æ˜¯`Jekyll`çš„åŸç”ŸåŠŸèƒ½å‘¢ã€‚
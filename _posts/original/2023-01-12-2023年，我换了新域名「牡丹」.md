---
layout: post
categories: original
title: "2023年，我换了新域名「牡丹」"
author: 立泉
mention: Cloudflare 重定向 博客
date: 2023-01-12 +0800
description: 七年了，这个博客的域名一直都是apqx.me，从GoDaddy购买，每年续费168元就可以一直拥有它，而且因为域名的唯一性，它也早已经成为了我在互联网中独一无二的身份ID，我的很多信息都和它有关。
cover: https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20230112/IMG_4572_thumb.jpg
tags: CS Blog 域名 Cloudflare GitHub DNS URL重定向
---

七年了，这个博客的域名一直都是`apqx.me`，从`GoDaddy`购买，每年续费168元就可以一直拥有它，而且因为域名的唯一性，它也早已经成为了我在互联网中独一无二的身份`ID`，我的很多信息都和它有关。

`apqx`当然不是随机的无意义字符，其实是我小时候喜欢的`长弓·阿帕奇`武装直升机的拼音缩写`apq`，至于后面的那个`x`，是因为当我决定要注册人生第一个域名`apq.me`的时候意外发现它竟然已经属于别人了（明明几个月前还是未注册的状态），只能遗憾的在后面加了一个`x`，变成了`apqx.me`🙁。

对非开发者，需要补充一些关于域名是什么的简单解释。服务器是现代互联网的基础设施，网站搭建在服务器上，在网络世界中，只能通过`IP`地址去定位到一台特定的服务器，使用`HTTP`协议可以在浏览器中输入一串类似`http://185.199.109.153:80`的数字来访问搭建在`IP`地址为`185.199.109.153`的服务器上监听`80`端口的网站，全是数字很难记对吧，所以才有了域名的概念。

域名可以由字符、数字甚至是汉字来组成，有意义的词自然比无规则的数字清晰简洁，比如都熟悉的百度，它的域名是`baidu.com`，在浏览器中输入就能跳转到百度的网站。这个过程中浏览器其实是做了2件事，先去`DNS`域名服务器查询这个域名对应的`IP`地址，再去访问这个`IP`对应的服务器，当然中间会有很多复杂的细节需要更多协议来处理，但简单来说，域名起到的就是这个作用。

由常用词组成的优质域名一直都是比较昂贵的资源，像`opera.com`这种在域名出现的时候差不多立刻就被抢注了，后来者想要拥有只能高价从原主人那里购买。除最常见的`.com`之外，近些年也开放了如`.io`、`.xyz`、`.me`、`.love`等很多新的顶级域名，尤其`.me`非常适合做个人博客，而且相比`.com`、`.cn`也比较容易捡到“好词”。

# 牡丹

「牡丹」是一个对我而言十分特殊的词，来源于[昆曲《牡丹亭》对我的影响]({% link _posts/original/2019-05-18-槐安国内春生酒.md %}){: target="_blank" }，所以真的很幸运，在我之前竟然没有人注册过`mudan.me`，这个域名相比于抽象中二的`apqx.me`更有纪念意义，纪念我的整个前青春时代，纪念我从北方到南方的迁徙，纪念我的世界从灰暗向多彩的渐变。

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20230112/IMG_4572_thumb.jpg){: loading="lazy" class="clickable clickShowOriginalImg" alt="杭州 西湖 日落 夕阳" }

如此，更换域名势在必行，有2个问题需要解决：

* 旧域名重定向
* 搜索引擎重新收录

因为`apqx.me`真的使用太久了，过去分享出去的链接都是这个域名，我当然希望这些链接在更换域名后依然能跳转到正确的页面而不至于直接失效，解决方式有2种，旧域名通过`DNS`的`CNAME`直接指向新域名，或者用`HTTP`访问旧域名时插入一次`301`重定向到新域名。

我的博客是托管在`GitHub Pages`上的，仓库根目录下有一个`CNAME`文件标明了这个网站所属的域名，配置过`GitHub Pages`自定义域名的应该都知道，托管在它上面的所有网站域名的`DNS`都指向一个统一的入口服务器，`Pages`会在这里检测访问来源的域名，并与它托管的已知域名对比，从而定位到要访问的网站。在这种机制下，如果在`DNS`中添加一条`CNAME`记录，把`apqx.me`指向`mudan.me`，相当于把`apqx.me`指向了`GitHub Pages`的那台入口服务器，服务器监测到域名来源是`apqx.me`，而在`GitHub Pages`的所有仓库`CNAME`文件中找不到名为`apqx.me`的域名，会直接返回`404`页面，所以这种方式在这种情况下是不可行的。

只剩下另一种方案，但是`GitHub Pages`并不支持针对`HTTP`协议进行配置，所以并不能对请求直接返回`301`重定向，一个思路是在`GitHub Pages`上为`apqx.me`创建一个空白的跳转网站，用`JavaScript`把来访的`URL`手动跳转到`mudan.me`，这...倒不是不可以，只是有点“糙”...

车到山前必有路，我使用的是`Cloudflare`提供的`DNS`服务，众所周知`Cloudflare`的本职是`CDN`内容分发网络，只需把`DNS`解析的`Proxy status`设置为`Proxied`就可以使用它的`CDN`服务，即访问`apqx.me`的流量会先经过`Cloudflare`再到达托管网站的`GitHub Pages`，`Cloudflare`作为中间人是能够对经过它的`HTTP`请求返回`301`重定向的。

*请忽略我在`A记录`里随意添加的`8.8.8.8`，因为会配置重定向，`HTTP`请求永远也不会到达这个`IP`，所以可以任意填*

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20230112/cloudflare_dns.webp){: loading="lazy" class="clickable clickShowOriginalImg" alt="cloudflare" }

这样的中间人操作需要在`Rules`中定义。

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20230112/cloudflare_page_rules.webp){: loading="lazy" class="clickable clickShowOriginalImg" alt="cloudflare rules" }

将`settings`设为`Forwarding URL`，`status code`为`301`重定向，这样所有类似于`apqx.me/path1/path2`的请求都会被重定向到`mudan.me/path1/path2`。

![](https://apqx.oss-cn-hangzhou.aliyuncs.com/blog/20230112/cloudflare_page_rules_301.webp){: loading="lazy" class="clickable clickShowOriginalImg" alt="cloudflare rules 301" }

旧域名重定向到新域名，搜索引擎在抓取网页时也能看到`301`重定向，从而收录新域名，但我觉得还是手动向搜索引擎提交一下新域名`mudan.me`比较好，等它的`URL`全部被收录后就可以放心的从搜索引擎中删除旧域名的信息了。

`apqx.me`我会保留一年作为缓冲，之前在微博等地方分享出去的链接会尽可能修改为新域名链接，无论是直接修改微博还是添加一条提示域名变更的评论，一年后，旧域名不再续费，它不再属于我，重定向自然也会随之失效，再见了👋。